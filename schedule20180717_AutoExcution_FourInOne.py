#-*- coding:utf-8 -*-

import re #regular expression(正規表達式)，處理掉讀者不想閱讀的部份, 或是過濾掉不必要的訊息, 只清楚地顯示你所需要的那一部份
import csv
import os
import sys
import time
import xlrd #xls/xlsx read
import copy
import logbook
import logging
import pytz #python time zone
import schedule#引用相關排程Lib來進行排程工作: 目前測試OK，但必須寫為同一個函式內完成所有相關工作(設定參數、匯出CSV紀錄檔案、自動排缸)[也就是把每個按鈕動作都排進來，每個動作都要time.sleep(秒數)，可看停個1~5秒)
from tkinter import *
import tkinter
import tkinter.ttk as ttk
import pandas as pd #資料前處理，可以擷取 JSON, CSV, Excel, HTML 等等格式的資料。資料型態為Series(一維陣列)及 DataFrame(二維陣列) 格式，可以使用 Index (row) 或 Column 存取資料
#from getDBData import FetchDataFromSqlDB
from getDBData import TestDBconnection
from getDBData import fetch_dyeing_data_with_Totolcon#0105:去抓取目前總濃度的相關資料，再與工單資料合併
from getDBData import fetch_dyeing_data_with_Totalcon_BF3D#20181206 抓取每缸最後一筆工單資料
from getDBData import fetch_dyeing_data_with_Before#20181226 抓取即時前缸資料
from Queue import queue#新增排缸queue物件
from cylinder import cylinder#新增缸物件
from jobtask import jobtask#新增工單物件
from config import config#新增config物件去讀取資料庫參數
#from loadExcelFile import LoadExcelFile#載入相關檔案
from logbook import  Logger, StreamHandler, FileHandler#1211新增logbook紀錄相關程式狀況
from datetime import datetime, timedelta #時間
from time import strftime
from tkinter import filedialog#顯示選取檔案畫面
from tkinter.messagebox import showinfo#顯示視窗畫面
import operator
import pyodbc
#=============================================
global after_sort_list
after_sort_list=[]
global temp_list
temp_list=[]
#@@@@@@@@@@@@@@@@@@@@@@@副函式區域@@@@@@@@@@@@@
def compare(_reclist, tree):#進行與現在時間排程比較，呈現實際從DB撈出的資料: 輸入(資料List, 顯示格式)，輸出(排序後結果)
    clear_tree_content(tree)#清除treeview裡面顯示文字
    global return_list  #20181211   存放jobtask_list[from readfile_to_tree]
    return_list=[]
    temp=[]
    temp=_reclist #20181211   存放jobtask_list[from readfile_to_tree]

    j=0
    i=0
    for i in range(0,len(temp)):
        for j in range(0,len(temp)-1-i):
            _temp=()
            # 20180424 比較索引後呈現正確資料[DB]
            time1=temp[j][11]
            # 20180424 比較索引後呈現正確資料[DB]
            time2=temp[j+1][11]

            #0212:轉換為time1，time2去計算時間差距為何，提供後續排序使用
            if time1>time2 and j<=len(temp):
                _temp=temp[j]
                temp[j]=temp[j+1]
                temp[j+1]=_temp
    #後續為顯示相關排序結果
    #回存gloabl變數return_list中，等候輸出使用
    first=0
    index=0
    size1=len(temp)
    #20181218   新增temp[9] 最大濃度, temp[10] 最大濃度配方代號
    for i  in range(len(temp)):
            tree.insert("" , 0,    text=str(size1), values=(temp[i][0],temp[i][1],temp[i][2],temp[i][3],temp[i][4],temp[i][5],temp[i][6],temp[i][7],temp[i][8],temp[i][9],temp[i][10]))
            size1-=1
    return_list=temp
    #20180606 因顯示內容過多先隱藏
    print("排序後結果為")
    print(return_list)
#============================================================
def outputCsv(_output_list, button, _job_list):#輸出CSV檔案: 輸入(缸List, 按鈕，待排工單資料+同_to_jobtask_list)，輸出(CSV檔案)

    enable_button(btn_db_connection)#開啟資料庫連線按鈕
    #=======================
    global file_to_output
    file_to_output=[]
    file_to_output=_output_list         #20181218   同processing_cylinder_list 染缸規格資料
    #file_to_output=processing_cylinder_list1
    pathProg=os.path.abspath('.')#更改路徑為執行程式的路徑，避免對方電腦沒有相關路徑名稱，產生錯誤
    print("目前CSV檔案輸出路徑為 "+os.path.abspath('.'))
    if not os.path.exists(pathProg):
          os.makedirs(pathProg)
          #print("CSV資料目錄已經建立")
          text4.insert(tkinter.INSERT,"CSV資料目錄已經建立")
    else:
          #print("CSV資料目錄已經存在")
          text4.insert(tkinter.INSERT,"CSV資料目錄已經存在")
    os.chdir(pathProg)
    if os.getcwd() != pathProg:
        #print ("EEROR:.檔案存檔路徑錯誤")
        text4.insert(tkinter.END,"EEROR:.檔案存檔路徑錯誤")
        sys.exit()
    else:
            filename=""
            filename=datetime.now().strftime("%Y%m%d-%H%M%S")
            myfile='\\'+filename+'.csv'
            if os.path.isfile(pathProg+myfile):
                os.remove(pathProg+myfile)
                text4.insert(tkinter.INSERT,"檔案產生中")
            else:    ## Show an error ##
                text4.insert(tkinter.END,"\nError: %s 無找到相關輸出CSV檔案" % myfile)
            #--------/*檢查檔案是否存在，存在就刪除 重新產生*/
            file = open(pathProg + myfile, 'w', newline='')
            writer =csv.writer(file, delimiter=',', quoting=csv.QUOTE_NONE)
            csvHeader = ['排程單號']
            writer.writerow(csvHeader)
            #20190114   修改title為缸號 工單 訂單 色號 投胚量 碼長 開卡時間 分派時間 交期 總濃度 最大濃度 配方號 排缸日期 班別
            csvHeader1 = ['缸號','工單','訂單','色號','投胚量','碼長','開卡時間','分派時間','交期','總濃度','最大濃度','配方號','排缸日期','班別']
            writer.writerow(csvHeader1)
            i=0#loop index

            #20180905   刪除pcist_sche內容(自動覆蓋)
            cnxn2 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
            cursor2 = cnxn2.cursor()  # server 位置: 172.16.41.23
            cursor2.execute("delete from pcist_sche")
            cnxn2.commit()
            for i in range(len(file_to_output)): #27缸
                #==================列印每缸表頭資料區============
                if i!=len(file_to_output)-1:
                    #加上[]後，變成物件，便不會變成各自逗點分隔出來
                    writer.writerow(["#====第"+str(file_to_output[i].get_cylinder_no())+"缸排程工單==start==#"])
                else:
                    writer.writerow(["#====暫時缸未排程工單==start==#"])
                #==================列印每缸工單資料區
                j=0
                size=0
                #0111 修改: 改為get_len_of_cylinder_con_list輸出
                #size=file_to_output[i].queue.size()
                size=file_to_output[i].get_len_of_cylinder_con_list()
                
                #0111:取得相關get_len_of_cylinder_con_list
                temp_list=[]
                temp_list=file_to_output[i].get_cylinder_con_list()

                #print(size)
                #print(temp_list)
                
                global temp_tuple
                #global _temp_tuple
               
                #格式為[機台號,缸號,工單,開卡日, 投胚日]
                _tmp_cyno=str(file_to_output[i].get_cylinder_no())#缸號
                #-========以上要設定相關機台號、缸號、工單清單、開卡日、投胚日

                for j in range(size):#根據工單號及每缸排定工單[48,30...]
                    #_temp_tuple=()
                    #_temp_tuple=temp_list[j]
                    #_tmp_mach=""#機台號
                    # 20190114   修改title為缸號 工單 訂單 色號 投胚量 碼長 開卡時間 分派時間 交期 總濃度 最大濃度 配方號 排缸日期 班別
                    _tmp_cist_no=""#工單號
                    _tmp_od_no = ""  # 訂單號
                    _tmp_clr_no = ""  # 色號
                    _tmp_qty = ""  # 投胚量
                    _tmp_yard = ""  # 碼長
                    _tmp_ci_date=""#開卡時間
                    _tmp_assign_date=""#分派時間
                    _tmp_pred_date=""#交期
                    _tmp_total = ""  # 總濃度
                    _tmp_max = ""  # 最大濃度
                    _tmp_dypd = ""  # 配方號
                    _tmp_schedule_date=""#排缸日期
                    _tmp_class=""#班別
                    _tmp_cist_no=temp_list[j][0]#0111:取得排序過後的第一筆資料
                    if _tmp_cist_no!=None:
                        temp_tuple=search_tuple_from_joblist(_tmp_cist_no,_job_list)#從工單號去找出相對應工單資訊tuple(xxx,xxx,xxx)(工單號，待排工單list)
                        # 20180607 新增匯出CSV所需資料[排缸時間 班別]
                        temp_tuple1=search_tuple_from_joblisted(_tmp_cist_no,_to_jobtasked_list)# 從工單號去找出相對應已排缸工單資訊tuple(xxx,xxx,xxx)
                        if temp_tuple!=None:
                        #==/這邊是要填入機台號，但是目前的機台號編碼不曉得，故還要看倍斯特這邊定義/
                            #0208:修改機台號為缸號(1~9缸則是加上0，變成兩位數，超過則是不加上0)
                            #if len(_tmp_cyno)==1:#表示由1~9缸，則是多加0至前面缸號
                            #   _tmp_machid=''
                            #   _tmp_machid='0'+_tmp_cyno
                            #   _tmp_mach=str(_tmp_machid)#機台號
                            #else:
                            #   _tmp_mach=str(_tmp_cyno)#機台號
                        #===================================
                            #20180521   修改CSV輸出內容
                            #_tmp_mach=str(temp_tuple[6])
                            #%%%0122:這邊可能要換成上面的D+缸號
                            _tmp_cist_no=str(temp_tuple[0])#工單號
                            #20180703   修改CSV輸出內容
                            # 20190114   修改title為缸號 工單 訂單 色號 投胚量 碼長 開卡時間 分派時間 交期 總濃度 最大濃度 配方號 排缸日期 班別
                            _tmp_od_no = str(temp_tuple[1])  # 訂單號
                            _tmp_clr_no = str(temp_tuple[2])  # 色號
                            _tmp_qty = str(temp_tuple[3])  # 投胚量
                            _tmp_yard = str(temp_tuple[4])  # 碼長
                            _tmp_ci_date=str(temp_tuple[5])#開卡時間
                            _tmp_assign_date=str(temp_tuple[6])#分派時間
                            _tmp_pred_date=str(temp_tuple[7])#交期
                            _tmp_total = str(temp_tuple[8])  # 總濃度
                            _tmp_max = str(temp_tuple[9])  # 最大濃度
                            _tmp_dypd = str(temp_tuple[10])  # 配方號
                            _tmp_schedule_date=str(temp_tuple1[2])#排缸日期
                            _tmp_class=str(temp_tuple1[3])#班別
                            #20180704   將排缸結果寫入DyeSchedule
                            #20180904   只存pcist_sche
                            #_tmp_exetime=datetime.now()
                            #cnxn2 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                            #cursor2 = cnxn2.cursor()  # server 位置: 172.16.41.23
                            #cursor2.execute("insert into DyeSchedule(cist_no,mach_id,schedule_date,schedule_class,schedule_flag,execution_time) values (?,?,?,?,?,?)",_tmp_cist_no, _tmp_cyno, _tmp_schedule_date, _tmp_class, 'Y', _tmp_exetime)
                            #cnxn2.commit()
                            #最後寫出一整行相關排缸資料(缸號，工單，開卡時間，分派時間，交期，排缸日期，班別)
                            # 20190114   修改title為缸號 工單 訂單 色號 投胚量 碼長 開卡時間 分派時間 交期 總濃度 最大濃度 配方號 排缸日期 班別
                            writer.writerow([_tmp_cyno]+[_tmp_cist_no]+[_tmp_od_no]+[_tmp_clr_no]+[_tmp_qty]+[_tmp_yard]+[_tmp_ci_date]+[_tmp_assign_date]+[_tmp_pred_date]+[_tmp_total]+[_tmp_max]+[_tmp_dypd]+[_tmp_schedule_date]+[_tmp_class])
                            
                        temp_tuple=None

                j = 0
                fourinone_list=[]
                size1=0
                #20180814   另外輸出每天排缸結果到pcist_sche[日期 機台 1 2 3 4缸]
                for j in range(size):  # 根據工單號及每缸排定工單[48,30...]
                    #_temp_tuple = ()
                    #_temp_tuple = temp_list[j]
                    _tmp_cist_no = ""  # 工單號
                    _tmp_schedule_date = ""  # 排缸日期
                    _tmp_cist_no = temp_list[j][0]  # 0111:取得排序過後的第一筆資料
                    if _tmp_cist_no != None:
                        temp_tuple = search_tuple_from_joblist(_tmp_cist_no,_job_list)  # 從工單號去找出相對應工單資訊tuple(xxx,xxx,xxx)
                        # 20180607 新增匯出CSV所需資料[排缸時間 班別]
                        temp_tuple1 = search_tuple_from_joblisted(_tmp_cist_no,_to_jobtasked_list)  # 從工單號去找出相對應已排缸工單資訊tuple(xxx,xxx,xxx)
                        if temp_tuple != None:
                            _tmp_cist_no = str(temp_tuple[0])  # 工單號
                            _tmp_schedule_date = str(temp_tuple1[2])  # 排缸日期
                            fourinone_list.append(_tmp_cist_no)
                            if (j + 1) % 4 == 0:
                                # 20180814   將排缸結果寫入pcist_sche[日期 機台 1 2 3 4缸]
                                cnxn3 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                cursor3 = cnxn3.cursor()  # server 位置: 172.16.41.23
                                cursor3.execute("insert into pcist_sche(m_date,mach_id,cist_01,cist_02,cist_03,cist_04) values (?,?,?,?,?,?)",_tmp_schedule_date, _tmp_cyno, fourinone_list[0], fourinone_list[1], fourinone_list[2], fourinone_list[3])
                                cnxn3.commit()
                                fourinone_list=[]
                        temp_tuple = None
                # 20180814   將排缸結果(<4缸)寫入pcist_sche[日期 機台 1 2 3 4缸]
                size1 = len(fourinone_list)
                if size1 == 1:
                    # 20180814   將排缸結果寫入pcist_sche[日期 機台 1 2 3 4缸]
                    cnxn4 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                    cursor4 = cnxn4.cursor()  # server 位置: 172.16.41.23
                    #20180904   insert時欄位需與DB一致，沒值以空值填入
                    cursor4.execute("insert into pcist_sche(m_date,mach_id,cist_01,cist_02,cist_03,cist_04) values (?,?,?,?,?,?)",_tmp_schedule_date, _tmp_cyno, fourinone_list[0],'','','')
                    cnxn4.commit()
                elif size1 == 2:
                    # 20180814   將排缸結果寫入pcist_sche[日期 機台 1 2 3 4缸]
                    cnxn4 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                    cursor4 = cnxn4.cursor()  # server 位置: 172.16.41.23
                    cursor4.execute("insert into pcist_sche(m_date,mach_id,cist_01,cist_02,cist_03,cist_04) values (?,?,?,?,?,?)",_tmp_schedule_date, _tmp_cyno, fourinone_list[0], fourinone_list[1],'','')
                    cnxn4.commit()
                elif size1 == 3:
                    # 20180814   將排缸結果寫入pcist_sche[日期 機台 1 2 3 4缸]
                    cnxn4 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                    cursor4 = cnxn4.cursor()  # server 位置: 172.16.41.23
                    cursor4.execute("insert into pcist_sche(m_date,mach_id,cist_01,cist_02,cist_03,cist_04) values (?,?,?,?,?,?)",_tmp_schedule_date, _tmp_cyno, fourinone_list[0], fourinone_list[1], fourinone_list[2],'')
                    cnxn4.commit()

                #==========================================
                if i!=len(file_to_output)-1:
                    writer.writerow(["#====第"+str(file_to_output[i].get_cylinder_no())+"缸排程工單==end==#"])
                else:
                    writer.writerow(["#====暫時缸未排程工單==start==#"])
                writer.writerow(["%%"])
            file.close
            #0122:暫時先不清理相關顯示文字，避免未排缸的工單被忽略
            #clear_text_content(text4)#清除text4顯示文字
            text4.insert(tkinter.END,"檔案輸出成功")
            log.info("CSV檔案已經輸出")
#======/*從工單號去找出相對應工單資訊tuple(xxx,xxx,xxx)資訊: 輸入(工單號碼，缸List)，輸出(工單資料tuple)*/
def search_tuple_from_joblist(_target_jobno, _rec_list):
    global found_tuple
    found_tuple=[]
    size=0
    size=len(_rec_list)
    index=0
    for index in range(0,size):
        tmp_no=""
        tmp_no=_rec_list[index][0]
        #20180703   因應CSV匯出修改已排缸後的tuple
        if _target_jobno==tmp_no:
            found_tuple.append(_rec_list[index][0])#工單號
            found_tuple.append(_rec_list[index][1])#訂單號
            found_tuple.append(_rec_list[index][2])#色號
            found_tuple.append(_rec_list[index][3])#投胚量
            found_tuple.append(_rec_list[index][4])#碼長
            found_tuple.append(_rec_list[index][5])#開卡時間
            found_tuple.append(_rec_list[index][6])#分派時間
            found_tuple.append(_rec_list[index][7])#交期
            found_tuple.append(_rec_list[index][8])#總濃度
            found_tuple.append(_rec_list[index][9])#最大濃度
            found_tuple.append(_rec_list[index][10])#最大濃度配方號
            break
        else:
            continue
    return found_tuple
#======/*從工單號去找出已排缸相對應工單資訊tuple(xxx,xxx,xxx)資訊: 輸入(工單號碼，缸List)，輸出(工單資料tuple)*/
def search_tuple_from_joblisted(_target_jobno, _rec_list):
    #print(_rec_list)
    global found_tuple
    found_tuple=[]
    size=0
    size=len(_rec_list)
    index=0
    for index in range(0,size):
        tmp_no=""
        tmp_no=_rec_list[index][0]
        if _target_jobno==tmp_no:
            found_tuple.append(_rec_list[index][0])#工單號
            found_tuple.append(_rec_list[index][1])#濃度
            found_tuple.append(_rec_list[index][2])#排缸日期
            found_tuple.append(_rec_list[index][3])#班別
            break
        else:
            continue
    return found_tuple
#===========#讀取測試檔案到tree顯示區域: 輸入(資料list，顯示格式)，輸出(讀入總濃度資料List)
def readfile_to_tree(_rec_showlist, tree):
    global db_co_object
    db_co_object=None
    #建立DB物件，取得目前DB_config.ini目前檔案值
    db_co_object=config()

    global _to_jobtask_list #20181211   存放待排工單資料(11 columns)
    global _to_jobtasked_list   #20180607 新增匯出CSV所需資料[排缸時間 班別]
    _to_jobtask_list=[]
    _to_jobtasked_list=[]
    #清除目前相關tree內容，避免重復顯示
    clear_tree_content(tree)
    file_to_tree=[]
    file_to_tree=_rec_showlist
    
    #計算碼長 並填入相關list中
    size=len(file_to_tree)
    global jobtask_list #20181211   傳送到compare[有加排序索引]
    jobtask_list=[]
    global jobtask_list1    #20181211   傳送到ProcessSchedulingOnCylinders[有加排序索引]
    jobtask_list1 = []
    
    temp_tuple=()
    j=0
    size=len(_rec_showlist)
    for j in range(size):
        #20180417 調整讀取檔案到tree的欄位位置
        temp_emb_qty=float(file_to_tree[j][3])#投胚量
        temp_yard=float(file_to_tree[j][4])#計算出碼長,目前不知道長度單位為何(幾尺)

        if  file_to_tree[j][8]=="0.0" or file_to_tree[j][8]=="":
            file_to_tree[j][8]=0.0
        #20181211   新增max_con, dypd_id
        _jobtask=(file_to_tree[j][0],file_to_tree[j][1],file_to_tree[j][2],file_to_tree[j][3],temp_yard,file_to_tree[j][5],file_to_tree[j][6],
        file_to_tree[j][7],file_to_tree[j][8],file_to_tree[j][9],file_to_tree[j][10])

        #20180418 資料載入順序與tree呈現相反[後進先出]
        tree.insert("" , 0, text=str(size), values=(file_to_tree[j][0],file_to_tree[j][1],file_to_tree[j][2],file_to_tree[j][3],temp_yard,file_to_tree[j][5],file_to_tree[j][6],
        file_to_tree[j][7],file_to_tree[j][8],file_to_tree[j][9],file_to_tree[j][10]))
        
        temp_tuple+=(file_to_tree[j][0],)
        temp_tuple+=(file_to_tree[j][1],)
        temp_tuple+=(file_to_tree[j][2],)
        temp_tuple+=(file_to_tree[j][3],)
        temp_tuple+=(temp_yard,)
        temp_tuple+=(file_to_tree[j][5],)
        temp_tuple+=(file_to_tree[j][6],)
        temp_tuple+=(file_to_tree[j][7],)#機台號碼
        temp_tuple+=(file_to_tree[j][8],)
        temp_tuple += (file_to_tree[j][9],) #max_con
        temp_tuple += (file_to_tree[j][10],)    #dypd_id
        temp_tuple+=(size,)#20180423 新增索引for排序
        
        jobtask_list.append(temp_tuple) #20181211   傳送到compare[有加排序索引]
        # 20180424測試目前會傳送的list
        jobtask_list1.append(temp_tuple)    #20181211   傳送到ProcessSchedulingOnCylinders[有加排序索引]
        _to_jobtask_list.append(_jobtask)   #20181211   存放待排工單資料(11 columns)
        #填入jobtask_list中  這裡要處理_jobtask要填入最後的temp值再存入List中
        _jobtask=None
        temp_tuple=()
        size-=1
#---------#1101進度設定每缸參數: 輸入(文字顯示區域)，輸出(每缸設定完成相關參數)
def setup_cylinder_params(text):
     #==================清除文字內容==
    clear_listbox_content(cy1_status)
    clear_listbox_content(cy3_status)
    clear_listbox_content(cy5_status)
    clear_listbox_content(cy6_status)
    clear_text_content(text4)
    #================0111:新增相關工單與濃度List(做後續濃度排序與工單顯示使用)
    global cylinder_list
    cylinder_list=[]
    
    global _cy1_list,_cy2_list, _cy3_list
    _cy1_list,_cy2_list, _cy3_list=[],[],[]
   
    global _cy5_list,_cy6_list,_cy7_list
    _cy5_list,_cy6_list,_cy7_list=[],[],[]
 
    global _cy8_list,_cy9_list,_cy10_list
    _cy8_list,_cy9_list,_cy10_list=[],[],[]
    
    
    global _cy11_list,_cy12_list,_cy13_list
    _cy11_list,_cy12_list,_cy13_list=[],[],[]

    global _cy14_list,_cy15_list,_cy16_list
    _cy14_list,_cy15_list,_cy16_list=[],[],[]
    
    
    global _cy17_list,_cy18_list,_cy19_list
    _cy17_list,_cy18_list,_cy19_list=[],[],[]
    
    
    global _cy20_list,_cy21_list,_cy22_list
    _cy20_list,_cy21_list,_cy22_list=[],[],[]
    
    global _cy23_list,_cy24_list,_cy25_list
    _cy23_list,_cy24_list,_cy25_list=[],[],[]

    global _cy26_list,_cy32_list,_cy100_list
    _cy26_list,_cy32_list,_cy100_list=[],[],[]

    global temp_cylinder1,temp_cylinder2,temp_cylinder3
    global temp_cylinder5, temp_cylinder6, temp_cylinder7
    global temp_cylinder8, temp_cylinder9, temp_cylinder10
    global temp_cylinder11, temp_cylinder12, temp_cylinder13
    global temp_cylinder14, temp_cylinder15, temp_cylinder16
    global temp_cylinder17, temp_cylinder18, temp_cylinder19
    global temp_cylinder20, temp_cylinder21, temp_cylinder22
    global temp_cylinder23, temp_cylinder24, temp_cylinder25
    global temp_cylinder26, temp_cylinder32, temp_cylinder100

    #0111:每缸的設定，各參數 1:缸號, 'B':固定染色號, 500:投胚量, 3200:碼長, _cy1_list:用來儲存(工單,總濃度) tuple的list，用來作之後顯示與排序使用。
    temp_cylinder1=cylinder(1, 'B', 500, 3200,_cy1_list,False)
    setup_cyparams_to_listbox(cy1_status,temp_cylinder1)
    #----------------------------------------
    temp_cylinder2=cylinder(2, '', 20, 80,_cy2_list,False)
    setup_cyparams_to_listbox(cy2_status,temp_cylinder2)
    #--------------------------------------
    temp_cylinder3=cylinder(3, '', 150, 500,_cy3_list,False)
    setup_cyparams_to_listbox(cy3_status,temp_cylinder3)
    #-----------------------------------------
    temp_cylinder5=cylinder(5, '', 500, 3200,_cy5_list,False)
    setup_cyparams_to_listbox(cy5_status,temp_cylinder5)
    
    temp_cylinder6=cylinder(6, '', 500, 3200,_cy6_list,False)
    setup_cyparams_to_listbox(cy6_status,temp_cylinder6)
    
    temp_cylinder7=cylinder(7, 'B', 1000, 6400,_cy7_list,False)
    setup_cyparams_to_listbox(cy7_status,temp_cylinder7)
    
    temp_cylinder8=cylinder(8, '', 150, 500,_cy8_list,False)
    setup_cyparams_to_listbox(cy8_status,temp_cylinder8)
    
    temp_cylinder9=cylinder(9, 'W', 1000, 6400,_cy9_list,False)
    setup_cyparams_to_listbox(cy9_status,temp_cylinder9)
    
    temp_cylinder10=cylinder(10, 'B', 500, 3200,_cy10_list,False)
    setup_cyparams_to_listbox(cy10_status,temp_cylinder10)
    
    temp_cylinder11=cylinder(11, '', 500, 3200,_cy11_list,False)
    setup_cyparams_to_listbox(cy11_status,temp_cylinder11)
    
    temp_cylinder12=cylinder(12, '', 500, 3200,_cy12_list,False)
    setup_cyparams_to_listbox(cy12_status,temp_cylinder12)
    
    
    temp_cylinder13=cylinder(13, 'W', 500, 3200,_cy13_list,False)
    setup_cyparams_to_listbox(cy13_status,temp_cylinder13)
    
    temp_cylinder14=cylinder(14, '', 100, 500,_cy14_list,False)
    setup_cyparams_to_listbox(cy14_status,temp_cylinder14)
    
    temp_cylinder15=cylinder(15, '', 500, 3200,_cy15_list,False)
    setup_cyparams_to_listbox(cy15_status,temp_cylinder15)
    
    temp_cylinder16=cylinder(16, '', 20, 80,_cy16_list,False)
    setup_cyparams_to_listbox(cy16_status,temp_cylinder16)
    
    temp_cylinder17=cylinder(17, '', 20, 80,_cy17_list,False)
    setup_cyparams_to_listbox(cy17_status,temp_cylinder17)
    
    temp_cylinder18=cylinder(18, '', 20, 80,_cy18_list,False)
    setup_cyparams_to_listbox(cy18_status,temp_cylinder18)
    
    temp_cylinder19=cylinder(19, 'B', 500, 3200,_cy19_list,False)
    setup_cyparams_to_listbox(cy19_status,temp_cylinder19)
    
    temp_cylinder20=cylinder(20, '', 300, 1600,_cy20_list,False)
    setup_cyparams_to_listbox(cy20_status,temp_cylinder20)
    
    
    temp_cylinder21=cylinder(21, '', 300, 1600,_cy21_list,False)
    setup_cyparams_to_listbox(cy21_status,temp_cylinder21)
    
    temp_cylinder22=cylinder(22, '', 300, 1600,_cy22_list,False)
    setup_cyparams_to_listbox(cy22_status,temp_cylinder22)
    
    temp_cylinder23=cylinder(23, '', 300, 1600,_cy23_list,False)
    setup_cyparams_to_listbox(cy23_status,temp_cylinder23)
    
    
    temp_cylinder24=cylinder(24, '', 200, 500,_cy24_list,False)
    setup_cyparams_to_listbox(cy24_status,temp_cylinder24)
    
    temp_cylinder25=cylinder(25, '', 150, 500,_cy25_list,False)
    setup_cyparams_to_listbox(cy25_status,temp_cylinder25)
    
    temp_cylinder26=cylinder(26, '', 500, 3200,_cy26_list,False)
    setup_cyparams_to_listbox(cy26_status,temp_cylinder26)
    
    temp_cylinder32=cylinder(32, '', 100, 500,_cy32_list,False)
    setup_cyparams_to_listbox(cy32_status,temp_cylinder32)
    
    #暫時先設立一個100號缸:處理相關未排進去的工單號碼
    temp_cylinder100=cylinder(100, '', 0, 0,_cy100_list,False)
    #setup_cyparams_to_listbox(listbox_temp,temp_cylinder100)
    
    cylinder_list.append(temp_cylinder1)
    cylinder_list.append(temp_cylinder2)
    cylinder_list.append(temp_cylinder3)
    cylinder_list.append(temp_cylinder5)
    cylinder_list.append(temp_cylinder6)
    cylinder_list.append(temp_cylinder7)
    cylinder_list.append(temp_cylinder8)
    cylinder_list.append(temp_cylinder9)
    cylinder_list.append(temp_cylinder10)
    cylinder_list.append(temp_cylinder11)
    cylinder_list.append(temp_cylinder12)
    cylinder_list.append(temp_cylinder13)
    cylinder_list.append(temp_cylinder14)
    cylinder_list.append(temp_cylinder15)
    cylinder_list.append(temp_cylinder16)
    cylinder_list.append(temp_cylinder17)
    cylinder_list.append(temp_cylinder18)
    cylinder_list.append(temp_cylinder19)
    cylinder_list.append(temp_cylinder20)
    cylinder_list.append(temp_cylinder21)
    cylinder_list.append(temp_cylinder22)
    cylinder_list.append(temp_cylinder23)
    cylinder_list.append(temp_cylinder24)
    cylinder_list.append(temp_cylinder25)
    cylinder_list.append(temp_cylinder26)
    cylinder_list.append(temp_cylinder32)
    #設立第100號缸，處理未排入上述缸號的相關工單號碼
    cylinder_list.append(temp_cylinder100)
    text4.insert(END,"各缸參數已設定完成")
#--------------#回傳每缸參數:輸入(顯示格式，缸資料物件)，輸出(每缸設定好參數文字)
def setup_cyparams_to_listbox(listbox, _temp_cylinder):#進行設定每缸參數
    listbox.insert(1, "缸號: "+str(_temp_cylinder.get_cylinder_no()))
    listbox.insert(2,"染色號: "+str(_temp_cylinder.get_dying_color_name()))
    listbox.insert(3,"缸容量: "+str(_temp_cylinder.get_weight())+"Kg")
    listbox.insert(4,"碼長: "+str(_temp_cylinder.get_yard_length())+"")
    listbox.insert(5,"缸容量(80%): "+str(_temp_cylinder.get_weight()*0.8)+"Kg")
#---#進行工單負荷平均排缸派遣動作:輸入(缸list，工單資料list)，輸出(目前已經排好第一輪的工單資料，尚未有最小清缸化資料)
def ProcessSchedulingOnCylinders(_rec_cylinderlists, _schedule_list):
    #目前各缸資訊物件list <cylinder.cylinder object at 0x000000000B6B41D0> x27[缸容 碼長]
    global processing_cylinder_list
    global processing_cylinder_list1
    processing_cylinder_list=[]
    processing_cylinder_list1=[]
    processing_cylinder_list=_rec_cylinderlists     #20181218   processing_cylinder_list 染缸規格資料
    processing_cylinder_list1=_rec_cylinderlists    #20181218   processing_cylinder_list1 染缸規格資料

    global _rec_jobtask_list
    _rec_jobtask_list=[]
    _rec_jobtask_list=_schedule_list    #20181218   _rec_jobtask_list 待排工單資料(有加索引 3XX筆)

    global job_counter#0117:紀錄工單筆數counter
    job_counter=0

    i=0
    j=0
    global Unable_Schedule_List
    Unable_Schedule_List=[]#儲存投胚量為0的工單編號list
    for i,item in enumerate(_rec_jobtask_list): #enumerate=>index運用需求
        #20181220   新增temp_clr, temp_max_con, temp_dypd
        temp_yard=0.0
        temp_qty=0.0
        temp_total_com=0.0
        temp_max_con=0.0
        
        temp_no=_rec_jobtask_list[i][0]#工單號
        temp_od_no=_rec_jobtask_list[i][1]#訂單號:未來可做缸號工單比對(可把相同工單排在一起)
        temp_clr=_rec_jobtask_list[i][2]#色號
        temp_qty=float(_rec_jobtask_list[i][3])#投胚量
        temp_yard=float(_rec_jobtask_list[i][4])#碼長
        #20180607 濃度取小數點後面兩位
        temp_total_com1=_rec_jobtask_list[i][8]#取得最後總濃度
        temp_total_com=round(temp_total_com1, 2)
        temp_max_con1=_rec_jobtask_list[i][9]#取得最大濃度
        temp_max_con=round(temp_max_con1, 2)
        temp_dypd=_rec_jobtask_list[i][10]#取得最大濃度配方號
        #201901014  新增待排工單位置
        temp_index3=i

        # 20180314  投胚量小於等於0或大於1000  小於等於0或大於6400的碼長，通通抓近來
        if temp_qty<=0.0 or temp_qty>1000 or temp_yard<=0.0 or temp_yard>6400  :
            Unable_Schedule_List.append(temp_no)#紀錄有幾筆工單的投胚量為0或是碼常大於6400的工單，排入此無法安排的List中，之後自動排缸玩會顯示出來相關工單。
            continue
        else:
            print('------------------------------') 
            print('工單號%s' %temp_no)
            cyfound_index=0
            #0110進行排缸: 傳入(工單號，訂單號，色號，總濃度，碼長，投胚量，最大濃度，最大濃度配方號，待排工單位置，處理的總缸List，暫存區List)，傳出cyfound_index(目前所排缸號)
            cyfound_index=Find_Best_Cylinder_To_Schedule(temp_no,temp_od_no,temp_clr,temp_total_com,temp_yard,temp_qty,temp_max_con,temp_dypd,temp_index3,processing_cylinder_list,recyce_list)
            job_counter+=1
            print('目前所排的工單筆數為第%s筆' %job_counter)
    #-===============
    global load_balance_list#0118:紀錄需要啟動負載平衡的工單List
    load_balance_list=[]
    _final_result=False
    _final_result=Find_the_temp_job_to_schedule(recyce_list,processing_cylinder_list,load_balance_list)
    if _final_result:
       print('暫存區工單已經排入完畢')
       recyce_list.clear()
    #原來顯示function為下面，但目前已經不使用。故註解起來
    #print_each_cylinder_queue(processing_cylinder_list[0].queue,cy1_schedule)
    global pcl
    pcl=0

    #20180625   顯示每缸排缸數量
    cy1_lb1 = ttk.Label(frame, text='1號缸'+'             共'+str(len(processing_cylinder_list[0].get_cylinder_con_list()))+'筆', background='yellow')
    cy1_lb1.place(x=5, y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy2_lb1 = ttk.Label(frame, text='2號缸'+'             共'+str(len(processing_cylinder_list[1].get_cylinder_con_list()))+'筆', background='yellow')
    cy2_lb1.place(x=int(325 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy3_lb1 = ttk.Label(frame, text='3號缸'+'             共'+str(len(processing_cylinder_list[2].get_cylinder_con_list()))+'筆', background='yellow')
    cy3_lb1.place(x=int(645 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy5_lb1 = ttk.Label(frame, text='5號缸'+'             共'+str(len(processing_cylinder_list[3].get_cylinder_con_list()))+'筆', background='yellow')
    cy5_lb1.place(x=int(965 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy6_lb1 = ttk.Label(frame, text='6號缸'+'             共'+str(len(processing_cylinder_list[4].get_cylinder_con_list()))+'筆', background='yellow')
    cy6_lb1.place(x=int(1285 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy7_lb1 = ttk.Label(frame, text='7號缸(黑)'+'      共'+str(len(processing_cylinder_list[5].get_cylinder_con_list()))+'筆', background='yellow')
    cy7_lb1.place(x=int(1605 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy8_lb1 = ttk.Label(frame, text='8號缸'+'             共'+str(len(processing_cylinder_list[6].get_cylinder_con_list()))+'筆', background='yellow')
    cy8_lb1.place(x=5, y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy9_lb1 = ttk.Label(frame, text='9號缸(白)'+'      共'+str(len(processing_cylinder_list[7].get_cylinder_con_list()))+'筆', background='yellow')
    cy9_lb1.place(x=int(325 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy10_lb1 = ttk.Label(frame, text='10號缸(黑)'+'    共'+str(len(processing_cylinder_list[8].get_cylinder_con_list()))+'筆', background='yellow')
    cy10_lb1.place(x=int(645 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy11_lb1 = ttk.Label(frame, text='11號缸'+'           共'+str(len(processing_cylinder_list[9].get_cylinder_con_list()))+'筆', background='yellow')
    cy11_lb1.place(x=int(965 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy12_lb1 = ttk.Label(frame, text='12號缸'+'           共'+str(len(processing_cylinder_list[10].get_cylinder_con_list()))+'筆', background='yellow')
    cy12_lb1.place(x=int(1285 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy13_lb1 = ttk.Label(frame, text='13號缸(白)'+'    共'+str(len(processing_cylinder_list[11].get_cylinder_con_list()))+'筆', background='yellow')
    cy13_lb1.place(x=int(1605 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy14_lb1 = ttk.Label(frame, text='14號缸'+'           共'+str(len(processing_cylinder_list[12].get_cylinder_con_list()))+'筆', background='yellow')
    cy14_lb1.place(x=5, y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy15_lb1 = ttk.Label(frame, text='15號缸'+'           共'+str(len(processing_cylinder_list[13].get_cylinder_con_list()))+'筆', background='yellow')
    cy15_lb1.place(x=int(325 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy16_lb1 = ttk.Label(frame, text='16號缸'+'           共'+str(len(processing_cylinder_list[14].get_cylinder_con_list()))+'筆', background='yellow')
    cy16_lb1.place(x=int(645 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy17_lb1 = ttk.Label(frame, text='17號缸'+'           共'+str(len(processing_cylinder_list[15].get_cylinder_con_list()))+'筆', background='yellow')
    cy17_lb1.place(x=int(965 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy18_lb1 = ttk.Label(frame, text='18號缸'+'           共'+str(len(processing_cylinder_list[16].get_cylinder_con_list()))+'筆', background='yellow')
    cy18_lb1.place(x=int(1285 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy19_lb1 = ttk.Label(frame, text='19號缸(黑)'+'    共'+str(len(processing_cylinder_list[17].get_cylinder_con_list()))+'筆', background='yellow')
    cy19_lb1.place(x=int(1605 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy20_lb1 = ttk.Label(frame, text='20號缸'+'           共'+str(len(processing_cylinder_list[18].get_cylinder_con_list()))+'筆', background='yellow')
    cy20_lb1.place(x=5, y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy21_lb1 = ttk.Label(frame, text='21號缸'+'           共'+str(len(processing_cylinder_list[19].get_cylinder_con_list()))+'筆', background='yellow')
    cy21_lb1.place(x=int(325 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy22_lb1 = ttk.Label(frame, text='22號缸'+'           共'+str(len(processing_cylinder_list[20].get_cylinder_con_list()))+'筆', background='yellow')
    cy22_lb1.place(x=int(645 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy23_lb1 = ttk.Label(frame, text='23號缸'+'           共'+str(len(processing_cylinder_list[21].get_cylinder_con_list()))+'筆', background='yellow')
    cy23_lb1.place(x=int(965 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy24_lb1 = ttk.Label(frame, text='24號缸'+'           共'+str(len(processing_cylinder_list[22].get_cylinder_con_list()))+'筆', background='yellow')
    cy24_lb1.place(x=int(1285 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy25_lb1 = ttk.Label(frame, text='25號缸'+'           共'+str(len(processing_cylinder_list[23].get_cylinder_con_list()))+'筆', background='yellow')
    cy25_lb1.place(x=int(1605 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy26_lb1 = ttk.Label(frame, text='26號缸'+'           共'+str(len(processing_cylinder_list[24].get_cylinder_con_list()))+'筆', background='yellow')
    cy26_lb1.place(x=int(1605 * w1), y=0, width=int(150 * w1), height=int(40 * h1))

    cy32_lb1 = ttk.Label(frame, text='32號缸'+'           共'+str(len(processing_cylinder_list[25].get_cylinder_con_list()))+'筆', background='yellow')
    cy32_lb1.place(x=int(1605 * w1), y=int(130 * h1), width=int(150 * w1), height=int(40 * h1))

    # 20180717   暫時區背景修改成紅色
    cy100_lb1 = ttk.Label(frame, text='暫時區(100)'+'       共'+str(len(recyce_list))+'筆', background='red')
    cy100_lb1.place(x=int(1415 * w1), y=int(115 * h1), width=int(180 * w1), height=int(40 * h1))

    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[0].get_cylinder_con_list(),cy1_schedule)
    pcl=pcl+1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[1].get_cylinder_con_list(),cy2_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[2].get_cylinder_con_list(),cy3_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[3].get_cylinder_con_list(),cy5_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[4].get_cylinder_con_list(),cy6_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[5].get_cylinder_con_list(),cy7_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[6].get_cylinder_con_list(),cy8_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[7].get_cylinder_con_list(),cy9_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[8].get_cylinder_con_list(),cy10_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[9].get_cylinder_con_list(),cy11_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[10].get_cylinder_con_list(),cy12_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[11].get_cylinder_con_list(),cy13_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[12].get_cylinder_con_list(),cy14_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[13].get_cylinder_con_list(),cy15_schedule)

    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[14].get_cylinder_con_list(),cy16_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[15].get_cylinder_con_list(),cy17_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[16].get_cylinder_con_list(),cy18_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[17].get_cylinder_con_list(),cy19_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[18].get_cylinder_con_list(),cy20_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[19].get_cylinder_con_list(),cy21_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[20].get_cylinder_con_list(),cy22_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[21].get_cylinder_con_list(),cy23_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[22].get_cylinder_con_list(),cy24_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[23].get_cylinder_con_list(),cy25_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[24].get_cylinder_con_list(),cy26_schedule)
    pcl = pcl + 1
    print_scheduled_jobno_for_each_cylinder(processing_cylinder_list[25].get_cylinder_con_list(),cy32_schedule)
    pcl = pcl + 1
    #0111:這邊顯示戰存區相關工單與濃度資料
    print_scheduled_jobno_for_each_cylinder(recyce_list,listbox_temp)
    pcl = 0
   #===============以下顯示目前工單投胚量為0的部分===
    clear_text_content(text4)
    text4.insert(tkinter.INSERT,"目前投胚量為0的工單共有"+str(len(Unable_Schedule_List))+"筆，如下\n")
    qty_zero_size=0
    qty_zero_size=len(Unable_Schedule_List)
    index=0
    for index in range(qty_zero_size):
        text4.insert(tkinter.INSERT,str(Unable_Schedule_List[index])+"\n")
    log.info("自動排缸流程完畢")
#=============0116:去找入相關暫存區待排工單，輸入(工單資料list，缸list， 需要待排的資料List)，輸出(有找到為True，沒有找到為False)
def Find_the_temp_job_to_schedule(_recy_list, _rec_pro_list,load_balance_list):
    global _temp_recy_list,final_result,counter_temp_recy_list
    _temp_recy_list=[]
    final_result=False
    counter_temp_recy_list=0
    
    _temp_recy_list=_recy_list
    size_temp_recy_list=0
    size_temp_recy_list=len(_recy_list)
    
    size_process_list=len(_rec_pro_list)
    index=0
    for index in range(size_process_list):
        _temp_list=[]
        _temp_list=_rec_pro_list[index].get_cylinder_con_list()#取得目前排入list
        result=False
        
        result=List_tuple_compare(_recy_list,_temp_list, _rec_pro_list[index].get_cylinder_no())
        
        if result>0:
          counter_temp_recy_list+=result
        else:
          continue
    if  counter_temp_recy_list==len(_recy_list):
       final_result=True
    
    return final_result
#============0116List_tuple_compare: list中的資料比較: 輸入(排序的List1，被找尋List2，被找尋的工單號碼)  
def List_tuple_compare(_from_list, _to_list,_rec_pro_cylist_index):
    global counter
    counter=0
    size_from_list=0
    size_from_list=len(_from_list)
    size_to_list=0
    size_to_list=len(_to_list)
    i=0
    j=0
    for i in range(size_from_list):
        _temp_to_schedule_jobno=''
        _temp_to_schedule_jobno=_from_list[i][0]
        for j in range(size_to_list):
            _temp_scheduled_jobno=''
            _temp_scheduled_jobno=_to_list[j][0]
            if _temp_to_schedule_jobno==_temp_scheduled_jobno:
                counter+=1
                _tuple=()
                _tuple+=(_temp_to_schedule_jobno,)
                _tuple+=(_rec_pro_cylist_index,)
                load_balance_list.append(_tuple)
                break
            else:
                continue

    return counter

#============0110 去找出最符合的缸號，並排入缸號與回傳缸號號碼:
# 輸入(被找尋工單號，被找尋訂單號，被找尋色號，被找尋總濃度，被找尋碼長，被找尋投胚量，被找尋最大濃度，被找尋最大濃度配方號，待排工單位置，處理總缸list，回收List)，輸出(相關缸號物件)
def Find_Best_Cylinder_To_Schedule(_test_no, _temp_od_no, _temp_clr, _test_con, _test_yard, _test_qty, _temp_max_con, _temp_dypd, _temp_index3, _processing_cylinder_list,_recyce_list):
    global _diff_list
    _diff_list=[]
    global _temp_tuple
    global _diff_yard
    global _diff_total  #20190108   新增總濃度差距
    #global _original_list
    #_original_list=[]
    global  _dispatched_cylinder
    _dispatched_cylinder = ""
    _test_mach_compare1 = ""
    #201901017  新增已排缸註記
    global _dispatched_flag
    _dispatched_flag = ""
    global list1, list1_1
    global list2, list2_1
    global list3, list3_1
    global list4, list4_1
    global list5, list5_1
    list1=[]
    list2 = []
    list3 = []
    list4 = []
    list5 = []
    list1_1 = []
    list2_1 = []
    list3_1 = []
    list4_1 = []
    list5_1 = []

    #0112 added:新增分類list，分群list進行分類演算法
    #===============1. 先去找屬於那種(投胚量，碼長)分類，找到分類後，去找下面的各缸random去填入缸中，如果缸滿了，則式進行負載平衡，去找其他缸，或是往下一層去找
    #20181226   判斷是否有前缸資料
    dbindex1 = ""
    dbindex1 = db_file_object.get_dbrecordindex()
    global dist2  # 20181206 前一缸資料撈取集合
    dist2 = []
    dist2 = fetch_dyeing_data_with_Before(server_name, db_name, user, password, dbindex1, db_file_object)
    if dist2 is None:
        cy_category_list_size = len(cy_category_list)  #20181220   cy_category_list_size染缸種類   7
        j = 0
        category_index = 0
        for j in range(cy_category_list_size):
            _temp_tuple = ()

            _diff_yard = 0
            _diff_qty = 0
            _cate_cy_no = 0

            _each_cy_qty = cy_category_list[j][0]  # 取出qty投胚量
            _each_cy_yard = cy_category_list[j][1]  # 取出碼長

            _diff_qty = _each_cy_qty - _test_qty  # 計算每一個投胚量差距
            _diff_yard = _each_cy_yard - _test_yard  # 計算每一個碼長差距
            _cate_cy_no = category_index  # 分類編號

            _temp_tuple += (_diff_qty,)
            _temp_tuple += (_diff_yard,)
            _temp_tuple += (_cate_cy_no,)

            _diff_list.append(_temp_tuple)
            #_original_list.append(_temp_tuple)
            category_index += 1
        # 先過濾有負號(小於0)的元素[0]，再過濾有負號(小於0)的元素[1]
        global _diff_list_minus_0_list
        _diff_list_minus_0_list = [i for i in _diff_list if i[0] >= 0]

        global _diff_list_minus_1_list
        _diff_list_minus_1_list = [i for i in _diff_list_minus_0_list if i[1] >= 0]
        _diff_list_minus_1_list = sorted(_diff_list_minus_1_list, key=operator.itemgetter(1, 2))
        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。

        global _result_class
        _result_class = 0
        i = 0
        j = 0

        print(_diff_list_minus_1_list)  #20181225   顯示符合規格的染缸類別
        #20181225   取出預排入染缸類別_result_class
        for j in range(0, len(_diff_list_minus_1_list)):
            _testing_qty = _diff_list_minus_1_list[j][0]
            if _testing_qty >= 0:
                if len(_diff_list_minus_1_list) == 1:
                    _result_class = _diff_list_minus_1_list[j][2]
                elif j + 1 < len(_diff_list_minus_1_list):
                    if _testing_qty <= _diff_list_minus_1_list[j + 1][0]:
                        _result_class = _diff_list_minus_1_list[j][2]  # 1
                        break
            else:
                continue
                # =================================================

        # ==================2. 找出分類中的第幾號缸，排入缸中
        global _dispatched_group, _dispatched_ptr
        _dispatched_group = ()
        _dispatched_group = cy_group_list[_result_class]  # (14,32)
        _dispatched_ptr = cy_ptr_list[_result_class]  # 0

        print(_dispatched_ptr)
        print(len(_dispatched_group))

        # 20181225   避免_dispatched_ptr超過染缸群組大小出錯
        if _dispatched_ptr < len(_dispatched_group):
            _dispatched_cylinder = _dispatched_group[_dispatched_ptr]
        else:
            _dispatched_ptr = _dispatched_ptr % len(cy_group_list[_result_class])
            _dispatched_cylinder = _dispatched_group[_dispatched_ptr]

        print('選擇到的缸分類為第%s類第%s缸' % (_result_class, _dispatched_cylinder))
        # 0112:這邊去更新ptr指標
        _dispatched_ptr += 1
        cy_ptr_list[_result_class] = _dispatched_ptr  # 寫回PTR目前缸指標記錄

        i = 0
        k = 0
        for i in range(0, len(_processing_cylinder_list)):                  #20181226   從缸號1~100，共27個
            _temp_cy_no = _processing_cylinder_list[i].get_cylinder_no()
            if _dispatched_cylinder == _temp_cy_no:

                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                queue_flag = False
                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                    # 0115:這邊要去設定queue flag
                    queue_size = 0
                    queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                    if queue_size >= 8:  # 20180621 如果大於8張工單，則進行過載平衡
                        print(u'預排入缸容量已滿')
                        print('=========過載平衡啟動=====================')
                        _processing_cylinder_list[i].set_queue_full_flag(True)
                        print('No. %s class %s work_id doing load balancing' % (_result_class, _test_no))
                        load_balance(_test_con, _dispatched_cylinder, _result_class, _test_no, _processing_cylinder_list, cy_group_list, cy_ptr_list)
                        _dispatched_flag='Y'
                        print(u'=========過載平衡執行完畢==================')
                        break
                    else:  # 排入缸中的queue與list，通常list會放入tuple(工單號，濃度)，此樣想法為之後，移動工單或是排序工單可以使用，而非放入queue中(因queue中只會放入工單號，並不會放入濃度，因此為了後續的排缸與濃度排序使用，我新增了set_cylinder_con_list與get_cylinder_con_lis來放入tuple(工單號，濃度)，方便後續寫程式的快速性。而非用啥理論的queue，queue資料結構是好用，但是要搭配實際情況。
                        # 你也可以把工單整個物件放進來queue中，這樣方式也可以，但是我覺得光是要比較濃度後去移動物件，可能也要花不少時間，看你之後的需求為何
                        _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                        # 0111:紀錄工單與濃度list中
                        _temp_jobno_con_tuple += (_test_no,)
                        _temp_jobno_con_tuple += (_test_con,)
                        _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                        _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                        if _test_no != None:
                            temp_tuple2 = search_tuple_from_joblist(_test_no, _to_jobtask_list) #20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                            if temp_tuple2 != None:
                                if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                    tmp_mach = 'D0'+str(_processing_cylinder_list[i].get_cylinder_no())
                                else:
                                    tmp_mach = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                cnxn7 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                cursor7 = cnxn7.cursor()  # server 位置: 172.16.41.23
                                # 20181226  排完缸後，將結果回寫到schedule_before
                                cursor7.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",temp_tuple2[0], temp_tuple2[1], temp_tuple2[2], temp_tuple2[3], temp_tuple2[4], temp_tuple2[8],temp_tuple2[9], temp_tuple2[10], tmp_mach)
                                cnxn7.commit()

                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                        print(u"工單號 %s 已排入第%s分類 第%s缸中" % (_test_no, _result_class, _processing_cylinder_list[i].get_cylinder_no()))
                        _dispatched_flag = 'Y'
                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                        if len(_temp_jobno_con_list) >= 8:
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                        break
                else:  # 要排的缸已經滿了，則是啟動過載平衡機制，去找下一層缸排入
                    print('預排入缸容量已滿')
                    print('==========過載平衡啟動==============')
                    _processing_cylinder_list[i].set_queue_full_flag(True)
                    print('第%s分類 %s 工單號 執行load負載平衡' % (_result_class, _test_no))
                    load_balance(_test_con, _dispatched_cylinder, _result_class, _test_no, _processing_cylinder_list, cy_group_list, cy_ptr_list)
                    _dispatched_flag = 'Y'
                    print('==========過載平衡執行完畢===========')
                    break
            else:
                continue
    else:
        print('即時前缸資料共抓入%s筆' % str(len(dist2)))
        dist2_size = len(dist2)
        j = 0
        print('目標色號%s' % (_temp_clr))
        print('目標投胚量%s' % (_test_qty))
        print('目標碼長%s' % (_test_yard))
        #20181226   先比較色號(找到相同色號後，確認規格是否符合[由缸號反推群組再相減]，再取前缸號，丟入目標缸，滿了再啟動load_balance)
        for j in range(dist2_size):
            _temp_no_compare = dist2[j][0]
            _temp_od_no_compare = dist2[j][1]
            _temp_clr_compare = dist2[j][2]
            _temp_qty_compare = dist2[j][3]
            _temp_yard_compare = dist2[j][4]
            #20190107   取小數點後2位
            _temp_total_compare = round(dist2[j][5],2)
            _temp_max_compare = round(dist2[j][6],2)
            _temp_dypd_compare = dist2[j][7]
            #20190107   去空白取得實際長度
            _temp_mach_compare_temp = dist2[j][8]
            _temp_mach_compare = _temp_mach_compare_temp.strip()
            _temp_dypd_clr = _temp_dypd[1:2]
            _temp_dypd_fabric = _temp_dypd[0:1]
            _temp_dypd_clr_compare = _temp_dypd_compare[1:2]
            _temp_dypd_fabric_compare = _temp_dypd_compare[0:1]
            print('前缸色號%s' % (_temp_clr_compare))
            #20190104   同色號
            if _temp_clr == _temp_clr_compare:
                #20181227   取出前缸號
                if len(_temp_mach_compare) == 3:
                    _test_mach_compare1 = _temp_mach_compare[1:]
                else:
                    _test_mach_compare1 = _temp_mach_compare[2:]
                i = 0
                print('1前缸號%s' % (_test_mach_compare1))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(_test_mach_compare1) == int(_temp_cy_no1):
                        #20181227   比較是否符合規格
                        temp_qty1 = _processing_cylinder_list[i].get_weight()
                        temp_yard1 = _processing_cylinder_list[i].get_yard_length()
                        if (_temp_qty_compare <= temp_qty1) and (_temp_yard_compare <= temp_yard1):
                            #20181227   依投胚量區分類別(共7類)
                            _result_class = 0
                            if temp_qty1 == 100:
                                _result_class = 1
                            elif temp_qty1 == 150:
                                _result_class = 2
                            elif temp_qty1 == 200:
                                _result_class = 3
                            elif temp_qty1 == 300:
                                _result_class = 4
                            elif temp_qty1 == 500:
                                _result_class = 5
                            elif temp_qty1 == 1000:
                                _result_class = 6
                            print('_result_class1=%s' % (_result_class))

                            #20181228   修正滿缸不進load balance，改比較訂單...
                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                            queue_flag = False
                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()
                            #20190104   查看queue_flag
                            print('queue_flag1:%s' %(queue_flag))

                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                # 0115:這邊要去設定queue flag
                                queue_size = 0
                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                    print(u'預排入缸容量已滿1')
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                    print('前缸色號1%s' % (_temp_clr_compare))
                                    break
                                else:
                                    _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                    # 0111:紀錄工單與濃度list中
                                    _temp_jobno_con_tuple += (_test_no,)
                                    _temp_jobno_con_tuple += (_test_con,)
                                    _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                    _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                    if _test_no != None:
                                        temp_tuple4 = search_tuple_from_joblist(_test_no,_to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                        if temp_tuple4 != None:
                                            if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            else:
                                                tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                            # 20181226   刪除schedule_before資料
                                            cnxn9 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                            cursor9.execute("delete from schedule_before where mach_id in ('%s','%s')" % (tmp_mac3,tmp_mac4))
                                            cnxn9.commit()

                                            cnxn8 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                            cursor8.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],temp_tuple4[4], temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],tmp_mac3)
                                            cnxn8.commit()

                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                    print(u"工單號 %s 已排入第%s分類 第%s缸中1" % (_test_no, _result_class, _processing_cylinder_list[i].get_cylinder_no()))
                                    _dispatched_flag = 'N'
                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                    if len(_temp_jobno_con_list) >= 8:
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                    break
                            else:
                                print('預排入缸容量已滿2')
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                print('前缸色號3%s' % (_temp_clr_compare))
                                break
                        else:
                            print('前缸色號4%s' % (_temp_clr_compare))
                            break
                    else:
                        continue
                #201901017  已排缸後，跳出第二層for迴圈
                if _dispatched_flag == 'N':
                    print('前缸色號5%s' % (_temp_clr_compare))
                    break
            else:   #20190104   不同色號
                # 20181227   取出前缸號
                if len(_temp_mach_compare) == 3:
                    _test_mach_compare1 = _temp_mach_compare[1:]
                else:
                    _test_mach_compare1 = _temp_mach_compare[2:]
                if _temp_od_no == _temp_od_no_compare:  #20190104   同訂單
                    if _temp_dypd_clr == _temp_dypd_clr_compare:    #20190104   同訂單同色系
                        i = 0
                        print('2前缸號%s' % (_test_mach_compare1))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(_test_mach_compare1) == int(_temp_cy_no1):
                                # 20181227   比較是否符合規格
                                temp_qty1 = _processing_cylinder_list[i].get_weight()
                                temp_yard1 = _processing_cylinder_list[i].get_yard_length()
                                if (_temp_qty_compare <= temp_qty1) and (_temp_yard_compare <= temp_yard1):
                                    if _temp_dypd_fabric == _temp_dypd_fabric_compare:
                                        # 20181227   依投胚量區分類別(共7類)
                                        _result_class = 0
                                        if temp_qty1 == 100:
                                            _result_class = 1
                                        elif temp_qty1 == 150:
                                            _result_class = 2
                                        elif temp_qty1 == 200:
                                            _result_class = 3
                                        elif temp_qty1 == 300:
                                            _result_class = 4
                                        elif temp_qty1 == 500:
                                            _result_class = 5
                                        elif temp_qty1 == 1000:
                                            _result_class = 6
                                        print('_result_class2=%s' % (_result_class))

                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()
                                        # 20190104   查看queue_flag
                                        print('queue_flag2:%s' % (queue_flag))

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿3')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                print('前缸色號6%s' % (_temp_clr_compare))
                                                break
                                            else:
                                                _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,_to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute("delete from schedule_before where mach_id in ('%s','%s')" % (tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],temp_tuple4[3], temp_tuple4[4], temp_tuple4[8],temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                print(u"工單號 %s 已排入第%s分類 第%s缸中2" % (_test_no, _result_class,_processing_cylinder_list[i].get_cylinder_no()))
                                                _dispatched_flag = 'N'
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                print('前缸色號7%s' % (_temp_clr_compare))
                                                break
                                        else:
                                            print('預排入缸容量已滿4')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            print('前缸色號8%s' % (_temp_clr_compare))
                                            break
                                    else:
                                        if (_temp_dypd_fabric_compare=='N') and (_temp_dypd_fabric=='T'):
                                            # 20181227   依投胚量區分類別(共7類)
                                            _result_class = 0
                                            if temp_qty1 == 100:
                                                _result_class = 1
                                            elif temp_qty1 == 150:
                                                _result_class = 2
                                            elif temp_qty1 == 200:
                                                _result_class = 3
                                            elif temp_qty1 == 300:
                                                _result_class = 4
                                            elif temp_qty1 == 500:
                                                _result_class = 5
                                            elif temp_qty1 == 1000:
                                                _result_class = 6
                                            print('_result_class3=%s' % (_result_class))

                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()
                                            # 20190104   查看queue_flag
                                            print('queue_flag3:%s' % (queue_flag))

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿5')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    print('前缸色號9%s' % (_temp_clr_compare))
                                                    break
                                                else:
                                                    _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,_to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute("delete from schedule_before where mach_id in ('%s','%s')" % (tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],temp_tuple4[3], temp_tuple4[4], temp_tuple4[8],temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s分類 第%s缸中3" % (_test_no, _result_class,_processing_cylinder_list[i].get_cylinder_no()))
                                                    _dispatched_flag = 'N'
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    print('前缸色號10%s' % (_temp_clr_compare))
                                                    break
                                            else:
                                                print('預排入缸容量已滿6')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                print('前缸色號11%s' % (_temp_clr_compare))
                                                break
                                        else:   #20190107   存入list1(工單號, 缸號)
                                            list1_tuple = ()
                                            list1_tuple += (_temp_no_compare,)
                                            list1_tuple += (_test_mach_compare1,)
                                            list1_tuple += (_temp_qty_compare,)
                                            list1_tuple += (_temp_yard_compare,)
                                            list1_tuple += (_temp_total_compare,)
                                            list1_tuple += (_temp_max_compare,)
                                            list1.append(list1_tuple)
                                            print('insert list1,前缸色號12%s' % (_temp_clr_compare))
                                            break
                                else:
                                    print('前缸色號13%s' % (_temp_clr_compare))
                                    break
                            else:
                                continue
                        if _dispatched_flag == 'N':
                            print('前缸色號14%s' % (_temp_clr_compare))
                            break
                    else:   #20190104   同訂單不同色系
                        i = 0
                        print('4前缸號%s' % (_test_mach_compare1))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(_test_mach_compare1) == int(_temp_cy_no1):
                                # 20181227   比較是否符合規格
                                temp_qty1 = _processing_cylinder_list[i].get_weight()
                                temp_yard1 = _processing_cylinder_list[i].get_yard_length()
                                if (_temp_qty_compare <= temp_qty1) and (_temp_yard_compare <= temp_yard1):
                                    list4_tuple = ()
                                    list4_tuple += (_temp_no_compare,)
                                    list4_tuple += (_test_mach_compare1,)
                                    list4_tuple += (_temp_qty_compare,)
                                    list4_tuple += (_temp_yard_compare,)
                                    list4_tuple += (_temp_total_compare,)
                                    list4_tuple += (_temp_max_compare,)
                                    list4.append(list4_tuple)
                                    print('insert list4,前缸色號23%s' % (_temp_clr_compare))
                                    continue
                                else:
                                    print('前缸色號24%s' % (_temp_clr_compare))
                                    continue
                            else:
                                continue
                else:   #20190104   不同訂單
                    if _temp_dypd_clr == _temp_dypd_clr_compare:    #20190106   不同訂單同色系
                        i = 0
                        print('3前缸號%s' % (_test_mach_compare1))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            #print('_test_mach_compare1:%s' % (_test_mach_compare1))
                            if int(_test_mach_compare1) == int(_temp_cy_no1):
                                # 20181227   比較是否符合規格
                                temp_qty1 = _processing_cylinder_list[i].get_weight()
                                temp_yard1 = _processing_cylinder_list[i].get_yard_length()
                                if (_temp_qty_compare <= temp_qty1) and (_temp_yard_compare <= temp_yard1):
                                    if _temp_dypd_fabric == _temp_dypd_fabric_compare:  #20190106   存入list2
                                        list2_tuple = ()
                                        list2_tuple += (_temp_no_compare,)
                                        list2_tuple += (_test_mach_compare1,)
                                        list2_tuple += (_temp_qty_compare,)
                                        list2_tuple += (_temp_yard_compare,)
                                        list2_tuple += (_temp_total_compare,)
                                        list2_tuple += (_temp_max_compare,)
                                        list2.append(list2_tuple)
                                        print('insert list2,前缸色號16%s' % (_temp_clr_compare))
                                        break
                                    else:
                                        if (_temp_dypd_fabric_compare=='N') and (_temp_dypd_fabric=='T'):   #20190106   存入list2
                                            list2_tuple = ()
                                            list2_tuple += (_temp_no_compare,)
                                            list2_tuple += (_test_mach_compare1,)
                                            list2_tuple += (_temp_qty_compare,)
                                            list2_tuple += (_temp_yard_compare,)
                                            list2_tuple += (_temp_total_compare,)
                                            list2_tuple += (_temp_max_compare,)
                                            list2.append(list2_tuple)
                                            print('insert list2_nt,前缸色號17%s' % (_temp_clr_compare))
                                            break
                                        else:   #20190107   存入list3(工單號，缸號)
                                            list3_tuple = ()
                                            list3_tuple += (_temp_no_compare,)
                                            list3_tuple += (_test_mach_compare1,)
                                            list3_tuple += (_temp_qty_compare,)
                                            list3_tuple += (_temp_yard_compare,)
                                            list3_tuple += (_temp_total_compare,)
                                            list3_tuple += (_temp_max_compare,)
                                            list3.append(list3_tuple)
                                            print('insert list3,前缸色號18%s' % (_temp_clr_compare))
                                            break
                                else:
                                    print('前缸色號19%s' % (_temp_clr_compare))
                                    break
                            else:
                                continue
                        if _dispatched_flag == 'N':
                            print('前缸色號20%s' % (_temp_clr_compare))
                            break
                    else:   #20190106   不同訂單不同色系
                        i = 0
                        print('5前缸號%s' % (_test_mach_compare1))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(_test_mach_compare1) == int(_temp_cy_no1):
                                # 20181227   比較是否符合規格
                                temp_qty1 = _processing_cylinder_list[i].get_weight()
                                temp_yard1 = _processing_cylinder_list[i].get_yard_length()
                                if (_temp_qty_compare <= temp_qty1) and (_temp_yard_compare <= temp_yard1):
                                    list5_tuple = ()
                                    list5_tuple += (_temp_no_compare,)
                                    list5_tuple += (_test_mach_compare1,)
                                    list5_tuple += (_temp_qty_compare,)
                                    list5_tuple += (_temp_yard_compare,)
                                    list5_tuple += (_temp_total_compare,)
                                    list5_tuple += (_temp_max_compare,)
                                    list5.append(list5_tuple)
                                    print('insert list5,前缸色號21%s' % (_temp_clr_compare))
                                    continue
                                else:
                                    print('前缸色號22%s' % (_temp_clr_compare))
                                    continue
                            else:
                                continue

    if _dispatched_flag == 'Y':    #20190106   因應不同狀態來reture排定缸號
        print('1排缸%s' % (_dispatched_cylinder))
        return _dispatched_cylinder
    elif _dispatched_flag == 'N':
        print('2排缸%s' % (_test_mach_compare1))
        return _test_mach_compare1
    else:
        if len(list1) == 1:
            i = 0
            print('9前缸號%s' % (list1[0][1]))
            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                if int(list1[0][1]) == int(_temp_cy_no1):
                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                    queue_flag = False
                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                        # 0115:這邊要去設定queue flag
                        queue_size = 0
                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                            print(u'預排入缸容量已滿13')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            print('list1 null -> list2 -> list3')
                            if len(list2) == 1:
                                i = 0
                                print('12前缸號%s' % (list2[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list2[0][1]) == int(_temp_cy_no1):
                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿17')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                print('list2 null -> list3')
                                                if len(list3) == 1:
                                                    i = 0
                                                    print('15前缸號%s' % (list3[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(_processing_cylinder_list[
                                                                                     i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿21')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                                else:
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3=1')
                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(_processing_cylinder_list[
                                                                                               i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4], temp_tuple4[8],
                                                                                    temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                                            _test_no, _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                            else:
                                                                print('預排入缸容量已滿22')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue


                                                elif len(list3) > 1:
                                                    j = 0
                                                    k = 0
                                                    print('list3: %s' % (list3))
                                                    for j in range(len(list3)):
                                                        i = 0
                                                        print('16前缸號%s' % (list3[j][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(_processing_cylinder_list[
                                                                                         i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿23')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                    else:
                                                                        list3_1_tuple = ()
                                                                        list3_1_tuple += (list3[j][0],)
                                                                        list3_1_tuple += (list3[j][1],)
                                                                        list3_1_tuple += (
                                                                        list3[j][5],)  # 20190108   取最大濃度
                                                                        list3_1.append(list3_1_tuple)
                                                                        print('list3_1:%s' % (list3_1))
                                                                        break
                                                                else:
                                                                    print('預排入缸容量已滿24')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                            else:
                                                                continue
                                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                    if k != (j + 1):
                                                        if len(list3_1) > 1:
                                                            j = 0
                                                            _diff_list = []
                                                            for j in range(len(list3_1)):
                                                                _temp_tuple = ()

                                                                _diff_max = 0
                                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                                _diff_max = abs(
                                                                    _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                _temp_tuple += (_diff_max,)
                                                                _temp_tuple += (list3_1[j][1],)
                                                                _temp_tuple += (list3_1[j][0],)

                                                                _diff_list.append(_temp_tuple)
                                                                _diff_list = sorted(_diff_list,
                                                                                    key=operator.itemgetter(0))
                                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                        else:
                                                            _diff_list.append(list3_1_tuple)
                                                        print(_diff_list)
                                                        i = 0
                                                        print('18前缸號%s' % (_diff_list[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3>1')
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3], temp_tuple4[4],
                                                                                temp_tuple4[8], temp_tuple4[9],
                                                                                temp_tuple4[10], tmp_mac3)
                                                                            cnxn8.commit()

                                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                    _dispatched_flag = ''
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue
                                                else:
                                                    _dispatched_flag = 'F'
                                                break
                                            else:
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                temp_tuple4[10], tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s缸中9" % (
                                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    print('list2=1規格不符')
                                                    if len(list3) == 1:
                                                        i = 0
                                                        print('15前缸號%s' % (list3[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(_processing_cylinder_list[
                                                                                         i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿21')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                    else:
                                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                        _temp_weight = _processing_cylinder_list[
                                                                            i].get_weight()
                                                                        _temp_yard_length = _processing_cylinder_list[
                                                                            i].get_yard_length()
                                                                        if (_test_qty <= _temp_weight) and (
                                                                                _test_yard <= _temp_yard_length):
                                                                            print('太好了list3=1')
                                                                            _processing_cylinder_list[i].queue.enq(
                                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                            # 0111:紀錄工單與濃度list中
                                                                            _temp_jobno_con_tuple += (_test_no,)
                                                                            _temp_jobno_con_tuple += (_test_con,)
                                                                            _temp_jobno_con_list = \
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list()
                                                                            _temp_jobno_con_list.append(
                                                                                _temp_jobno_con_tuple)
                                                                            _processing_cylinder_list[
                                                                                i].set_cylinder_con_list(
                                                                                _temp_jobno_con_list)

                                                                            if _test_no != None:
                                                                                temp_tuple4 = search_tuple_from_joblist(
                                                                                    _test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                                if temp_tuple4 != None:
                                                                                    if len(str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())) == 1:
                                                                                        tmp_mac3 = 'D0' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D20' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                    else:
                                                                                        tmp_mac3 = 'D' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D2' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())

                                                                                    # 20181226   刪除schedule_before資料
                                                                                    cnxn9 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                    cursor9.execute(
                                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                            tmp_mac3, tmp_mac4))
                                                                                    cnxn9.commit()

                                                                                    cnxn8 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                    cursor8.execute(
                                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                        temp_tuple4[0], temp_tuple4[1],
                                                                                        temp_tuple4[2],
                                                                                        temp_tuple4[3],
                                                                                        temp_tuple4[4], temp_tuple4[8],
                                                                                        temp_tuple4[9],
                                                                                        temp_tuple4[10], tmp_mac3)
                                                                                    cnxn8.commit()

                                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                                _test_no, _processing_cylinder_list[
                                                                                    i].get_cylinder_no()))
                                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                            if len(_temp_jobno_con_list) >= 8:
                                                                                _processing_cylinder_list[
                                                                                    i].set_queue_full_flag(True)
                                                                            break
                                                                        else:
                                                                            _dispatched_flag = 'F'
                                                                            break
                                                                else:
                                                                    print('預排入缸容量已滿22')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue


                                                    elif len(list3) > 1:
                                                        j = 0
                                                        k = 0
                                                        print('list3: %s' % (list3))
                                                        for j in range(len(list3)):
                                                            i = 0
                                                            print('16前缸號%s' % (list3[j][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                                    queue_flag = False
                                                                    queue_flag = _processing_cylinder_list[
                                                                        i].get_queue_full_flag()

                                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                        # 0115:這邊要去設定queue flag
                                                                        queue_size = 0
                                                                        queue_size = len(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list())
                                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                            print(u'預排入缸容量已滿23')
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                            _dispatched_flag = 'F'
                                                                            k = k + 1
                                                                            break
                                                                        else:
                                                                            list3_1_tuple = ()
                                                                            list3_1_tuple += (list3[j][0],)
                                                                            list3_1_tuple += (list3[j][1],)
                                                                            list3_1_tuple += (
                                                                            list3[j][5],)  # 20190108   取最大濃度
                                                                            list3_1.append(list3_1_tuple)
                                                                            print('list3_1:%s' % (list3_1))
                                                                            break
                                                                    else:
                                                                        print('預排入缸容量已滿24')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                else:
                                                                    continue
                                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                        if k != (j + 1):
                                                            if len(list3_1) > 1:
                                                                j = 0
                                                                _diff_list = []
                                                                for j in range(len(list3_1)):
                                                                    _temp_tuple = ()

                                                                    _diff_max = 0
                                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                                    _diff_max = abs(
                                                                        _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                    _temp_tuple += (_diff_max,)
                                                                    _temp_tuple += (list3_1[j][1],)
                                                                    _temp_tuple += (list3_1[j][0],)

                                                                    _diff_list.append(_temp_tuple)
                                                                    _diff_list = sorted(_diff_list,
                                                                                        key=operator.itemgetter(0))
                                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                            else:
                                                                _diff_list.append(list3_1_tuple)
                                                            print(_diff_list)
                                                            i = 0
                                                            print('18前缸號%s' % (_diff_list[0][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3>1')
                                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(_processing_cylinder_list[
                                                                                               i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4],
                                                                                    temp_tuple4[8], temp_tuple4[9],
                                                                                    temp_tuple4[10],
                                                                                    tmp_mac3)
                                                                                cnxn8.commit()

                                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                                            _test_no, _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                        _dispatched_flag = ''
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                else:
                                                                    continue
                                                    else:
                                                        _dispatched_flag = 'F'
                                                    break
                                        else:
                                            # 20190109   思考list3預排缸已滿的後續處理，設定_dispatched_flag為F並進入隨機分配
                                            print('預排入缸容量已滿18')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            print('list2 null -> list3')
                                            if len(list3) == 1:
                                                i = 0
                                                print('15前缸號%s' % (list3[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿21')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                            else:
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3=1')
                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4], temp_tuple4[8],
                                                                                temp_tuple4[9],
                                                                                temp_tuple4[10], tmp_mac3)
                                                                            cnxn8.commit()

                                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                        else:
                                                            print('預排入缸容量已滿22')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue


                                            elif len(list3) > 1:
                                                j = 0
                                                k = 0
                                                print('list3: %s' % (list3))
                                                for j in range(len(list3)):
                                                    i = 0
                                                    print('16前缸號%s' % (list3[j][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(_processing_cylinder_list[
                                                                                     i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿23')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                                else:
                                                                    list3_1_tuple = ()
                                                                    list3_1_tuple += (list3[j][0],)
                                                                    list3_1_tuple += (list3[j][1],)
                                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                    list3_1.append(list3_1_tuple)
                                                                    print('list3_1:%s' % (list3_1))
                                                                    break
                                                            else:
                                                                print('預排入缸容量已滿24')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                        else:
                                                            continue
                                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                if k != (j + 1):
                                                    if len(list3_1) > 1:
                                                        j = 0
                                                        _diff_list = []
                                                        for j in range(len(list3_1)):
                                                            _temp_tuple = ()

                                                            _diff_max = 0
                                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                            _temp_tuple += (_diff_max,)
                                                            _temp_tuple += (list3_1[j][1],)
                                                            _temp_tuple += (list3_1[j][0],)

                                                            _diff_list.append(_temp_tuple)
                                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                    else:
                                                        _diff_list.append(list3_1_tuple)
                                                    print(_diff_list)
                                                    i = 0
                                                    print('18前缸號%s' % (_diff_list[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3>1')
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(_processing_cylinder_list[
                                                                                       i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2], temp_tuple4[3],
                                                                            temp_tuple4[4],
                                                                            temp_tuple4[8], temp_tuple4[9],
                                                                            temp_tuple4[10], tmp_mac3)
                                                                        cnxn8.commit()

                                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                _dispatched_flag = ''
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue
                                            else:
                                                _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue


                            elif len(list2) > 1:
                                j = 0
                                k = 0
                                print('list2: %s' % (list2))
                                for j in range(len(list2)):
                                    i = 0
                                    print('13前缸號%s' % (list2[j][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list2[j][1]) == int(_temp_cy_no1):
                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿19')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    # 20190111   避免全滿又進入listx_1的排缸
                                                    k = k + 1
                                                    break
                                                else:
                                                    list2_1_tuple = ()
                                                    list2_1_tuple += (list2[j][0],)
                                                    list2_1_tuple += (list2[j][1],)
                                                    list2_1_tuple += (list2[j][5],)  # 20190108   取最大濃度
                                                    list2_1.append(list2_1_tuple)
                                                    print('list2_1:%s' % (list2_1))
                                                    break
                                            else:
                                                print('預排入缸容量已滿20')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                k = k + 1
                                                break
                                        else:
                                            continue
                                print(k)
                                print(j)
                                if k != (j + 1):
                                    # 20190109   依照list2_1長度，判斷是否比較最大濃度
                                    if len(list2_1) > 1:
                                        j = 0
                                        _diff_list = []
                                        for j in range(len(list2_1)):
                                            _temp_tuple = ()

                                            _diff_max = 0
                                            _each_max = list2_1[j][2]  # 取出最大濃度
                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                            _temp_tuple += (_diff_max,)
                                            _temp_tuple += (list2_1[j][1],)
                                            _temp_tuple += (list2_1[j][0],)

                                            _diff_list.append(_temp_tuple)
                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                    else:
                                        _diff_list.append(list2_1_tuple)
                                    print(_diff_list)
                                    i = 0
                                    print('14前缸號%s' % (_diff_list[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3], temp_tuple4[4],
                                                            temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                print(u"工單號 %s 已排入第%s缸中10" % (
                                                _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                _dispatched_flag = ''
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                print('list2>1規格不符')
                                                if len(list3) == 1:
                                                    i = 0
                                                    print('15前缸號%s' % (list3[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(_processing_cylinder_list[
                                                                                     i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿21')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                                else:
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3=1')
                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4], temp_tuple4[8],
                                                                                    temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                                            _test_no, _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                            else:
                                                                print('預排入缸容量已滿22')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue


                                                elif len(list3) > 1:
                                                    j = 0
                                                    k = 0
                                                    print('list3: %s' % (list3))
                                                    for j in range(len(list3)):
                                                        i = 0
                                                        print('16前缸號%s' % (list3[j][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿23')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                    else:
                                                                        list3_1_tuple = ()
                                                                        list3_1_tuple += (list3[j][0],)
                                                                        list3_1_tuple += (list3[j][1],)
                                                                        list3_1_tuple += (
                                                                        list3[j][5],)  # 20190108   取最大濃度
                                                                        list3_1.append(list3_1_tuple)
                                                                        print('list3_1:%s' % (list3_1))
                                                                        break
                                                                else:
                                                                    print('預排入缸容量已滿24')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                            else:
                                                                continue
                                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                    if k != (j + 1):
                                                        if len(list3_1) > 1:
                                                            j = 0
                                                            _diff_list = []
                                                            for j in range(len(list3_1)):
                                                                _temp_tuple = ()

                                                                _diff_max = 0
                                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                                _diff_max = abs(
                                                                    _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                _temp_tuple += (_diff_max,)
                                                                _temp_tuple += (list3_1[j][1],)
                                                                _temp_tuple += (list3_1[j][0],)

                                                                _diff_list.append(_temp_tuple)
                                                                _diff_list = sorted(_diff_list,
                                                                                    key=operator.itemgetter(0))
                                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                        else:
                                                            _diff_list.append(list3_1_tuple)
                                                        print(_diff_list)
                                                        i = 0
                                                        print('18前缸號%s' % (_diff_list[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3>1')
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(_processing_cylinder_list[
                                                                                           i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4],
                                                                                temp_tuple4[8], temp_tuple4[9],
                                                                                temp_tuple4[10],
                                                                                tmp_mac3)
                                                                            cnxn8.commit()

                                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                    _dispatched_flag = ''
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue
                                                else:
                                                    _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue
                                else:  # 20190111   list1全滿，找尋list2，以此類推[必須思考長度=1及>1兩種情況]
                                    print('list2_1 null -> list3')
                                    if len(list3) == 1:
                                        i = 0
                                        print('15前缸號%s' % (list3[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿21')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                    else:
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3=1')
                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(_processing_cylinder_list[
                                                                                   i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(_processing_cylinder_list[
                                                                                                 i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                        temp_tuple4[10],
                                                                        tmp_mac3)
                                                                    cnxn8.commit()

                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                else:
                                                    print('預排入缸容量已滿22')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue


                                    elif len(list3) > 1:
                                        j = 0
                                        k = 0
                                        print('list3: %s' % (list3))
                                        for j in range(len(list3)):
                                            i = 0
                                            print('16前缸號%s' % (list3[j][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿23')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                        else:
                                                            list3_1_tuple = ()
                                                            list3_1_tuple += (list3[j][0],)
                                                            list3_1_tuple += (list3[j][1],)
                                                            list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                            list3_1.append(list3_1_tuple)
                                                            print('list3_1:%s' % (list3_1))
                                                            break
                                                    else:
                                                        print('預排入缸容量已滿24')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                else:
                                                    continue
                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                        if k != (j + 1):
                                            if len(list3_1) > 1:
                                                j = 0
                                                _diff_list = []
                                                for j in range(len(list3_1)):
                                                    _temp_tuple = ()

                                                    _diff_max = 0
                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                    _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                    _temp_tuple += (_diff_max,)
                                                    _temp_tuple += (list3_1[j][1],)
                                                    _temp_tuple += (list3_1[j][0],)

                                                    _diff_list.append(_temp_tuple)
                                                    _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                            else:
                                                _diff_list.append(list3_1_tuple)
                                            print(_diff_list)
                                            i = 0
                                            print('18前缸號%s' % (_diff_list[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3>1')
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(_processing_cylinder_list[
                                                                               i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4],
                                                                    temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                    tmp_mac3)
                                                                cnxn8.commit()

                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                        _dispatched_flag = ''
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue
                                    else:
                                        _dispatched_flag = 'F'
                            else:
                                if len(list3) == 1:
                                    i = 0
                                    print('15前缸號%s' % (list3[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿21')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                                else:
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3=1')
                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(_processing_cylinder_list[
                                                                               i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                    temp_tuple4[10], tmp_mac3)
                                                                cnxn8.commit()

                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                            else:
                                                print('預排入缸容量已滿22')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue


                                elif len(list3) > 1:
                                    j = 0
                                    k = 0
                                    print('list3: %s' % (list3))
                                    for j in range(len(list3)):
                                        i = 0
                                        print('16前缸號%s' % (list3[j][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿23')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                    else:
                                                        list3_1_tuple = ()
                                                        list3_1_tuple += (list3[j][0],)
                                                        list3_1_tuple += (list3[j][1],)
                                                        list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                        list3_1.append(list3_1_tuple)
                                                        print('list3_1:%s' % (list3_1))
                                                        break
                                                else:
                                                    print('預排入缸容量已滿24')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                            else:
                                                continue
                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                    if k != (j + 1):
                                        if len(list3_1) > 1:
                                            j = 0
                                            _diff_list = []
                                            for j in range(len(list3_1)):
                                                _temp_tuple = ()

                                                _diff_max = 0
                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                _temp_tuple += (_diff_max,)
                                                _temp_tuple += (list3_1[j][1],)
                                                _temp_tuple += (list3_1[j][0],)

                                                _diff_list.append(_temp_tuple)
                                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                        else:
                                            _diff_list.append(list3_1_tuple)
                                        print(_diff_list)
                                        i = 0
                                        print('18前缸號%s' % (_diff_list[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3>1')
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3], temp_tuple4[4],
                                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                    _dispatched_flag = ''
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue
                                else:
                                    _dispatched_flag = 'F'
                            break
                        else:
                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                            _temp_weight = _processing_cylinder_list[i].get_weight()
                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                # 0111:紀錄工單與濃度list中
                                _temp_jobno_con_tuple += (_test_no,)
                                _temp_jobno_con_tuple += (_test_con,)
                                _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                if _test_no != None:
                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                    if temp_tuple4 != None:
                                        if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                            tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        else:
                                            tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                        # 20181226   刪除schedule_before資料
                                        cnxn9 = pyodbc.connect(
                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                        cursor9.execute("delete from schedule_before where mach_id in ('%s','%s')" % (
                                        tmp_mac3, tmp_mac4))
                                        cnxn9.commit()

                                        cnxn8 = pyodbc.connect(
                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                        cursor8.execute(
                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                            temp_tuple4[4], temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                        cnxn8.commit()

                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                print(u"工單號 %s 已排入第%s缸中7" % (_test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                if len(_temp_jobno_con_list) >= 8:
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                break
                            else:
                                print('list1=1規格不符')
                                if len(list2) == 1:
                                    i = 0
                                    print('12前缸號%s' % (list2[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list2[0][1]) == int(_temp_cy_no1):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿17')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    print('list2 null -> list3')
                                                    if len(list3) == 1:
                                                        i = 0
                                                        print('15前缸號%s' % (list3[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿21')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                    else:
                                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                        _temp_weight = _processing_cylinder_list[
                                                                            i].get_weight()
                                                                        _temp_yard_length = _processing_cylinder_list[
                                                                            i].get_yard_length()
                                                                        if (_test_qty <= _temp_weight) and (
                                                                                _test_yard <= _temp_yard_length):
                                                                            print('太好了list3=1')
                                                                            _processing_cylinder_list[i].queue.enq(
                                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                            # 0111:紀錄工單與濃度list中
                                                                            _temp_jobno_con_tuple += (_test_no,)
                                                                            _temp_jobno_con_tuple += (_test_con,)
                                                                            _temp_jobno_con_list = \
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list()
                                                                            _temp_jobno_con_list.append(
                                                                                _temp_jobno_con_tuple)
                                                                            _processing_cylinder_list[
                                                                                i].set_cylinder_con_list(
                                                                                _temp_jobno_con_list)

                                                                            if _test_no != None:
                                                                                temp_tuple4 = search_tuple_from_joblist(
                                                                                    _test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                                if temp_tuple4 != None:
                                                                                    if len(str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())) == 1:
                                                                                        tmp_mac3 = 'D0' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D20' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                    else:
                                                                                        tmp_mac3 = 'D' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D2' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())

                                                                                    # 20181226   刪除schedule_before資料
                                                                                    cnxn9 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                    cursor9.execute(
                                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                            tmp_mac3, tmp_mac4))
                                                                                    cnxn9.commit()

                                                                                    cnxn8 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                    cursor8.execute(
                                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                        temp_tuple4[0], temp_tuple4[1],
                                                                                        temp_tuple4[2],
                                                                                        temp_tuple4[3],
                                                                                        temp_tuple4[4], temp_tuple4[8],
                                                                                        temp_tuple4[9],
                                                                                        temp_tuple4[10], tmp_mac3)
                                                                                    cnxn8.commit()

                                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                                _test_no,
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no()))
                                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                            if len(_temp_jobno_con_list) >= 8:
                                                                                _processing_cylinder_list[
                                                                                    i].set_queue_full_flag(True)
                                                                            break
                                                                        else:
                                                                            _dispatched_flag = 'F'
                                                                            break
                                                                else:
                                                                    print('預排入缸容量已滿22')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue


                                                    elif len(list3) > 1:
                                                        j = 0
                                                        k = 0
                                                        print('list3: %s' % (list3))
                                                        for j in range(len(list3)):
                                                            i = 0
                                                            print('16前缸號%s' % (list3[j][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                                    queue_flag = False
                                                                    queue_flag = _processing_cylinder_list[
                                                                        i].get_queue_full_flag()

                                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                        # 0115:這邊要去設定queue flag
                                                                        queue_size = 0
                                                                        queue_size = len(_processing_cylinder_list[
                                                                                             i].get_cylinder_con_list())
                                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                            print(u'預排入缸容量已滿23')
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                            _dispatched_flag = 'F'
                                                                            k = k + 1
                                                                            break
                                                                        else:
                                                                            list3_1_tuple = ()
                                                                            list3_1_tuple += (list3[j][0],)
                                                                            list3_1_tuple += (list3[j][1],)
                                                                            list3_1_tuple += (
                                                                            list3[j][5],)  # 20190108   取最大濃度
                                                                            list3_1.append(list3_1_tuple)
                                                                            print('list3_1:%s' % (list3_1))
                                                                            break
                                                                    else:
                                                                        print('預排入缸容量已滿24')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                else:
                                                                    continue
                                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                        if k != (j + 1):
                                                            if len(list3_1) > 1:
                                                                j = 0
                                                                _diff_list = []
                                                                for j in range(len(list3_1)):
                                                                    _temp_tuple = ()

                                                                    _diff_max = 0
                                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                                    _diff_max = abs(
                                                                        _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                    _temp_tuple += (_diff_max,)
                                                                    _temp_tuple += (list3_1[j][1],)
                                                                    _temp_tuple += (list3_1[j][0],)

                                                                    _diff_list.append(_temp_tuple)
                                                                    _diff_list = sorted(_diff_list,
                                                                                        key=operator.itemgetter(0))
                                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                            else:
                                                                _diff_list.append(list3_1_tuple)
                                                            print(_diff_list)
                                                            i = 0
                                                            print('18前缸號%s' % (_diff_list[0][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3>1')
                                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3], temp_tuple4[4],
                                                                                    temp_tuple4[8], temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                                            _test_no,
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                        _dispatched_flag = ''
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                else:
                                                                    continue
                                                    else:
                                                        _dispatched_flag = 'F'
                                                    break
                                                else:
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                    temp_tuple4[10], tmp_mac3)
                                                                cnxn8.commit()

                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                        print(u"工單號 %s 已排入第%s缸中9" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        print('list2=1規格不符')
                                                        if len(list3) == 1:
                                                            i = 0
                                                            print('15前缸號%s' % (list3[0][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(list3[0][1]) == int(_temp_cy_no1):
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    queue_flag = False
                                                                    queue_flag = _processing_cylinder_list[
                                                                        i].get_queue_full_flag()

                                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                        # 0115:這邊要去設定queue flag
                                                                        queue_size = 0
                                                                        queue_size = len(_processing_cylinder_list[
                                                                                             i].get_cylinder_con_list())
                                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                            print(u'預排入缸容量已滿21')
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                            _dispatched_flag = 'F'
                                                                            break
                                                                        else:
                                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                            _temp_weight = _processing_cylinder_list[
                                                                                i].get_weight()
                                                                            _temp_yard_length = \
                                                                            _processing_cylinder_list[
                                                                                i].get_yard_length()
                                                                            if (_test_qty <= _temp_weight) and (
                                                                                    _test_yard <= _temp_yard_length):
                                                                                print('太好了list3=1')
                                                                                _processing_cylinder_list[i].queue.enq(
                                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                                # 0111:紀錄工單與濃度list中
                                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                                _temp_jobno_con_list = \
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_con_list()
                                                                                _temp_jobno_con_list.append(
                                                                                    _temp_jobno_con_tuple)
                                                                                _processing_cylinder_list[
                                                                                    i].set_cylinder_con_list(
                                                                                    _temp_jobno_con_list)

                                                                                if _test_no != None:
                                                                                    temp_tuple4 = search_tuple_from_joblist(
                                                                                        _test_no,
                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                                    if temp_tuple4 != None:
                                                                                        if len(str(
                                                                                                _processing_cylinder_list[
                                                                                                    i].get_cylinder_no())) == 1:
                                                                                            tmp_mac3 = 'D0' + str(
                                                                                                _processing_cylinder_list[
                                                                                                    i].get_cylinder_no())
                                                                                            tmp_mac4 = 'D20' + str(
                                                                                                _processing_cylinder_list[
                                                                                                    i].get_cylinder_no())
                                                                                        else:
                                                                                            tmp_mac3 = 'D' + str(
                                                                                                _processing_cylinder_list[
                                                                                                    i].get_cylinder_no())
                                                                                            tmp_mac4 = 'D2' + str(
                                                                                                _processing_cylinder_list[
                                                                                                    i].get_cylinder_no())

                                                                                        # 20181226   刪除schedule_before資料
                                                                                        cnxn9 = pyodbc.connect(
                                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                        cursor9.execute(
                                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                                tmp_mac3, tmp_mac4))
                                                                                        cnxn9.commit()

                                                                                        cnxn8 = pyodbc.connect(
                                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                        cursor8.execute(
                                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                            temp_tuple4[0],
                                                                                            temp_tuple4[1],
                                                                                            temp_tuple4[2],
                                                                                            temp_tuple4[3],
                                                                                            temp_tuple4[4],
                                                                                            temp_tuple4[8],
                                                                                            temp_tuple4[9],
                                                                                            temp_tuple4[10], tmp_mac3)
                                                                                        cnxn8.commit()

                                                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                                print(u"工單號 %s 已排入第%s缸中11" % (
                                                                                    _test_no, _processing_cylinder_list[
                                                                                        i].get_cylinder_no()))
                                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                                if len(_temp_jobno_con_list) >= 8:
                                                                                    _processing_cylinder_list[
                                                                                        i].set_queue_full_flag(True)
                                                                                break
                                                                            else:
                                                                                _dispatched_flag = 'F'
                                                                                break
                                                                    else:
                                                                        print('預排入缸容量已滿22')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                else:
                                                                    continue


                                                        elif len(list3) > 1:
                                                            j = 0
                                                            k = 0
                                                            print('list3: %s' % (list3))
                                                            for j in range(len(list3)):
                                                                i = 0
                                                                print('16前缸號%s' % (list3[j][1]))
                                                                for i in range(0, len(
                                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                    _temp_cy_no1 = _processing_cylinder_list[
                                                                        i].get_cylinder_no()
                                                                    if int(list3[j][1]) == int(_temp_cy_no1):
                                                                        queue_flag = False
                                                                        queue_flag = _processing_cylinder_list[
                                                                            i].get_queue_full_flag()

                                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                            # 0115:這邊要去設定queue flag
                                                                            queue_size = 0
                                                                            queue_size = len(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_con_list())
                                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                                print(u'預排入缸容量已滿23')
                                                                                _processing_cylinder_list[
                                                                                    i].set_queue_full_flag(True)
                                                                                _dispatched_flag = 'F'
                                                                                k = k + 1
                                                                                break
                                                                            else:
                                                                                list3_1_tuple = ()
                                                                                list3_1_tuple += (list3[j][0],)
                                                                                list3_1_tuple += (list3[j][1],)
                                                                                list3_1_tuple += (
                                                                                    list3[j][5],)  # 20190108   取最大濃度
                                                                                list3_1.append(list3_1_tuple)
                                                                                print('list3_1:%s' % (list3_1))
                                                                                break
                                                                        else:
                                                                            print('預排入缸容量已滿24')
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                            _dispatched_flag = 'F'
                                                                            k = k + 1
                                                                            break
                                                                    else:
                                                                        continue
                                                            # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                            if k != (j + 1):
                                                                if len(list3_1) > 1:
                                                                    j = 0
                                                                    _diff_list = []
                                                                    for j in range(len(list3_1)):
                                                                        _temp_tuple = ()

                                                                        _diff_max = 0
                                                                        _each_max = list3_1[j][2]  # 取出最大濃度
                                                                        _diff_max = abs(
                                                                            _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                        _temp_tuple += (_diff_max,)
                                                                        _temp_tuple += (list3_1[j][1],)
                                                                        _temp_tuple += (list3_1[j][0],)

                                                                        _diff_list.append(_temp_tuple)
                                                                        _diff_list = sorted(_diff_list,
                                                                                            key=operator.itemgetter(0))
                                                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                                else:
                                                                    _diff_list.append(list3_1_tuple)
                                                                print(_diff_list)
                                                                i = 0
                                                                print('18前缸號%s' % (_diff_list[0][1]))
                                                                for i in range(0, len(
                                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                    _temp_cy_no1 = _processing_cylinder_list[
                                                                        i].get_cylinder_no()
                                                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                        _temp_weight = _processing_cylinder_list[
                                                                            i].get_weight()
                                                                        _temp_yard_length = _processing_cylinder_list[
                                                                            i].get_yard_length()
                                                                        if (_test_qty <= _temp_weight) and (
                                                                                _test_yard <= _temp_yard_length):
                                                                            print('太好了list3>1')
                                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                            _processing_cylinder_list[i].queue.enq(
                                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                            # 0111:紀錄工單與濃度list中
                                                                            _temp_jobno_con_tuple += (_test_no,)
                                                                            _temp_jobno_con_tuple += (_test_con,)
                                                                            _temp_jobno_con_list = \
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list()
                                                                            _temp_jobno_con_list.append(
                                                                                _temp_jobno_con_tuple)
                                                                            _processing_cylinder_list[
                                                                                i].set_cylinder_con_list(
                                                                                _temp_jobno_con_list)

                                                                            if _test_no != None:
                                                                                temp_tuple4 = search_tuple_from_joblist(
                                                                                    _test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                                if temp_tuple4 != None:
                                                                                    if len(str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())) == 1:
                                                                                        tmp_mac3 = 'D0' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D20' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                    else:
                                                                                        tmp_mac3 = 'D' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D2' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())

                                                                                    # 20181226   刪除schedule_before資料
                                                                                    cnxn9 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                    cursor9.execute(
                                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                            tmp_mac3, tmp_mac4))
                                                                                    cnxn9.commit()

                                                                                    cnxn8 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                    cursor8.execute(
                                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                        temp_tuple4[0], temp_tuple4[1],
                                                                                        temp_tuple4[2],
                                                                                        temp_tuple4[3],
                                                                                        temp_tuple4[4],
                                                                                        temp_tuple4[8], temp_tuple4[9],
                                                                                        temp_tuple4[10],
                                                                                        tmp_mac3)
                                                                                    cnxn8.commit()

                                                                            print(u"工單號 %s 已排入第%s缸中12" % (
                                                                                _test_no,
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no()))
                                                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                            _dispatched_flag = ''
                                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                            if len(_temp_jobno_con_list) >= 8:
                                                                                _processing_cylinder_list[
                                                                                    i].set_queue_full_flag(True)
                                                                            break
                                                                        else:
                                                                            _dispatched_flag = 'F'
                                                                            break
                                                                    else:
                                                                        continue
                                                        else:
                                                            _dispatched_flag = 'F'
                                                        break
                                            else:
                                                # 20190109   思考list3預排缸已滿的後續處理，設定_dispatched_flag為F並進入隨機分配
                                                print('預排入缸容量已滿18')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                print('list2 null -> list3')
                                                if len(list3) == 1:
                                                    i = 0
                                                    print('15前缸號%s' % (list3[0][1]))
                                                    for i in range(0,
                                                                   len(
                                                                       _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿21')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                                else:
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3=1')
                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4], temp_tuple4[8],
                                                                                    temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                                            _test_no,
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                            else:
                                                                print('預排入缸容量已滿22')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue


                                                elif len(list3) > 1:
                                                    j = 0
                                                    k = 0
                                                    print('list3: %s' % (list3))
                                                    for j in range(len(list3)):
                                                        i = 0
                                                        print('16前缸號%s' % (list3[j][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿23')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                    else:
                                                                        list3_1_tuple = ()
                                                                        list3_1_tuple += (list3[j][0],)
                                                                        list3_1_tuple += (list3[j][1],)
                                                                        list3_1_tuple += (
                                                                        list3[j][5],)  # 20190108   取最大濃度
                                                                        list3_1.append(list3_1_tuple)
                                                                        print('list3_1:%s' % (list3_1))
                                                                        break
                                                                else:
                                                                    print('預排入缸容量已滿24')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                            else:
                                                                continue
                                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                    if k != (j + 1):
                                                        if len(list3_1) > 1:
                                                            j = 0
                                                            _diff_list = []
                                                            for j in range(len(list3_1)):
                                                                _temp_tuple = ()

                                                                _diff_max = 0
                                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                                _diff_max = abs(
                                                                    _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                _temp_tuple += (_diff_max,)
                                                                _temp_tuple += (list3_1[j][1],)
                                                                _temp_tuple += (list3_1[j][0],)

                                                                _diff_list.append(_temp_tuple)
                                                                _diff_list = sorted(_diff_list,
                                                                                    key=operator.itemgetter(0))
                                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                        else:
                                                            _diff_list.append(list3_1_tuple)
                                                        print(_diff_list)
                                                        i = 0
                                                        print('18前缸號%s' % (_diff_list[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3>1')
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(_processing_cylinder_list[
                                                                                           i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4],
                                                                                temp_tuple4[8], temp_tuple4[9],
                                                                                temp_tuple4[10],
                                                                                tmp_mac3)
                                                                            cnxn8.commit()

                                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                    _dispatched_flag = ''
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue
                                                else:
                                                    _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue


                                elif len(list2) > 1:
                                    j = 0
                                    k = 0
                                    print('list2: %s' % (list2))
                                    for j in range(len(list2)):
                                        i = 0
                                        print('13前缸號%s' % (list2[j][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list2[j][1]) == int(_temp_cy_no1):
                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿19')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        # 20190111   避免全滿又進入listx_1的排缸
                                                        k = k + 1
                                                        break
                                                    else:
                                                        list2_1_tuple = ()
                                                        list2_1_tuple += (list2[j][0],)
                                                        list2_1_tuple += (list2[j][1],)
                                                        list2_1_tuple += (list2[j][5],)  # 20190108   取最大濃度
                                                        list2_1.append(list2_1_tuple)
                                                        print('list2_1:%s' % (list2_1))
                                                        break
                                                else:
                                                    print('預排入缸容量已滿20')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    k = k + 1
                                                    break
                                            else:
                                                continue
                                    print(k)
                                    print(j)
                                    if k != (j + 1):
                                        # 20190109   依照list2_1長度，判斷是否比較最大濃度
                                        if len(list2_1) > 1:
                                            j = 0
                                            _diff_list = []
                                            for j in range(len(list2_1)):
                                                _temp_tuple = ()

                                                _diff_max = 0
                                                _each_max = list2_1[j][2]  # 取出最大濃度
                                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                _temp_tuple += (_diff_max,)
                                                _temp_tuple += (list2_1[j][1],)
                                                _temp_tuple += (list2_1[j][0],)

                                                _diff_list.append(_temp_tuple)
                                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                        else:
                                            _diff_list.append(list2_1_tuple)
                                        print(_diff_list)
                                        i = 0
                                        print('14前缸號%s' % (_diff_list[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4],
                                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s缸中10" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                    _dispatched_flag = ''
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    print('list2>1規格不符')
                                                    if len(list3) == 1:
                                                        i = 0
                                                        print('15前缸號%s' % (list3[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿21')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                    else:
                                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                        _temp_weight = _processing_cylinder_list[
                                                                            i].get_weight()
                                                                        _temp_yard_length = _processing_cylinder_list[
                                                                            i].get_yard_length()
                                                                        if (_test_qty <= _temp_weight) and (
                                                                                _test_yard <= _temp_yard_length):
                                                                            print('太好了list3=1')
                                                                            _processing_cylinder_list[i].queue.enq(
                                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                            # 0111:紀錄工單與濃度list中
                                                                            _temp_jobno_con_tuple += (_test_no,)
                                                                            _temp_jobno_con_tuple += (_test_con,)
                                                                            _temp_jobno_con_list = \
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list()
                                                                            _temp_jobno_con_list.append(
                                                                                _temp_jobno_con_tuple)
                                                                            _processing_cylinder_list[
                                                                                i].set_cylinder_con_list(
                                                                                _temp_jobno_con_list)

                                                                            if _test_no != None:
                                                                                temp_tuple4 = search_tuple_from_joblist(
                                                                                    _test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                                if temp_tuple4 != None:
                                                                                    if len(str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())) == 1:
                                                                                        tmp_mac3 = 'D0' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D20' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                    else:
                                                                                        tmp_mac3 = 'D' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D2' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())

                                                                                    # 20181226   刪除schedule_before資料
                                                                                    cnxn9 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                    cursor9.execute(
                                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                            tmp_mac3, tmp_mac4))
                                                                                    cnxn9.commit()

                                                                                    cnxn8 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                    cursor8.execute(
                                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                        temp_tuple4[0], temp_tuple4[1],
                                                                                        temp_tuple4[2],
                                                                                        temp_tuple4[3],
                                                                                        temp_tuple4[4], temp_tuple4[8],
                                                                                        temp_tuple4[9],
                                                                                        temp_tuple4[10], tmp_mac3)
                                                                                    cnxn8.commit()

                                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                                _test_no,
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no()))
                                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                            if len(_temp_jobno_con_list) >= 8:
                                                                                _processing_cylinder_list[
                                                                                    i].set_queue_full_flag(True)
                                                                            break
                                                                        else:
                                                                            _dispatched_flag = 'F'
                                                                            break
                                                                else:
                                                                    print('預排入缸容量已滿22')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue


                                                    elif len(list3) > 1:
                                                        j = 0
                                                        k = 0
                                                        print('list3: %s' % (list3))
                                                        for j in range(len(list3)):
                                                            i = 0
                                                            print('16前缸號%s' % (list3[j][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                                    queue_flag = False
                                                                    queue_flag = _processing_cylinder_list[
                                                                        i].get_queue_full_flag()

                                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                        # 0115:這邊要去設定queue flag
                                                                        queue_size = 0
                                                                        queue_size = len(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list())
                                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                            print(u'預排入缸容量已滿23')
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                            _dispatched_flag = 'F'
                                                                            k = k + 1
                                                                            break
                                                                        else:
                                                                            list3_1_tuple = ()
                                                                            list3_1_tuple += (list3[j][0],)
                                                                            list3_1_tuple += (list3[j][1],)
                                                                            list3_1_tuple += (
                                                                            list3[j][5],)  # 20190108   取最大濃度
                                                                            list3_1.append(list3_1_tuple)
                                                                            print('list3_1:%s' % (list3_1))
                                                                            break
                                                                    else:
                                                                        print('預排入缸容量已滿24')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                else:
                                                                    continue
                                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                        if k != (j + 1):
                                                            if len(list3_1) > 1:
                                                                j = 0
                                                                _diff_list = []
                                                                for j in range(len(list3_1)):
                                                                    _temp_tuple = ()

                                                                    _diff_max = 0
                                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                                    _diff_max = abs(
                                                                        _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                    _temp_tuple += (_diff_max,)
                                                                    _temp_tuple += (list3_1[j][1],)
                                                                    _temp_tuple += (list3_1[j][0],)

                                                                    _diff_list.append(_temp_tuple)
                                                                    _diff_list = sorted(_diff_list,
                                                                                        key=operator.itemgetter(0))
                                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                            else:
                                                                _diff_list.append(list3_1_tuple)
                                                            print(_diff_list)
                                                            i = 0
                                                            print('18前缸號%s' % (_diff_list[0][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3>1')
                                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(_processing_cylinder_list[
                                                                                               i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4],
                                                                                    temp_tuple4[8], temp_tuple4[9],
                                                                                    temp_tuple4[10],
                                                                                    tmp_mac3)
                                                                                cnxn8.commit()

                                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                                            _test_no,
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                        _dispatched_flag = ''
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(
                                                                                True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                else:
                                                                    continue
                                                    else:
                                                        _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue
                                    else:  # 20190111   list1全滿，找尋list2，以此類推[必須思考長度=1及>1兩種情況]
                                        print('list2_1 null -> list3')
                                        if len(list3) == 1:
                                            i = 0
                                            print('15前缸號%s' % (list3[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[0][1]) == int(_temp_cy_no1):
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿21')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                        else:
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3=1')
                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(_processing_cylinder_list[
                                                                                       i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2],
                                                                            temp_tuple4[3],
                                                                            temp_tuple4[4], temp_tuple4[8],
                                                                            temp_tuple4[9],
                                                                            temp_tuple4[10],
                                                                            tmp_mac3)
                                                                        cnxn8.commit()

                                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                print(u"工單號 %s 已排入第%s缸中11" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                    else:
                                                        print('預排入缸容量已滿22')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue


                                        elif len(list3) > 1:
                                            j = 0
                                            k = 0
                                            print('list3: %s' % (list3))
                                            for j in range(len(list3)):
                                                i = 0
                                                print('16前缸號%s' % (list3[j][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[j][1]) == int(_temp_cy_no1):
                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿23')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                            else:
                                                                list3_1_tuple = ()
                                                                list3_1_tuple += (list3[j][0],)
                                                                list3_1_tuple += (list3[j][1],)
                                                                list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                list3_1.append(list3_1_tuple)
                                                                print('list3_1:%s' % (list3_1))
                                                                break
                                                        else:
                                                            print('預排入缸容量已滿24')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                    else:
                                                        continue
                                            # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                            if k != (j + 1):
                                                if len(list3_1) > 1:
                                                    j = 0
                                                    _diff_list = []
                                                    for j in range(len(list3_1)):
                                                        _temp_tuple = ()

                                                        _diff_max = 0
                                                        _each_max = list3_1[j][2]  # 取出最大濃度
                                                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                        _temp_tuple += (_diff_max,)
                                                        _temp_tuple += (list3_1[j][1],)
                                                        _temp_tuple += (list3_1[j][0],)

                                                        _diff_list.append(_temp_tuple)
                                                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                else:
                                                    _diff_list.append(list3_1_tuple)
                                                print(_diff_list)
                                                i = 0
                                                print('18前缸號%s' % (_diff_list[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3>1')
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(_processing_cylinder_list[
                                                                                   i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4],
                                                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                        tmp_mac3)
                                                                    cnxn8.commit()

                                                            print(u"工單號 %s 已排入第%s缸中12" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                            _dispatched_flag = ''
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue
                                        else:
                                            _dispatched_flag = 'F'
                                else:
                                    if len(list3) == 1:
                                        i = 0
                                        print('15前缸號%s' % (list3[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿21')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                    else:
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3=1')
                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(_processing_cylinder_list[
                                                                                   i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                        temp_tuple4[10], tmp_mac3)
                                                                    cnxn8.commit()

                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                else:
                                                    print('預排入缸容量已滿22')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue


                                    elif len(list3) > 1:
                                        j = 0
                                        k = 0
                                        print('list3: %s' % (list3))
                                        for j in range(len(list3)):
                                            i = 0
                                            print('16前缸號%s' % (list3[j][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿23')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                        else:
                                                            list3_1_tuple = ()
                                                            list3_1_tuple += (list3[j][0],)
                                                            list3_1_tuple += (list3[j][1],)
                                                            list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                            list3_1.append(list3_1_tuple)
                                                            print('list3_1:%s' % (list3_1))
                                                            break
                                                    else:
                                                        print('預排入缸容量已滿24')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                else:
                                                    continue
                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                        if k != (j + 1):
                                            if len(list3_1) > 1:
                                                j = 0
                                                _diff_list = []
                                                for j in range(len(list3_1)):
                                                    _temp_tuple = ()

                                                    _diff_max = 0
                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                    _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                    _temp_tuple += (_diff_max,)
                                                    _temp_tuple += (list3_1[j][1],)
                                                    _temp_tuple += (list3_1[j][0],)

                                                    _diff_list.append(_temp_tuple)
                                                    _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                            else:
                                                _diff_list.append(list3_1_tuple)
                                            print(_diff_list)
                                            i = 0
                                            print('18前缸號%s' % (_diff_list[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3>1')
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3], temp_tuple4[4],
                                                                    temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                    tmp_mac3)
                                                                cnxn8.commit()

                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                        _dispatched_flag = ''
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue
                                    else:
                                        _dispatched_flag = 'F'
                                break
                    else:
                        print('預排入缸容量已滿14')
                        _processing_cylinder_list[i].set_queue_full_flag(True)
                        print('list1 null -> list2 -> list3')
                        if len(list2) == 1:
                            i = 0
                            print('12前缸號%s' % (list2[0][1]))
                            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                if int(list2[0][1]) == int(_temp_cy_no1):
                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                    queue_flag = False
                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                        # 0115:這邊要去設定queue flag
                                        queue_size = 0
                                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                            print(u'預排入缸容量已滿17')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            print('list2 null -> list3')
                                            if len(list3) == 1:
                                                i = 0
                                                print('15前缸號%s' % (list3[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿21')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                            else:
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3=1')
                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(_processing_cylinder_list[
                                                                                           i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4], temp_tuple4[8],
                                                                                temp_tuple4[9],
                                                                                temp_tuple4[10], tmp_mac3)
                                                                            cnxn8.commit()

                                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                        else:
                                                            print('預排入缸容量已滿22')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue


                                            elif len(list3) > 1:
                                                j = 0
                                                k = 0
                                                print('list3: %s' % (list3))
                                                for j in range(len(list3)):
                                                    i = 0
                                                    print('16前缸號%s' % (list3[j][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(_processing_cylinder_list[
                                                                                     i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿23')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                                else:
                                                                    list3_1_tuple = ()
                                                                    list3_1_tuple += (list3[j][0],)
                                                                    list3_1_tuple += (list3[j][1],)
                                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                    list3_1.append(list3_1_tuple)
                                                                    print('list3_1:%s' % (list3_1))
                                                                    break
                                                            else:
                                                                print('預排入缸容量已滿24')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                        else:
                                                            continue
                                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                if k != (j + 1):
                                                    if len(list3_1) > 1:
                                                        j = 0
                                                        _diff_list = []
                                                        for j in range(len(list3_1)):
                                                            _temp_tuple = ()

                                                            _diff_max = 0
                                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                            _temp_tuple += (_diff_max,)
                                                            _temp_tuple += (list3_1[j][1],)
                                                            _temp_tuple += (list3_1[j][0],)

                                                            _diff_list.append(_temp_tuple)
                                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                    else:
                                                        _diff_list.append(list3_1_tuple)
                                                    print(_diff_list)
                                                    i = 0
                                                    print('18前缸號%s' % (_diff_list[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3>1')
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2],
                                                                            temp_tuple4[3], temp_tuple4[4],
                                                                            temp_tuple4[8], temp_tuple4[9],
                                                                            temp_tuple4[10], tmp_mac3)
                                                                        cnxn8.commit()

                                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                _dispatched_flag = ''
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue
                                            else:
                                                _dispatched_flag = 'F'
                                            break
                                        else:
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3],
                                                            temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                            temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                print(u"工單號 %s 已排入第%s缸中9" % (
                                                _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                print('list2=1規格不符')
                                                if len(list3) == 1:
                                                    i = 0
                                                    print('15前缸號%s' % (list3[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(_processing_cylinder_list[
                                                                                     i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿21')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                                else:
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3=1')
                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4], temp_tuple4[8],
                                                                                    temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                                            _test_no, _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                            else:
                                                                print('預排入缸容量已滿22')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue


                                                elif len(list3) > 1:
                                                    j = 0
                                                    k = 0
                                                    print('list3: %s' % (list3))
                                                    for j in range(len(list3)):
                                                        i = 0
                                                        print('16前缸號%s' % (list3[j][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿23')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                    else:
                                                                        list3_1_tuple = ()
                                                                        list3_1_tuple += (list3[j][0],)
                                                                        list3_1_tuple += (list3[j][1],)
                                                                        list3_1_tuple += (
                                                                        list3[j][5],)  # 20190108   取最大濃度
                                                                        list3_1.append(list3_1_tuple)
                                                                        print('list3_1:%s' % (list3_1))
                                                                        break
                                                                else:
                                                                    print('預排入缸容量已滿24')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                            else:
                                                                continue
                                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                    if k != (j + 1):
                                                        if len(list3_1) > 1:
                                                            j = 0
                                                            _diff_list = []
                                                            for j in range(len(list3_1)):
                                                                _temp_tuple = ()

                                                                _diff_max = 0
                                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                                _diff_max = abs(
                                                                    _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                _temp_tuple += (_diff_max,)
                                                                _temp_tuple += (list3_1[j][1],)
                                                                _temp_tuple += (list3_1[j][0],)

                                                                _diff_list.append(_temp_tuple)
                                                                _diff_list = sorted(_diff_list,
                                                                                    key=operator.itemgetter(0))
                                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                        else:
                                                            _diff_list.append(list3_1_tuple)
                                                        print(_diff_list)
                                                        i = 0
                                                        print('18前缸號%s' % (_diff_list[0][1]))
                                                        for i in range(0, len(
                                                                _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3>1')
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(_processing_cylinder_list[
                                                                                           i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4],
                                                                                temp_tuple4[8], temp_tuple4[9],
                                                                                temp_tuple4[10],
                                                                                tmp_mac3)
                                                                            cnxn8.commit()

                                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                    _dispatched_flag = ''
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue
                                                else:
                                                    _dispatched_flag = 'F'
                                                break
                                    else:
                                        # 20190109   思考list3預排缸已滿的後續處理，設定_dispatched_flag為F並進入隨機分配
                                        print('預排入缸容量已滿18')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        print('list2 null -> list3')
                                        if len(list3) == 1:
                                            i = 0
                                            print('15前缸號%s' % (list3[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[0][1]) == int(_temp_cy_no1):
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿21')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                        else:
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3=1')
                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2],
                                                                            temp_tuple4[3],
                                                                            temp_tuple4[4], temp_tuple4[8],
                                                                            temp_tuple4[9],
                                                                            temp_tuple4[10], tmp_mac3)
                                                                        cnxn8.commit()

                                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                print(u"工單號 %s 已排入第%s缸中11" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                    else:
                                                        print('預排入缸容量已滿22')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue


                                        elif len(list3) > 1:
                                            j = 0
                                            k = 0
                                            print('list3: %s' % (list3))
                                            for j in range(len(list3)):
                                                i = 0
                                                print('16前缸號%s' % (list3[j][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[j][1]) == int(_temp_cy_no1):
                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿23')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                            else:
                                                                list3_1_tuple = ()
                                                                list3_1_tuple += (list3[j][0],)
                                                                list3_1_tuple += (list3[j][1],)
                                                                list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                list3_1.append(list3_1_tuple)
                                                                print('list3_1:%s' % (list3_1))
                                                                break
                                                        else:
                                                            print('預排入缸容量已滿24')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                    else:
                                                        continue
                                            # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                            if k != (j + 1):
                                                if len(list3_1) > 1:
                                                    j = 0
                                                    _diff_list = []
                                                    for j in range(len(list3_1)):
                                                        _temp_tuple = ()

                                                        _diff_max = 0
                                                        _each_max = list3_1[j][2]  # 取出最大濃度
                                                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                        _temp_tuple += (_diff_max,)
                                                        _temp_tuple += (list3_1[j][1],)
                                                        _temp_tuple += (list3_1[j][0],)

                                                        _diff_list.append(_temp_tuple)
                                                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                else:
                                                    _diff_list.append(list3_1_tuple)
                                                print(_diff_list)
                                                i = 0
                                                print('18前缸號%s' % (_diff_list[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3>1')
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(_processing_cylinder_list[
                                                                                   i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4],
                                                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                        tmp_mac3)
                                                                    cnxn8.commit()

                                                            print(u"工單號 %s 已排入第%s缸中12" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                            _dispatched_flag = ''
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue
                                        else:
                                            _dispatched_flag = 'F'
                                        break
                                else:
                                    continue


                        elif len(list2) > 1:
                            j = 0
                            k = 0
                            print('list2: %s' % (list2))
                            for j in range(len(list2)):
                                i = 0
                                print('13前缸號%s' % (list2[j][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list2[j][1]) == int(_temp_cy_no1):
                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿19')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                # 20190111   避免全滿又進入listx_1的排缸
                                                k = k + 1
                                                break
                                            else:
                                                list2_1_tuple = ()
                                                list2_1_tuple += (list2[j][0],)
                                                list2_1_tuple += (list2[j][1],)
                                                list2_1_tuple += (list2[j][5],)  # 20190108   取最大濃度
                                                list2_1.append(list2_1_tuple)
                                                print('list2_1:%s' % (list2_1))
                                                break
                                        else:
                                            print('預排入缸容量已滿20')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            k = k + 1
                                            break
                                    else:
                                        continue
                            print(k)
                            print(j)
                            if k != (j + 1):
                                # 20190109   依照list2_1長度，判斷是否比較最大濃度
                                if len(list2_1) > 1:
                                    j = 0
                                    _diff_list = []
                                    for j in range(len(list2_1)):
                                        _temp_tuple = ()

                                        _diff_max = 0
                                        _each_max = list2_1[j][2]  # 取出最大濃度
                                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                        _temp_tuple += (_diff_max,)
                                        _temp_tuple += (list2_1[j][1],)
                                        _temp_tuple += (list2_1[j][0],)

                                        _diff_list.append(_temp_tuple)
                                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                else:
                                    _diff_list.append(list2_1_tuple)
                                print(_diff_list)
                                i = 0
                                print('14前缸號%s' % (_diff_list[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            _processing_cylinder_list[i].queue.enq(
                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                            # 0111:紀錄工單與濃度list中
                                            _temp_jobno_con_tuple += (_test_no,)
                                            _temp_jobno_con_tuple += (_test_con,)
                                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                            if _test_no != None:
                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                if temp_tuple4 != None:
                                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                        tmp_mac3 = 'D0' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D20' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                    else:
                                                        tmp_mac3 = 'D' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D2' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())

                                                    # 20181226   刪除schedule_before資料
                                                    cnxn9 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                    cursor9.execute(
                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                            tmp_mac3, tmp_mac4))
                                                    cnxn9.commit()

                                                    cnxn8 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                    cursor8.execute(
                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                        temp_tuple4[4],
                                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                    cnxn8.commit()

                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                            print(u"工單號 %s 已排入第%s缸中10" % (
                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                            _dispatched_flag = ''
                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                            if len(_temp_jobno_con_list) >= 8:
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                            break
                                        else:
                                            print('list2>1規格不符')
                                            if len(list3) == 1:
                                                i = 0
                                                print('15前缸號%s' % (list3[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿21')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                            else:
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3=1')
                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4], temp_tuple4[8],
                                                                                temp_tuple4[9],
                                                                                temp_tuple4[10], tmp_mac3)
                                                                            cnxn8.commit()

                                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                        else:
                                                            print('預排入缸容量已滿22')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue


                                            elif len(list3) > 1:
                                                j = 0
                                                k = 0
                                                print('list3: %s' % (list3))
                                                for j in range(len(list3)):
                                                    i = 0
                                                    print('16前缸號%s' % (list3[j][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿23')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                                else:
                                                                    list3_1_tuple = ()
                                                                    list3_1_tuple += (list3[j][0],)
                                                                    list3_1_tuple += (list3[j][1],)
                                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                    list3_1.append(list3_1_tuple)
                                                                    print('list3_1:%s' % (list3_1))
                                                                    break
                                                            else:
                                                                print('預排入缸容量已滿24')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                        else:
                                                            continue
                                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                if k != (j + 1):
                                                    if len(list3_1) > 1:
                                                        j = 0
                                                        _diff_list = []
                                                        for j in range(len(list3_1)):
                                                            _temp_tuple = ()

                                                            _diff_max = 0
                                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                            _temp_tuple += (_diff_max,)
                                                            _temp_tuple += (list3_1[j][1],)
                                                            _temp_tuple += (list3_1[j][0],)

                                                            _diff_list.append(_temp_tuple)
                                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                    else:
                                                        _diff_list.append(list3_1_tuple)
                                                    print(_diff_list)
                                                    i = 0
                                                    print('18前缸號%s' % (_diff_list[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3>1')
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(_processing_cylinder_list[
                                                                                       i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2],
                                                                            temp_tuple4[3],
                                                                            temp_tuple4[4],
                                                                            temp_tuple4[8], temp_tuple4[9],
                                                                            temp_tuple4[10],
                                                                            tmp_mac3)
                                                                        cnxn8.commit()

                                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                _dispatched_flag = ''
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue
                                            else:
                                                _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue
                            else:  # 20190111   list1全滿，找尋list2，以此類推[必須思考長度=1及>1兩種情況]
                                print('list2_1 null -> list3')
                                if len(list3) == 1:
                                    i = 0
                                    print('15前缸號%s' % (list3[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿21')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                                else:
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3=1')
                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(_processing_cylinder_list[
                                                                               i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                    temp_tuple4[10],
                                                                    tmp_mac3)
                                                                cnxn8.commit()

                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                            else:
                                                print('預排入缸容量已滿22')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue


                                elif len(list3) > 1:
                                    j = 0
                                    k = 0
                                    print('list3: %s' % (list3))
                                    for j in range(len(list3)):
                                        i = 0
                                        print('16前缸號%s' % (list3[j][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿23')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                    else:
                                                        list3_1_tuple = ()
                                                        list3_1_tuple += (list3[j][0],)
                                                        list3_1_tuple += (list3[j][1],)
                                                        list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                        list3_1.append(list3_1_tuple)
                                                        print('list3_1:%s' % (list3_1))
                                                        break
                                                else:
                                                    print('預排入缸容量已滿24')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                            else:
                                                continue
                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                    if k != (j + 1):
                                        if len(list3_1) > 1:
                                            j = 0
                                            _diff_list = []
                                            for j in range(len(list3_1)):
                                                _temp_tuple = ()

                                                _diff_max = 0
                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                _temp_tuple += (_diff_max,)
                                                _temp_tuple += (list3_1[j][1],)
                                                _temp_tuple += (list3_1[j][0],)

                                                _diff_list.append(_temp_tuple)
                                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                        else:
                                            _diff_list.append(list3_1_tuple)
                                        print(_diff_list)
                                        i = 0
                                        print('18前缸號%s' % (_diff_list[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3>1')
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4],
                                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                    _dispatched_flag = ''
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue
                                else:
                                    _dispatched_flag = 'F'
                        else:
                            if len(list3) == 1:
                                i = 0
                                print('15前缸號%s' % (list3[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿21')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                            else:
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3=1')
                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                temp_tuple4[10], tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                        else:
                                            print('預排入缸容量已滿22')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue


                            elif len(list3) > 1:
                                j = 0
                                k = 0
                                print('list3: %s' % (list3))
                                for j in range(len(list3)):
                                    i = 0
                                    print('16前缸號%s' % (list3[j][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿23')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                                else:
                                                    list3_1_tuple = ()
                                                    list3_1_tuple += (list3[j][0],)
                                                    list3_1_tuple += (list3[j][1],)
                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                    list3_1.append(list3_1_tuple)
                                                    print('list3_1:%s' % (list3_1))
                                                    break
                                            else:
                                                print('預排入缸容量已滿24')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                k = k + 1
                                                break
                                        else:
                                            continue
                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                if k != (j + 1):
                                    if len(list3_1) > 1:
                                        j = 0
                                        _diff_list = []
                                        for j in range(len(list3_1)):
                                            _temp_tuple = ()

                                            _diff_max = 0
                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                            _temp_tuple += (_diff_max,)
                                            _temp_tuple += (list3_1[j][1],)
                                            _temp_tuple += (list3_1[j][0],)

                                            _diff_list.append(_temp_tuple)
                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                    else:
                                        _diff_list.append(list3_1_tuple)
                                    print(_diff_list)
                                    i = 0
                                    print('18前缸號%s' % (_diff_list[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                print('太好了list3>1')
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3], temp_tuple4[4],
                                                            temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                _dispatched_flag = ''
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue
                            else:
                                _dispatched_flag = 'F'
                        break
                else:
                    continue


        elif len(list1) > 1:    #20190112   思考list1 full -> list2 list3
            j = 0
            k = 0
            print('list1: %s' % (list1))
            for j in range(len(list1)):
                i = 0
                print('10前缸號%s' % (list1[j][1]))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(list1[j][1]) == int(_temp_cy_no1):
                        queue_flag = False
                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                            # 0115:這邊要去設定queue flag
                            queue_size = 0
                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                print(u'預排入缸容量已滿15')
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                k = k + 1
                                break
                            else:
                                list1_1_tuple = ()
                                list1_1_tuple += (list1[j][0],)
                                list1_1_tuple += (list1[j][1],)
                                list1_1_tuple += (list1[j][5],) #20190108   取最大濃度
                                list1_1.append(list1_1_tuple)
                                print('list1_1:%s' % (list1_1))
                                break
                        else:
                            print('預排入缸容量已滿16')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            k = k + 1
                            break
                    else:
                        continue
            # 20190109   依照list1_1長度，判斷是否比較最大濃度
            print(k)
            print(j)
            if k != (j+1):
                if len(list1_1) > 1:
                    j = 0
                    _diff_list = []
                    for j in range(len(list1_1)):
                        _temp_tuple = ()

                        _diff_max = 0
                        _each_max = list1_1[j][2]  # 取出最大濃度
                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                        _temp_tuple += (_diff_max,)
                        _temp_tuple += (list1_1[j][1],)
                        _temp_tuple += (list1_1[j][0],)

                        _diff_list.append(_temp_tuple)
                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                else:
                    _diff_list.append(list1_1_tuple)
                print(_diff_list)

                i = 0
                print('11前缸號%s' % (_diff_list[0][1]))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                        _temp_weight = _processing_cylinder_list[i].get_weight()
                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                            _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                            # 0111:紀錄工單與濃度list中
                            _temp_jobno_con_tuple += (_test_no,)
                            _temp_jobno_con_tuple += (_test_con,)
                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                            if _test_no != None:
                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                if temp_tuple4 != None:
                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                        tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                    else:
                                        tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                    # 20181226   刪除schedule_before資料
                                    cnxn9 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                    cursor9.execute(
                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                        tmp_mac3, tmp_mac4))
                                    cnxn9.commit()

                                    cnxn8 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                    cursor8.execute(
                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3], temp_tuple4[4],
                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                    cnxn8.commit()

                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                            print(u"工單號 %s 已排入第%s缸中8" % (_test_no, _processing_cylinder_list[i].get_cylinder_no()))
                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                            _dispatched_flag = ''
                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                            if len(_temp_jobno_con_list) >= 8:
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                            break
                        else:
                            print('list1>1規格不符')
                            if len(list2) == 1:
                                i = 0
                                print('12前缸號%s' % (list2[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list2[0][1]) == int(_temp_cy_no1):
                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿17')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                print('list2 null -> list3')
                                                if len(list3) == 1:
                                                    i = 0
                                                    print('15前缸號%s' % (list3[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿21')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                                else:
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3=1')
                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(_processing_cylinder_list[
                                                                                               i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4], temp_tuple4[8],
                                                                                    temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                                            _test_no,
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                            else:
                                                                print('預排入缸容量已滿22')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue


                                                elif len(list3) > 1:
                                                    j = 0
                                                    k = 0
                                                    print('list3: %s' % (list3))
                                                    for j in range(len(list3)):
                                                        i = 0
                                                        print('16前缸號%s' % (list3[j][1]))
                                                        for i in range(0,
                                                                       len(
                                                                           _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿23')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                    else:
                                                                        list3_1_tuple = ()
                                                                        list3_1_tuple += (list3[j][0],)
                                                                        list3_1_tuple += (list3[j][1],)
                                                                        list3_1_tuple += (
                                                                        list3[j][5],)  # 20190108   取最大濃度
                                                                        list3_1.append(list3_1_tuple)
                                                                        print('list3_1:%s' % (list3_1))
                                                                        break
                                                                else:
                                                                    print('預排入缸容量已滿24')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                            else:
                                                                continue
                                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                    if k != (j + 1):
                                                        if len(list3_1) > 1:
                                                            j = 0
                                                            _diff_list = []
                                                            for j in range(len(list3_1)):
                                                                _temp_tuple = ()

                                                                _diff_max = 0
                                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                                _diff_max = abs(
                                                                    _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                _temp_tuple += (_diff_max,)
                                                                _temp_tuple += (list3_1[j][1],)
                                                                _temp_tuple += (list3_1[j][0],)

                                                                _diff_list.append(_temp_tuple)
                                                                _diff_list = sorted(_diff_list,
                                                                                    key=operator.itemgetter(0))
                                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                        else:
                                                            _diff_list.append(list3_1_tuple)
                                                        print(_diff_list)
                                                        i = 0
                                                        print('18前缸號%s' % (_diff_list[0][1]))
                                                        for i in range(0,
                                                                       len(
                                                                           _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3>1')
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3], temp_tuple4[4],
                                                                                temp_tuple4[8], temp_tuple4[9],
                                                                                temp_tuple4[10],
                                                                                tmp_mac3)
                                                                            cnxn8.commit()

                                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                    _dispatched_flag = ''
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue
                                                else:
                                                    _dispatched_flag = 'F'
                                                break
                                            else:
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s缸中9" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    print('list2=1規格不符')
                                                    if len(list3) == 1:
                                                        i = 0
                                                        print('15前缸號%s' % (list3[0][1]))
                                                        for i in range(0,
                                                                       len(
                                                                           _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿21')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                    else:
                                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                        _temp_weight = _processing_cylinder_list[
                                                                            i].get_weight()
                                                                        _temp_yard_length = _processing_cylinder_list[
                                                                            i].get_yard_length()
                                                                        if (_test_qty <= _temp_weight) and (
                                                                                _test_yard <= _temp_yard_length):
                                                                            print('太好了list3=1')
                                                                            _processing_cylinder_list[i].queue.enq(
                                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                            # 0111:紀錄工單與濃度list中
                                                                            _temp_jobno_con_tuple += (_test_no,)
                                                                            _temp_jobno_con_tuple += (_test_con,)
                                                                            _temp_jobno_con_list = \
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list()
                                                                            _temp_jobno_con_list.append(
                                                                                _temp_jobno_con_tuple)
                                                                            _processing_cylinder_list[
                                                                                i].set_cylinder_con_list(
                                                                                _temp_jobno_con_list)

                                                                            if _test_no != None:
                                                                                temp_tuple4 = search_tuple_from_joblist(
                                                                                    _test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                                if temp_tuple4 != None:
                                                                                    if len(str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())) == 1:
                                                                                        tmp_mac3 = 'D0' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D20' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                    else:
                                                                                        tmp_mac3 = 'D' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())
                                                                                        tmp_mac4 = 'D2' + str(
                                                                                            _processing_cylinder_list[
                                                                                                i].get_cylinder_no())

                                                                                    # 20181226   刪除schedule_before資料
                                                                                    cnxn9 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                    cursor9.execute(
                                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                            tmp_mac3, tmp_mac4))
                                                                                    cnxn9.commit()

                                                                                    cnxn8 = pyodbc.connect(
                                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                    cursor8.execute(
                                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                        temp_tuple4[0], temp_tuple4[1],
                                                                                        temp_tuple4[2],
                                                                                        temp_tuple4[3],
                                                                                        temp_tuple4[4], temp_tuple4[8],
                                                                                        temp_tuple4[9],
                                                                                        temp_tuple4[10], tmp_mac3)
                                                                                    cnxn8.commit()

                                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                                _test_no,
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no()))
                                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                            if len(_temp_jobno_con_list) >= 8:
                                                                                _processing_cylinder_list[
                                                                                    i].set_queue_full_flag(
                                                                                    True)
                                                                            break
                                                                        else:
                                                                            _dispatched_flag = 'F'
                                                                            break
                                                                else:
                                                                    print('預排入缸容量已滿22')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue


                                                    elif len(list3) > 1:
                                                        j = 0
                                                        k = 0
                                                        print('list3: %s' % (list3))
                                                        for j in range(len(list3)):
                                                            i = 0
                                                            print('16前缸號%s' % (list3[j][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                                    queue_flag = False
                                                                    queue_flag = _processing_cylinder_list[
                                                                        i].get_queue_full_flag()

                                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                        # 0115:這邊要去設定queue flag
                                                                        queue_size = 0
                                                                        queue_size = len(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_con_list())
                                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                            print(u'預排入缸容量已滿23')
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                            _dispatched_flag = 'F'
                                                                            k = k + 1
                                                                            break
                                                                        else:
                                                                            list3_1_tuple = ()
                                                                            list3_1_tuple += (list3[j][0],)
                                                                            list3_1_tuple += (list3[j][1],)
                                                                            list3_1_tuple += (
                                                                            list3[j][5],)  # 20190108   取最大濃度
                                                                            list3_1.append(list3_1_tuple)
                                                                            print('list3_1:%s' % (list3_1))
                                                                            break
                                                                    else:
                                                                        print('預排入缸容量已滿24')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                else:
                                                                    continue
                                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                        if k != (j + 1):
                                                            if len(list3_1) > 1:
                                                                j = 0
                                                                _diff_list = []
                                                                for j in range(len(list3_1)):
                                                                    _temp_tuple = ()

                                                                    _diff_max = 0
                                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                                    _diff_max = abs(
                                                                        _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                    _temp_tuple += (_diff_max,)
                                                                    _temp_tuple += (list3_1[j][1],)
                                                                    _temp_tuple += (list3_1[j][0],)

                                                                    _diff_list.append(_temp_tuple)
                                                                    _diff_list = sorted(_diff_list,
                                                                                        key=operator.itemgetter(0))
                                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                            else:
                                                                _diff_list.append(list3_1_tuple)
                                                            print(_diff_list)
                                                            i = 0
                                                            print('18前缸號%s' % (_diff_list[0][1]))
                                                            for i in range(0, len(
                                                                    _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                                _temp_cy_no1 = _processing_cylinder_list[
                                                                    i].get_cylinder_no()
                                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3>1')
                                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(_processing_cylinder_list[
                                                                                               i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4],
                                                                                    temp_tuple4[8], temp_tuple4[9],
                                                                                    temp_tuple4[10],
                                                                                    tmp_mac3)
                                                                                cnxn8.commit()

                                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                                            _test_no,
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                        _dispatched_flag = ''
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                                else:
                                                                    continue
                                                    else:
                                                        _dispatched_flag = 'F'
                                                    break
                                        else:
                                            # 20190109   思考list3預排缸已滿的後續處理，設定_dispatched_flag為F並進入隨機分配
                                            print('預排入缸容量已滿18')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            print('list2 null -> list3')
                                            if len(list3) == 1:
                                                i = 0
                                                print('15前缸號%s' % (list3[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿21')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                            else:
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3=1')
                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4], temp_tuple4[8],
                                                                                temp_tuple4[9],
                                                                                temp_tuple4[10], tmp_mac3)
                                                                            cnxn8.commit()

                                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                        else:
                                                            print('預排入缸容量已滿22')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue


                                            elif len(list3) > 1:
                                                j = 0
                                                k = 0
                                                print('list3: %s' % (list3))
                                                for j in range(len(list3)):
                                                    i = 0
                                                    print('16前缸號%s' % (list3[j][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿23')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                                else:
                                                                    list3_1_tuple = ()
                                                                    list3_1_tuple += (list3[j][0],)
                                                                    list3_1_tuple += (list3[j][1],)
                                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                    list3_1.append(list3_1_tuple)
                                                                    print('list3_1:%s' % (list3_1))
                                                                    break
                                                            else:
                                                                print('預排入缸容量已滿24')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                        else:
                                                            continue
                                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                if k != (j + 1):
                                                    if len(list3_1) > 1:
                                                        j = 0
                                                        _diff_list = []
                                                        for j in range(len(list3_1)):
                                                            _temp_tuple = ()

                                                            _diff_max = 0
                                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                            _temp_tuple += (_diff_max,)
                                                            _temp_tuple += (list3_1[j][1],)
                                                            _temp_tuple += (list3_1[j][0],)

                                                            _diff_list.append(_temp_tuple)
                                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                    else:
                                                        _diff_list.append(list3_1_tuple)
                                                    print(_diff_list)
                                                    i = 0
                                                    print('18前缸號%s' % (_diff_list[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3>1')
                                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(_processing_cylinder_list[
                                                                                       i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2],
                                                                            temp_tuple4[3],
                                                                            temp_tuple4[4],
                                                                            temp_tuple4[8], temp_tuple4[9],
                                                                            temp_tuple4[10],
                                                                            tmp_mac3)
                                                                        cnxn8.commit()

                                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                _dispatched_flag = ''
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue
                                            else:
                                                _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue


                            elif len(list2) > 1:
                                j = 0
                                k = 0
                                print('list2: %s' % (list2))
                                for j in range(len(list2)):
                                    i = 0
                                    print('13前缸號%s' % (list2[j][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list2[j][1]) == int(_temp_cy_no1):
                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿19')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    # 20190111   避免全滿又進入listx_1的排缸
                                                    k = k + 1
                                                    break
                                                else:
                                                    list2_1_tuple = ()
                                                    list2_1_tuple += (list2[j][0],)
                                                    list2_1_tuple += (list2[j][1],)
                                                    list2_1_tuple += (list2[j][5],)  # 20190108   取最大濃度
                                                    list2_1.append(list2_1_tuple)
                                                    print('list2_1:%s' % (list2_1))
                                                    break
                                            else:
                                                print('預排入缸容量已滿20')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                k = k + 1
                                                break
                                        else:
                                            continue
                                print(k)
                                print(j)
                                if k != (j + 1):
                                    # 20190109   依照list2_1長度，判斷是否比較最大濃度
                                    if len(list2_1) > 1:
                                        j = 0
                                        _diff_list = []
                                        for j in range(len(list2_1)):
                                            _temp_tuple = ()

                                            _diff_max = 0
                                            _each_max = list2_1[j][2]  # 取出最大濃度
                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                            _temp_tuple += (_diff_max,)
                                            _temp_tuple += (list2_1[j][1],)
                                            _temp_tuple += (list2_1[j][0],)

                                            _diff_list.append(_temp_tuple)
                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                    else:
                                        _diff_list.append(list2_1_tuple)
                                    print(_diff_list)
                                    i = 0
                                    print('14前缸號%s' % (_diff_list[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3],
                                                            temp_tuple4[4],
                                                            temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                print(u"工單號 %s 已排入第%s缸中10" % (
                                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                _dispatched_flag = ''
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                print('list2>1規格不符')
                                                if len(list3) == 1:
                                                    i = 0
                                                    print('15前缸號%s' % (list3[0][1]))
                                                    for i in range(0, len(
                                                            _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            queue_flag = False
                                                            queue_flag = _processing_cylinder_list[
                                                                i].get_queue_full_flag()

                                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                # 0115:這邊要去設定queue flag
                                                                queue_size = 0
                                                                queue_size = len(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_con_list())
                                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                    print(u'預排入缸容量已滿21')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                                else:
                                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                    _temp_weight = _processing_cylinder_list[
                                                                        i].get_weight()
                                                                    _temp_yard_length = _processing_cylinder_list[
                                                                        i].get_yard_length()
                                                                    if (_test_qty <= _temp_weight) and (
                                                                            _test_yard <= _temp_yard_length):
                                                                        print('太好了list3=1')
                                                                        _processing_cylinder_list[i].queue.enq(
                                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                        # 0111:紀錄工單與濃度list中
                                                                        _temp_jobno_con_tuple += (_test_no,)
                                                                        _temp_jobno_con_tuple += (_test_con,)
                                                                        _temp_jobno_con_list = \
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list()
                                                                        _temp_jobno_con_list.append(
                                                                            _temp_jobno_con_tuple)
                                                                        _processing_cylinder_list[
                                                                            i].set_cylinder_con_list(
                                                                            _temp_jobno_con_list)

                                                                        if _test_no != None:
                                                                            temp_tuple4 = search_tuple_from_joblist(
                                                                                _test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                            if temp_tuple4 != None:
                                                                                if len(str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())) == 1:
                                                                                    tmp_mac3 = 'D0' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D20' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                else:
                                                                                    tmp_mac3 = 'D' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())
                                                                                    tmp_mac4 = 'D2' + str(
                                                                                        _processing_cylinder_list[
                                                                                            i].get_cylinder_no())

                                                                                # 20181226   刪除schedule_before資料
                                                                                cnxn9 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                                cursor9.execute(
                                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                        tmp_mac3, tmp_mac4))
                                                                                cnxn9.commit()

                                                                                cnxn8 = pyodbc.connect(
                                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                                cursor8.execute(
                                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                    temp_tuple4[0], temp_tuple4[1],
                                                                                    temp_tuple4[2],
                                                                                    temp_tuple4[3],
                                                                                    temp_tuple4[4], temp_tuple4[8],
                                                                                    temp_tuple4[9],
                                                                                    temp_tuple4[10], tmp_mac3)
                                                                                cnxn8.commit()

                                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                                            _test_no,
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no()))
                                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                        if len(_temp_jobno_con_list) >= 8:
                                                                            _processing_cylinder_list[
                                                                                i].set_queue_full_flag(True)
                                                                        break
                                                                    else:
                                                                        _dispatched_flag = 'F'
                                                                        break
                                                            else:
                                                                print('預排入缸容量已滿22')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                break
                                                        else:
                                                            continue


                                                elif len(list3) > 1:
                                                    j = 0
                                                    k = 0
                                                    print('list3: %s' % (list3))
                                                    for j in range(len(list3)):
                                                        i = 0
                                                        print('16前缸號%s' % (list3[j][1]))
                                                        for i in range(0,
                                                                       len(
                                                                           _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                                queue_flag = False
                                                                queue_flag = _processing_cylinder_list[
                                                                    i].get_queue_full_flag()

                                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                                    # 0115:這邊要去設定queue flag
                                                                    queue_size = 0
                                                                    queue_size = len(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_con_list())
                                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                        print(u'預排入缸容量已滿23')
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                        _dispatched_flag = 'F'
                                                                        k = k + 1
                                                                        break
                                                                    else:
                                                                        list3_1_tuple = ()
                                                                        list3_1_tuple += (list3[j][0],)
                                                                        list3_1_tuple += (list3[j][1],)
                                                                        list3_1_tuple += (
                                                                        list3[j][5],)  # 20190108   取最大濃度
                                                                        list3_1.append(list3_1_tuple)
                                                                        print('list3_1:%s' % (list3_1))
                                                                        break
                                                                else:
                                                                    print('預排入缸容量已滿24')
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                    _dispatched_flag = 'F'
                                                                    k = k + 1
                                                                    break
                                                            else:
                                                                continue
                                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                                    if k != (j + 1):
                                                        if len(list3_1) > 1:
                                                            j = 0
                                                            _diff_list = []
                                                            for j in range(len(list3_1)):
                                                                _temp_tuple = ()

                                                                _diff_max = 0
                                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                                _diff_max = abs(
                                                                    _each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                                _temp_tuple += (_diff_max,)
                                                                _temp_tuple += (list3_1[j][1],)
                                                                _temp_tuple += (list3_1[j][0],)

                                                                _diff_list.append(_temp_tuple)
                                                                _diff_list = sorted(_diff_list,
                                                                                    key=operator.itemgetter(0))
                                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                        else:
                                                            _diff_list.append(list3_1_tuple)
                                                        print(_diff_list)
                                                        i = 0
                                                        print('18前缸號%s' % (_diff_list[0][1]))
                                                        for i in range(0,
                                                                       len(
                                                                           _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                            _temp_cy_no1 = _processing_cylinder_list[
                                                                i].get_cylinder_no()
                                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                                _temp_yard_length = _processing_cylinder_list[
                                                                    i].get_yard_length()
                                                                if (_test_qty <= _temp_weight) and (
                                                                        _test_yard <= _temp_yard_length):
                                                                    print('太好了list3>1')
                                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                                    _processing_cylinder_list[i].queue.enq(
                                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                    # 0111:紀錄工單與濃度list中
                                                                    _temp_jobno_con_tuple += (_test_no,)
                                                                    _temp_jobno_con_tuple += (_test_con,)
                                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                                        i].get_cylinder_con_list()
                                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                                        _temp_jobno_con_list)

                                                                    if _test_no != None:
                                                                        temp_tuple4 = search_tuple_from_joblist(
                                                                            _test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                        if temp_tuple4 != None:
                                                                            if len(str(_processing_cylinder_list[
                                                                                           i].get_cylinder_no())) == 1:
                                                                                tmp_mac3 = 'D0' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D20' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                            else:
                                                                                tmp_mac3 = 'D' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())
                                                                                tmp_mac4 = 'D2' + str(
                                                                                    _processing_cylinder_list[
                                                                                        i].get_cylinder_no())

                                                                            # 20181226   刪除schedule_before資料
                                                                            cnxn9 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                            cursor9.execute(
                                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                    tmp_mac3, tmp_mac4))
                                                                            cnxn9.commit()

                                                                            cnxn8 = pyodbc.connect(
                                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                                            cursor8.execute(
                                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                                temp_tuple4[0], temp_tuple4[1],
                                                                                temp_tuple4[2],
                                                                                temp_tuple4[3],
                                                                                temp_tuple4[4],
                                                                                temp_tuple4[8], temp_tuple4[9],
                                                                                temp_tuple4[10],
                                                                                tmp_mac3)
                                                                            cnxn8.commit()

                                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                                        _test_no,
                                                                        _processing_cylinder_list[i].get_cylinder_no()))
                                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                                    _dispatched_flag = ''
                                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                    if len(_temp_jobno_con_list) >= 8:
                                                                        _processing_cylinder_list[
                                                                            i].set_queue_full_flag(True)
                                                                    break
                                                                else:
                                                                    _dispatched_flag = 'F'
                                                                    break
                                                            else:
                                                                continue
                                                else:
                                                    _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue
                                else:  # 20190111   list1全滿，找尋list2，以此類推[必須思考長度=1及>1兩種情況]
                                    print('list2_1 null -> list3')
                                    if len(list3) == 1:
                                        i = 0
                                        print('15前缸號%s' % (list3[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿21')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                    else:
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3=1')
                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                        temp_tuple4[10],
                                                                        tmp_mac3)
                                                                    cnxn8.commit()

                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                else:
                                                    print('預排入缸容量已滿22')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue


                                    elif len(list3) > 1:
                                        j = 0
                                        k = 0
                                        print('list3: %s' % (list3))
                                        for j in range(len(list3)):
                                            i = 0
                                            print('16前缸號%s' % (list3[j][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿23')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                        else:
                                                            list3_1_tuple = ()
                                                            list3_1_tuple += (list3[j][0],)
                                                            list3_1_tuple += (list3[j][1],)
                                                            list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                            list3_1.append(list3_1_tuple)
                                                            print('list3_1:%s' % (list3_1))
                                                            break
                                                    else:
                                                        print('預排入缸容量已滿24')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                else:
                                                    continue
                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                        if k != (j + 1):
                                            if len(list3_1) > 1:
                                                j = 0
                                                _diff_list = []
                                                for j in range(len(list3_1)):
                                                    _temp_tuple = ()

                                                    _diff_max = 0
                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                    _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                    _temp_tuple += (_diff_max,)
                                                    _temp_tuple += (list3_1[j][1],)
                                                    _temp_tuple += (list3_1[j][0],)

                                                    _diff_list.append(_temp_tuple)
                                                    _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                            else:
                                                _diff_list.append(list3_1_tuple)
                                            print(_diff_list)
                                            i = 0
                                            print('18前缸號%s' % (_diff_list[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3>1')
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(_processing_cylinder_list[
                                                                               i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4],
                                                                    temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                    tmp_mac3)
                                                                cnxn8.commit()

                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                        _dispatched_flag = ''
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue
                                    else:
                                        _dispatched_flag = 'F'
                            else:
                                if len(list3) == 1:
                                    i = 0
                                    print('15前缸號%s' % (list3[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿21')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                                else:
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3=1')
                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(_processing_cylinder_list[
                                                                               i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                    temp_tuple4[10], tmp_mac3)
                                                                cnxn8.commit()

                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                            else:
                                                print('預排入缸容量已滿22')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue


                                elif len(list3) > 1:
                                    j = 0
                                    k = 0
                                    print('list3: %s' % (list3))
                                    for j in range(len(list3)):
                                        i = 0
                                        print('16前缸號%s' % (list3[j][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿23')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                    else:
                                                        list3_1_tuple = ()
                                                        list3_1_tuple += (list3[j][0],)
                                                        list3_1_tuple += (list3[j][1],)
                                                        list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                        list3_1.append(list3_1_tuple)
                                                        print('list3_1:%s' % (list3_1))
                                                        break
                                                else:
                                                    print('預排入缸容量已滿24')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                            else:
                                                continue
                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                    if k != (j + 1):
                                        if len(list3_1) > 1:
                                            j = 0
                                            _diff_list = []
                                            for j in range(len(list3_1)):
                                                _temp_tuple = ()

                                                _diff_max = 0
                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                _temp_tuple += (_diff_max,)
                                                _temp_tuple += (list3_1[j][1],)
                                                _temp_tuple += (list3_1[j][0],)

                                                _diff_list.append(_temp_tuple)
                                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                        else:
                                            _diff_list.append(list3_1_tuple)
                                        print(_diff_list)
                                        i = 0
                                        print('18前缸號%s' % (_diff_list[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3>1')
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3], temp_tuple4[4],
                                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                    _dispatched_flag = ''
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue
                                else:
                                    _dispatched_flag = 'F'
                            break
                    else:
                        continue
            else:
                print('list1_1 null -> list2 -> list3')
                if len(list2) == 1:
                    i = 0
                    print('12前缸號%s' % (list2[0][1]))
                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                        if int(list2[0][1]) == int(_temp_cy_no1):
                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                            queue_flag = False
                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                # 0115:這邊要去設定queue flag
                                queue_size = 0
                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                    print(u'預排入缸容量已滿17')
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                    print('list2 null -> list3')
                                    if len(list3) == 1:
                                        i = 0
                                        print('15前缸號%s' % (list3[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿21')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                    else:
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3=1')
                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(_processing_cylinder_list[
                                                                                   i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                        temp_tuple4[10], tmp_mac3)
                                                                    cnxn8.commit()

                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                else:
                                                    print('預排入缸容量已滿22')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue


                                    elif len(list3) > 1:
                                        j = 0
                                        k = 0
                                        print('list3: %s' % (list3))
                                        for j in range(len(list3)):
                                            i = 0
                                            print('16前缸號%s' % (list3[j][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿23')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                        else:
                                                            list3_1_tuple = ()
                                                            list3_1_tuple += (list3[j][0],)
                                                            list3_1_tuple += (list3[j][1],)
                                                            list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                            list3_1.append(list3_1_tuple)
                                                            print('list3_1:%s' % (list3_1))
                                                            break
                                                    else:
                                                        print('預排入缸容量已滿24')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                else:
                                                    continue
                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                        if k != (j + 1):
                                            if len(list3_1) > 1:
                                                j = 0
                                                _diff_list = []
                                                for j in range(len(list3_1)):
                                                    _temp_tuple = ()

                                                    _diff_max = 0
                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                    _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                    _temp_tuple += (_diff_max,)
                                                    _temp_tuple += (list3_1[j][1],)
                                                    _temp_tuple += (list3_1[j][0],)

                                                    _diff_list.append(_temp_tuple)
                                                    _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                            else:
                                                _diff_list.append(list3_1_tuple)
                                            print(_diff_list)
                                            i = 0
                                            print('18前缸號%s' % (_diff_list[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3>1')
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3], temp_tuple4[4],
                                                                    temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                    tmp_mac3)
                                                                cnxn8.commit()

                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                        _dispatched_flag = ''
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue
                                    else:
                                        _dispatched_flag = 'F'
                                    break
                                else:
                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                    if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                        _processing_cylinder_list[i].queue.enq(
                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                        # 0111:紀錄工單與濃度list中
                                        _temp_jobno_con_tuple += (_test_no,)
                                        _temp_jobno_con_tuple += (_test_con,)
                                        _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                        _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                        if _test_no != None:
                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                            if temp_tuple4 != None:
                                                if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                    tmp_mac3 = 'D0' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                    tmp_mac4 = 'D20' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                else:
                                                    tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                    tmp_mac4 = 'D2' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                # 20181226   刪除schedule_before資料
                                                cnxn9 = pyodbc.connect(
                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                cursor9.execute(
                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                        tmp_mac3, tmp_mac4))
                                                cnxn9.commit()

                                                cnxn8 = pyodbc.connect(
                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                cursor8.execute(
                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                    tmp_mac3)
                                                cnxn8.commit()

                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                        print(u"工單號 %s 已排入第%s缸中9" % (
                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                        if len(_temp_jobno_con_list) >= 8:
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                        break
                                    else:
                                        print('list2=1規格不符')
                                        if len(list3) == 1:
                                            i = 0
                                            print('15前缸號%s' % (list3[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[0][1]) == int(_temp_cy_no1):
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿21')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            break
                                                        else:
                                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                                            _temp_yard_length = _processing_cylinder_list[
                                                                i].get_yard_length()
                                                            if (_test_qty <= _temp_weight) and (
                                                                    _test_yard <= _temp_yard_length):
                                                                print('太好了list3=1')
                                                                _processing_cylinder_list[i].queue.enq(
                                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                                # 0111:紀錄工單與濃度list中
                                                                _temp_jobno_con_tuple += (_test_no,)
                                                                _temp_jobno_con_tuple += (_test_con,)
                                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                                    i].get_cylinder_con_list()
                                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                                    _temp_jobno_con_list)

                                                                if _test_no != None:
                                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                    if temp_tuple4 != None:
                                                                        if len(str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())) == 1:
                                                                            tmp_mac3 = 'D0' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D20' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                        else:
                                                                            tmp_mac3 = 'D' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())
                                                                            tmp_mac4 = 'D2' + str(
                                                                                _processing_cylinder_list[
                                                                                    i].get_cylinder_no())

                                                                        # 20181226   刪除schedule_before資料
                                                                        cnxn9 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                        cursor9.execute(
                                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                                tmp_mac3, tmp_mac4))
                                                                        cnxn9.commit()

                                                                        cnxn8 = pyodbc.connect(
                                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                                        cursor8.execute(
                                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                            temp_tuple4[0], temp_tuple4[1],
                                                                            temp_tuple4[2],
                                                                            temp_tuple4[3],
                                                                            temp_tuple4[4], temp_tuple4[8],
                                                                            temp_tuple4[9],
                                                                            temp_tuple4[10], tmp_mac3)
                                                                        cnxn8.commit()

                                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                                print(u"工單號 %s 已排入第%s缸中11" % (
                                                                    _test_no,
                                                                    _processing_cylinder_list[i].get_cylinder_no()))
                                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                                if len(_temp_jobno_con_list) >= 8:
                                                                    _processing_cylinder_list[i].set_queue_full_flag(
                                                                        True)
                                                                break
                                                            else:
                                                                _dispatched_flag = 'F'
                                                                break
                                                    else:
                                                        print('預排入缸容量已滿22')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue


                                        elif len(list3) > 1:
                                            j = 0
                                            k = 0
                                            print('list3: %s' % (list3))
                                            for j in range(len(list3)):
                                                i = 0
                                                print('16前缸號%s' % (list3[j][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(list3[j][1]) == int(_temp_cy_no1):
                                                        queue_flag = False
                                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                            # 0115:這邊要去設定queue flag
                                                            queue_size = 0
                                                            queue_size = len(
                                                                _processing_cylinder_list[i].get_cylinder_con_list())
                                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                                print(u'預排入缸容量已滿23')
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                                _dispatched_flag = 'F'
                                                                k = k + 1
                                                                break
                                                            else:
                                                                list3_1_tuple = ()
                                                                list3_1_tuple += (list3[j][0],)
                                                                list3_1_tuple += (list3[j][1],)
                                                                list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                                list3_1.append(list3_1_tuple)
                                                                print('list3_1:%s' % (list3_1))
                                                                break
                                                        else:
                                                            print('預排入缸容量已滿24')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                    else:
                                                        continue
                                            # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                            if k != (j + 1):
                                                if len(list3_1) > 1:
                                                    j = 0
                                                    _diff_list = []
                                                    for j in range(len(list3_1)):
                                                        _temp_tuple = ()

                                                        _diff_max = 0
                                                        _each_max = list3_1[j][2]  # 取出最大濃度
                                                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                        _temp_tuple += (_diff_max,)
                                                        _temp_tuple += (list3_1[j][1],)
                                                        _temp_tuple += (list3_1[j][0],)

                                                        _diff_list.append(_temp_tuple)
                                                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                                else:
                                                    _diff_list.append(list3_1_tuple)
                                                print(_diff_list)
                                                i = 0
                                                print('18前缸號%s' % (_diff_list[0][1]))
                                                for i in range(0, len(
                                                        _processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3>1')
                                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(_processing_cylinder_list[
                                                                                   i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4],
                                                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                        tmp_mac3)
                                                                    cnxn8.commit()

                                                            print(u"工單號 %s 已排入第%s缸中12" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                            _dispatched_flag = ''
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                    else:
                                                        continue
                                        else:
                                            _dispatched_flag = 'F'
                                        break
                            else:
                                # 20190109   思考list3預排缸已滿的後續處理，設定_dispatched_flag為F並進入隨機分配
                                print('預排入缸容量已滿18')
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                print('list2 null -> list3')
                                if len(list3) == 1:
                                    i = 0
                                    print('15前缸號%s' % (list3[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿21')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                                else:
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3=1')
                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                    temp_tuple4[10], tmp_mac3)
                                                                cnxn8.commit()

                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                            else:
                                                print('預排入缸容量已滿22')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue


                                elif len(list3) > 1:
                                    j = 0
                                    k = 0
                                    print('list3: %s' % (list3))
                                    for j in range(len(list3)):
                                        i = 0
                                        print('16前缸號%s' % (list3[j][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿23')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                    else:
                                                        list3_1_tuple = ()
                                                        list3_1_tuple += (list3[j][0],)
                                                        list3_1_tuple += (list3[j][1],)
                                                        list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                        list3_1.append(list3_1_tuple)
                                                        print('list3_1:%s' % (list3_1))
                                                        break
                                                else:
                                                    print('預排入缸容量已滿24')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                            else:
                                                continue
                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                    if k != (j + 1):
                                        if len(list3_1) > 1:
                                            j = 0
                                            _diff_list = []
                                            for j in range(len(list3_1)):
                                                _temp_tuple = ()

                                                _diff_max = 0
                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                _temp_tuple += (_diff_max,)
                                                _temp_tuple += (list3_1[j][1],)
                                                _temp_tuple += (list3_1[j][0],)

                                                _diff_list.append(_temp_tuple)
                                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                        else:
                                            _diff_list.append(list3_1_tuple)
                                        print(_diff_list)
                                        i = 0
                                        print('18前缸號%s' % (_diff_list[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3>1')
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4],
                                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                    _dispatched_flag = ''
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue
                                else:
                                    _dispatched_flag = 'F'
                                break
                        else:
                            continue


                elif len(list2) > 1:
                    j = 0
                    k = 0
                    print('list2: %s' % (list2))
                    for j in range(len(list2)):
                        i = 0
                        print('13前缸號%s' % (list2[j][1]))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(list2[j][1]) == int(_temp_cy_no1):
                                queue_flag = False
                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                    # 0115:這邊要去設定queue flag
                                    queue_size = 0
                                    queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                        print(u'預排入缸容量已滿19')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        # 20190111   避免全滿又進入listx_1的排缸
                                        k = k + 1
                                        break
                                    else:
                                        list2_1_tuple = ()
                                        list2_1_tuple += (list2[j][0],)
                                        list2_1_tuple += (list2[j][1],)
                                        list2_1_tuple += (list2[j][5],)  # 20190108   取最大濃度
                                        list2_1.append(list2_1_tuple)
                                        print('list2_1:%s' % (list2_1))
                                        break
                                else:
                                    print('預排入缸容量已滿20')
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                    k = k + 1
                                    break
                            else:
                                continue
                    print(k)
                    print(j)
                    if k != (j + 1):
                        # 20190109   依照list2_1長度，判斷是否比較最大濃度
                        if len(list2_1) > 1:
                            j = 0
                            _diff_list = []
                            for j in range(len(list2_1)):
                                _temp_tuple = ()

                                _diff_max = 0
                                _each_max = list2_1[j][2]  # 取出最大濃度
                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                _temp_tuple += (_diff_max,)
                                _temp_tuple += (list2_1[j][1],)
                                _temp_tuple += (list2_1[j][0],)

                                _diff_list.append(_temp_tuple)
                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                        else:
                            _diff_list.append(list2_1_tuple)
                        print(_diff_list)
                        i = 0
                        print('14前缸號%s' % (_diff_list[0][1]))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                    _processing_cylinder_list[i].queue.enq(
                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                    # 0111:紀錄工單與濃度list中
                                    _temp_jobno_con_tuple += (_test_no,)
                                    _temp_jobno_con_tuple += (_test_con,)
                                    _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                    _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                    if _test_no != None:
                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                        if temp_tuple4 != None:
                                            if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            else:
                                                tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                            # 20181226   刪除schedule_before資料
                                            cnxn9 = pyodbc.connect(
                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                            cursor9.execute(
                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                    tmp_mac3, tmp_mac4))
                                            cnxn9.commit()

                                            cnxn8 = pyodbc.connect(
                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                            cursor8.execute(
                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                temp_tuple4[4],
                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                            cnxn8.commit()

                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                    print(u"工單號 %s 已排入第%s缸中10" % (
                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                    _dispatched_flag = ''
                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                    if len(_temp_jobno_con_list) >= 8:
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                    break
                                else:
                                    print('list2>1規格不符')
                                    if len(list3) == 1:
                                        i = 0
                                        print('15前缸號%s' % (list3[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[0][1]) == int(_temp_cy_no1):
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿21')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        break
                                                    else:
                                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                                        _temp_yard_length = _processing_cylinder_list[
                                                            i].get_yard_length()
                                                        if (_test_qty <= _temp_weight) and (
                                                                _test_yard <= _temp_yard_length):
                                                            print('太好了list3=1')
                                                            _processing_cylinder_list[i].queue.enq(
                                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                            # 0111:紀錄工單與濃度list中
                                                            _temp_jobno_con_tuple += (_test_no,)
                                                            _temp_jobno_con_tuple += (_test_con,)
                                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                                i].get_cylinder_con_list()
                                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                                _temp_jobno_con_list)

                                                            if _test_no != None:
                                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                                if temp_tuple4 != None:
                                                                    if len(str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())) == 1:
                                                                        tmp_mac3 = 'D0' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D20' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                    else:
                                                                        tmp_mac3 = 'D' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())
                                                                        tmp_mac4 = 'D2' + str(
                                                                            _processing_cylinder_list[
                                                                                i].get_cylinder_no())

                                                                    # 20181226   刪除schedule_before資料
                                                                    cnxn9 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                    cursor9.execute(
                                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                            tmp_mac3, tmp_mac4))
                                                                    cnxn9.commit()

                                                                    cnxn8 = pyodbc.connect(
                                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                                    cursor8.execute(
                                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                        temp_tuple4[3],
                                                                        temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                        temp_tuple4[10], tmp_mac3)
                                                                    cnxn8.commit()

                                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                                _test_no,
                                                                _processing_cylinder_list[i].get_cylinder_no()))
                                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                            if len(_temp_jobno_con_list) >= 8:
                                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            break
                                                        else:
                                                            _dispatched_flag = 'F'
                                                            break
                                                else:
                                                    print('預排入缸容量已滿22')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue


                                    elif len(list3) > 1:
                                        j = 0
                                        k = 0
                                        print('list3: %s' % (list3))
                                        for j in range(len(list3)):
                                            i = 0
                                            print('16前缸號%s' % (list3[j][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(list3[j][1]) == int(_temp_cy_no1):
                                                    queue_flag = False
                                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                        # 0115:這邊要去設定queue flag
                                                        queue_size = 0
                                                        queue_size = len(
                                                            _processing_cylinder_list[i].get_cylinder_con_list())
                                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                            print(u'預排入缸容量已滿23')
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                            _dispatched_flag = 'F'
                                                            k = k + 1
                                                            break
                                                        else:
                                                            list3_1_tuple = ()
                                                            list3_1_tuple += (list3[j][0],)
                                                            list3_1_tuple += (list3[j][1],)
                                                            list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                            list3_1.append(list3_1_tuple)
                                                            print('list3_1:%s' % (list3_1))
                                                            break
                                                    else:
                                                        print('預排入缸容量已滿24')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                else:
                                                    continue
                                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                        if k != (j + 1):
                                            if len(list3_1) > 1:
                                                j = 0
                                                _diff_list = []
                                                for j in range(len(list3_1)):
                                                    _temp_tuple = ()

                                                    _diff_max = 0
                                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                                    _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                    _temp_tuple += (_diff_max,)
                                                    _temp_tuple += (list3_1[j][1],)
                                                    _temp_tuple += (list3_1[j][0],)

                                                    _diff_list.append(_temp_tuple)
                                                    _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                            else:
                                                _diff_list.append(list3_1_tuple)
                                            print(_diff_list)
                                            i = 0
                                            print('18前缸號%s' % (_diff_list[0][1]))
                                            for i in range(0,
                                                           len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3>1')
                                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(_processing_cylinder_list[
                                                                               i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4],
                                                                    temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                    tmp_mac3)
                                                                cnxn8.commit()

                                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                        _dispatched_flag = ''
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                                else:
                                                    continue
                                    else:
                                        _dispatched_flag = 'F'
                                    break
                            else:
                                continue
                    else:  # 20190111   list1全滿，找尋list2，以此類推[必須思考長度=1及>1兩種情況]
                        print('list2_1 null -> list3')
                        if len(list3) == 1:
                            i = 0
                            print('15前缸號%s' % (list3[0][1]))
                            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                if int(list3[0][1]) == int(_temp_cy_no1):
                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                    queue_flag = False
                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                        # 0115:這邊要去設定queue flag
                                        queue_size = 0
                                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                            print(u'預排入缸容量已滿21')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            break
                                        else:
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                print('太好了list3=1')
                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3],
                                                            temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                            temp_tuple4[10],
                                                            tmp_mac3)
                                                        cnxn8.commit()

                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                print(u"工單號 %s 已排入第%s缸中11" % (
                                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                _dispatched_flag = 'F'
                                                break
                                    else:
                                        print('預排入缸容量已滿22')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        _dispatched_flag = 'F'
                                        break
                                else:
                                    continue


                        elif len(list3) > 1:
                            j = 0
                            k = 0
                            print('list3: %s' % (list3))
                            for j in range(len(list3)):
                                i = 0
                                print('16前缸號%s' % (list3[j][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list3[j][1]) == int(_temp_cy_no1):
                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿23')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                k = k + 1
                                                break
                                            else:
                                                list3_1_tuple = ()
                                                list3_1_tuple += (list3[j][0],)
                                                list3_1_tuple += (list3[j][1],)
                                                list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                list3_1.append(list3_1_tuple)
                                                print('list3_1:%s' % (list3_1))
                                                break
                                        else:
                                            print('預排入缸容量已滿24')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            k = k + 1
                                            break
                                    else:
                                        continue
                            # 20190109   依照list3_1長度，判斷是否比較最大濃度
                            if k != (j + 1):
                                if len(list3_1) > 1:
                                    j = 0
                                    _diff_list = []
                                    for j in range(len(list3_1)):
                                        _temp_tuple = ()

                                        _diff_max = 0
                                        _each_max = list3_1[j][2]  # 取出最大濃度
                                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                        _temp_tuple += (_diff_max,)
                                        _temp_tuple += (list3_1[j][1],)
                                        _temp_tuple += (list3_1[j][0],)

                                        _diff_list.append(_temp_tuple)
                                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                else:
                                    _diff_list.append(list3_1_tuple)
                                print(_diff_list)
                                i = 0
                                print('18前缸號%s' % (_diff_list[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                            print('太好了list3>1')
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            _processing_cylinder_list[i].queue.enq(
                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                            # 0111:紀錄工單與濃度list中
                                            _temp_jobno_con_tuple += (_test_no,)
                                            _temp_jobno_con_tuple += (_test_con,)
                                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                            if _test_no != None:
                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                if temp_tuple4 != None:
                                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                        tmp_mac3 = 'D0' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D20' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                    else:
                                                        tmp_mac3 = 'D' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D2' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())

                                                    # 20181226   刪除schedule_before資料
                                                    cnxn9 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                    cursor9.execute(
                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                            tmp_mac3, tmp_mac4))
                                                    cnxn9.commit()

                                                    cnxn8 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                    cursor8.execute(
                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                        temp_tuple4[4],
                                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                    cnxn8.commit()

                                            print(u"工單號 %s 已排入第%s缸中12" % (
                                                _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                            _dispatched_flag = ''
                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                            if len(_temp_jobno_con_list) >= 8:
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                            break
                                        else:
                                            _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue
                        else:
                            _dispatched_flag = 'F'
                else:
                    if len(list3) == 1:
                        i = 0
                        print('15前缸號%s' % (list3[0][1]))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(list3[0][1]) == int(_temp_cy_no1):
                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                queue_flag = False
                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                    # 0115:這邊要去設定queue flag
                                    queue_size = 0
                                    queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                        print(u'預排入缸容量已滿21')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        _dispatched_flag = 'F'
                                        break
                                    else:
                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                            print('太好了list3=1')
                                            _processing_cylinder_list[i].queue.enq(
                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                            # 0111:紀錄工單與濃度list中
                                            _temp_jobno_con_tuple += (_test_no,)
                                            _temp_jobno_con_tuple += (_test_con,)
                                            _temp_jobno_con_list = _processing_cylinder_list[
                                                i].get_cylinder_con_list()
                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                            _processing_cylinder_list[i].set_cylinder_con_list(
                                                _temp_jobno_con_list)

                                            if _test_no != None:
                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                if temp_tuple4 != None:
                                                    if len(str(_processing_cylinder_list[
                                                                   i].get_cylinder_no())) == 1:
                                                        tmp_mac3 = 'D0' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D20' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                    else:
                                                        tmp_mac3 = 'D' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D2' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())

                                                    # 20181226   刪除schedule_before資料
                                                    cnxn9 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                    cursor9.execute(
                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                            tmp_mac3, tmp_mac4))
                                                    cnxn9.commit()

                                                    cnxn8 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                    cursor8.execute(
                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                        temp_tuple4[3],
                                                        temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                        temp_tuple4[10], tmp_mac3)
                                                    cnxn8.commit()

                                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                            print(u"工單號 %s 已排入第%s缸中11" % (
                                                _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                            if len(_temp_jobno_con_list) >= 8:
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                            break
                                        else:
                                            _dispatched_flag = 'F'
                                            break
                                else:
                                    print('預排入缸容量已滿22')
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                    _dispatched_flag = 'F'
                                    break
                            else:
                                continue


                    elif len(list3) > 1:
                        j = 0
                        k = 0
                        print('list3: %s' % (list3))
                        for j in range(len(list3)):
                            i = 0
                            print('16前缸號%s' % (list3[j][1]))
                            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                if int(list3[j][1]) == int(_temp_cy_no1):
                                    queue_flag = False
                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                        # 0115:這邊要去設定queue flag
                                        queue_size = 0
                                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                            print(u'預排入缸容量已滿23')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            k = k + 1
                                            break
                                        else:
                                            list3_1_tuple = ()
                                            list3_1_tuple += (list3[j][0],)
                                            list3_1_tuple += (list3[j][1],)
                                            list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                            list3_1.append(list3_1_tuple)
                                            print('list3_1:%s' % (list3_1))
                                            break
                                    else:
                                        print('預排入缸容量已滿24')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        _dispatched_flag = 'F'
                                        k = k + 1
                                        break
                                else:
                                    continue
                        # 20190109   依照list3_1長度，判斷是否比較最大濃度
                        if k != (j + 1):
                            if len(list3_1) > 1:
                                j = 0
                                _diff_list = []
                                for j in range(len(list3_1)):
                                    _temp_tuple = ()

                                    _diff_max = 0
                                    _each_max = list3_1[j][2]  # 取出最大濃度
                                    _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                    _temp_tuple += (_diff_max,)
                                    _temp_tuple += (list3_1[j][1],)
                                    _temp_tuple += (list3_1[j][0],)

                                    _diff_list.append(_temp_tuple)
                                    _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                    # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                            else:
                                _diff_list.append(list3_1_tuple)
                            print(_diff_list)
                            i = 0
                            print('18前缸號%s' % (_diff_list[0][1]))
                            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                    if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                        print('太好了list3>1')
                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        _processing_cylinder_list[i].queue.enq(
                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                        # 0111:紀錄工單與濃度list中
                                        _temp_jobno_con_tuple += (_test_no,)
                                        _temp_jobno_con_tuple += (_test_con,)
                                        _temp_jobno_con_list = _processing_cylinder_list[
                                            i].get_cylinder_con_list()
                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                        _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                        if _test_no != None:
                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                            if temp_tuple4 != None:
                                                if len(str(
                                                        _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                    tmp_mac3 = 'D0' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                    tmp_mac4 = 'D20' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                else:
                                                    tmp_mac3 = 'D' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                    tmp_mac4 = 'D2' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                # 20181226   刪除schedule_before資料
                                                cnxn9 = pyodbc.connect(
                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                cursor9.execute(
                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                        tmp_mac3, tmp_mac4))
                                                cnxn9.commit()

                                                cnxn8 = pyodbc.connect(
                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                cursor8.execute(
                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                    temp_tuple4[3], temp_tuple4[4],
                                                    temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                cnxn8.commit()

                                        print(u"工單號 %s 已排入第%s缸中12" % (
                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                        # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                        _dispatched_flag = ''
                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                        if len(_temp_jobno_con_list) >= 8:
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                        break
                                    else:
                                        _dispatched_flag = 'F'
                                        break
                                else:
                                    continue
                    else:
                        _dispatched_flag = 'F'


        elif len(list2) == 1:
            i = 0
            print('12前缸號%s' % (list2[0][1]))
            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                if int(list2[0][1]) == int(_temp_cy_no1):
                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                    queue_flag = False
                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                        # 0115:這邊要去設定queue flag
                        queue_size = 0
                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                            print(u'預排入缸容量已滿17')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            print('list2 null -> list3')
                            if len(list3) == 1:
                                i = 0
                                print('15前缸號%s' % (list3[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿21')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                            else:
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3=1')
                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                temp_tuple4[10], tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                        else:
                                            print('預排入缸容量已滿22')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue


                            elif len(list3) > 1:
                                j = 0
                                k = 0
                                print('list3: %s' % (list3))
                                for j in range(len(list3)):
                                    i = 0
                                    print('16前缸號%s' % (list3[j][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿23')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                                else:
                                                    list3_1_tuple = ()
                                                    list3_1_tuple += (list3[j][0],)
                                                    list3_1_tuple += (list3[j][1],)
                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                    list3_1.append(list3_1_tuple)
                                                    print('list3_1:%s' % (list3_1))
                                                    break
                                            else:
                                                print('預排入缸容量已滿24')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                k = k + 1
                                                break
                                        else:
                                            continue
                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                if k != (j + 1):
                                    if len(list3_1) > 1:
                                        j = 0
                                        _diff_list = []
                                        for j in range(len(list3_1)):
                                            _temp_tuple = ()

                                            _diff_max = 0
                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                            _temp_tuple += (_diff_max,)
                                            _temp_tuple += (list3_1[j][1],)
                                            _temp_tuple += (list3_1[j][0],)

                                            _diff_list.append(_temp_tuple)
                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                    else:
                                        _diff_list.append(list3_1_tuple)
                                    print(_diff_list)
                                    i = 0
                                    print('18前缸號%s' % (_diff_list[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                print('太好了list3>1')
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3], temp_tuple4[4],
                                                            temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                _dispatched_flag = ''
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue
                            else:
                                _dispatched_flag = 'F'
                            break
                        else:
                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                            _temp_weight = _processing_cylinder_list[i].get_weight()
                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                # 0111:紀錄工單與濃度list中
                                _temp_jobno_con_tuple += (_test_no,)
                                _temp_jobno_con_tuple += (_test_con,)
                                _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                if _test_no != None:
                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                    if temp_tuple4 != None:
                                        if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                            tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        else:
                                            tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                        # 20181226   刪除schedule_before資料
                                        cnxn9 = pyodbc.connect(
                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                        cursor9.execute("delete from schedule_before where mach_id in ('%s','%s')" % (
                                        tmp_mac3, tmp_mac4))
                                        cnxn9.commit()

                                        cnxn8 = pyodbc.connect(
                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                        cursor8.execute(
                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                            temp_tuple4[4], temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                        cnxn8.commit()

                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                print(u"工單號 %s 已排入第%s缸中9" % (_test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                if len(_temp_jobno_con_list) >= 8:
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                break
                            else:
                                print('list2=1規格不符')
                                if len(list3) == 1:
                                    i = 0
                                    print('15前缸號%s' % (list3[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[0][1]) == int(_temp_cy_no1):
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿21')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    break
                                                else:
                                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                    if (_test_qty <= _temp_weight) and (
                                                            _test_yard <= _temp_yard_length):
                                                        print('太好了list3=1')
                                                        _processing_cylinder_list[i].queue.enq(
                                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                        # 0111:紀錄工單與濃度list中
                                                        _temp_jobno_con_tuple += (_test_no,)
                                                        _temp_jobno_con_tuple += (_test_con,)
                                                        _temp_jobno_con_list = _processing_cylinder_list[
                                                            i].get_cylinder_con_list()
                                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                        _processing_cylinder_list[i].set_cylinder_con_list(
                                                            _temp_jobno_con_list)

                                                        if _test_no != None:
                                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                            if temp_tuple4 != None:
                                                                if len(str(
                                                                        _processing_cylinder_list[
                                                                            i].get_cylinder_no())) == 1:
                                                                    tmp_mac3 = 'D0' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D20' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                else:
                                                                    tmp_mac3 = 'D' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                                    tmp_mac4 = 'D2' + str(
                                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                                # 20181226   刪除schedule_before資料
                                                                cnxn9 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                                cursor9.execute(
                                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                        tmp_mac3, tmp_mac4))
                                                                cnxn9.commit()

                                                                cnxn8 = pyodbc.connect(
                                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                                cursor8.execute(
                                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                    temp_tuple4[3],
                                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                    temp_tuple4[10], tmp_mac3)
                                                                cnxn8.commit()

                                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                        if len(_temp_jobno_con_list) >= 8:
                                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        break
                                                    else:
                                                        _dispatched_flag = 'F'
                                                        break
                                            else:
                                                print('預排入缸容量已滿22')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue


                                elif len(list3) > 1:
                                    j = 0
                                    k = 0
                                    print('list3: %s' % (list3))
                                    for j in range(len(list3)):
                                        i = 0
                                        print('16前缸號%s' % (list3[j][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(list3[j][1]) == int(_temp_cy_no1):
                                                queue_flag = False
                                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                    # 0115:這邊要去設定queue flag
                                                    queue_size = 0
                                                    queue_size = len(
                                                        _processing_cylinder_list[i].get_cylinder_con_list())
                                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                        print(u'預排入缸容量已滿23')
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                        _dispatched_flag = 'F'
                                                        k = k + 1
                                                        break
                                                    else:
                                                        list3_1_tuple = ()
                                                        list3_1_tuple += (list3[j][0],)
                                                        list3_1_tuple += (list3[j][1],)
                                                        list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                        list3_1.append(list3_1_tuple)
                                                        print('list3_1:%s' % (list3_1))
                                                        break
                                                else:
                                                    print('預排入缸容量已滿24')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                            else:
                                                continue
                                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                    if k != (j + 1):
                                        if len(list3_1) > 1:
                                            j = 0
                                            _diff_list = []
                                            for j in range(len(list3_1)):
                                                _temp_tuple = ()

                                                _diff_max = 0
                                                _each_max = list3_1[j][2]  # 取出最大濃度
                                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                                _temp_tuple += (_diff_max,)
                                                _temp_tuple += (list3_1[j][1],)
                                                _temp_tuple += (list3_1[j][0],)

                                                _diff_list.append(_temp_tuple)
                                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                        else:
                                            _diff_list.append(list3_1_tuple)
                                        print(_diff_list)
                                        i = 0
                                        print('18前缸號%s' % (_diff_list[0][1]))
                                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                    print('太好了list3>1')
                                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(_processing_cylinder_list[
                                                                           i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4],
                                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                                tmp_mac3)
                                                            cnxn8.commit()

                                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                    _dispatched_flag = ''
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                            else:
                                                continue
                                else:
                                    _dispatched_flag = 'F'
                                break
                    else:
                        #20190109   思考list3預排缸已滿的後續處理，設定_dispatched_flag為F並進入隨機分配
                        print('預排入缸容量已滿18')
                        _processing_cylinder_list[i].set_queue_full_flag(True)
                        print('list2 null -> list3')
                        if len(list3) == 1:
                            i = 0
                            print('15前缸號%s' % (list3[0][1]))
                            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                if int(list3[0][1]) == int(_temp_cy_no1):
                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                    queue_flag = False
                                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                        # 0115:這邊要去設定queue flag
                                        queue_size = 0
                                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                            print(u'預排入缸容量已滿21')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            break
                                        else:
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                print('太好了list3=1')
                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(
                                                                _processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3],
                                                            temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                            temp_tuple4[10], tmp_mac3)
                                                        cnxn8.commit()

                                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                print(u"工單號 %s 已排入第%s缸中11" % (
                                                _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                _dispatched_flag = 'F'
                                                break
                                    else:
                                        print('預排入缸容量已滿22')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        _dispatched_flag = 'F'
                                        break
                                else:
                                    continue


                        elif len(list3) > 1:
                            j = 0
                            k = 0
                            print('list3: %s' % (list3))
                            for j in range(len(list3)):
                                i = 0
                                print('16前缸號%s' % (list3[j][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list3[j][1]) == int(_temp_cy_no1):
                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿23')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                k = k + 1
                                                break
                                            else:
                                                list3_1_tuple = ()
                                                list3_1_tuple += (list3[j][0],)
                                                list3_1_tuple += (list3[j][1],)
                                                list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                list3_1.append(list3_1_tuple)
                                                print('list3_1:%s' % (list3_1))
                                                break
                                        else:
                                            print('預排入缸容量已滿24')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            k = k + 1
                                            break
                                    else:
                                        continue
                            # 20190109   依照list3_1長度，判斷是否比較最大濃度
                            if k != (j + 1):
                                if len(list3_1) > 1:
                                    j = 0
                                    _diff_list = []
                                    for j in range(len(list3_1)):
                                        _temp_tuple = ()

                                        _diff_max = 0
                                        _each_max = list3_1[j][2]  # 取出最大濃度
                                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                        _temp_tuple += (_diff_max,)
                                        _temp_tuple += (list3_1[j][1],)
                                        _temp_tuple += (list3_1[j][0],)

                                        _diff_list.append(_temp_tuple)
                                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                else:
                                    _diff_list.append(list3_1_tuple)
                                print(_diff_list)
                                i = 0
                                print('18前缸號%s' % (_diff_list[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                        _temp_weight = _processing_cylinder_list[i].get_weight()
                                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                            print('太好了list3>1')
                                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                            _processing_cylinder_list[i].queue.enq(
                                                _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                            # 0111:紀錄工單與濃度list中
                                            _temp_jobno_con_tuple += (_test_no,)
                                            _temp_jobno_con_tuple += (_test_con,)
                                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                            if _test_no != None:
                                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                if temp_tuple4 != None:
                                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                        tmp_mac3 = 'D0' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D20' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                    else:
                                                        tmp_mac3 = 'D' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())
                                                        tmp_mac4 = 'D2' + str(
                                                            _processing_cylinder_list[i].get_cylinder_no())

                                                    # 20181226   刪除schedule_before資料
                                                    cnxn9 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                    cursor9.execute(
                                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                            tmp_mac3, tmp_mac4))
                                                    cnxn9.commit()

                                                    cnxn8 = pyodbc.connect(
                                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                                    cursor8.execute(
                                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                        temp_tuple4[4],
                                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                                    cnxn8.commit()

                                            print(u"工單號 %s 已排入第%s缸中12" % (
                                            _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                            _dispatched_flag = ''
                                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                            if len(_temp_jobno_con_list) >= 8:
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                            break
                                        else:
                                            _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue
                        else:
                            _dispatched_flag = 'F'
                        break
                else:
                    continue


        elif len(list2) > 1:
            j = 0
            k = 0
            print('list2: %s' % (list2))
            for j in range(len(list2)):
                i = 0
                print('13前缸號%s' % (list2[j][1]))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(list2[j][1]) == int(_temp_cy_no1):
                        queue_flag = False
                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                            # 0115:這邊要去設定queue flag
                            queue_size = 0
                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                print(u'預排入缸容量已滿19')
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                #20190111   避免全滿又進入listx_1的排缸
                                k = k + 1
                                break
                            else:
                                list2_1_tuple = ()
                                list2_1_tuple += (list2[j][0],)
                                list2_1_tuple += (list2[j][1],)
                                list2_1_tuple += (list2[j][5],) #20190108   取最大濃度
                                list2_1.append(list2_1_tuple)
                                print('list2_1:%s' % (list2_1))
                                break
                        else:
                            print('預排入缸容量已滿20')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            k = k + 1
                            break
                    else:
                        continue
            print(k)
            print(j)
            if k != (j+1):
                # 20190109   依照list2_1長度，判斷是否比較最大濃度
                if len(list2_1) > 1:
                    j = 0
                    _diff_list = []
                    for j in range(len(list2_1)):
                        _temp_tuple = ()

                        _diff_max = 0
                        _each_max = list2_1[j][2]  # 取出最大濃度
                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                        _temp_tuple += (_diff_max,)
                        _temp_tuple += (list2_1[j][1],)
                        _temp_tuple += (list2_1[j][0],)

                        _diff_list.append(_temp_tuple)
                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                else:
                    _diff_list.append(list2_1_tuple)
                print(_diff_list)
                i = 0
                print('14前缸號%s' % (_diff_list[0][1]))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                        _temp_weight = _processing_cylinder_list[i].get_weight()
                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                            _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                            # 0111:紀錄工單與濃度list中
                            _temp_jobno_con_tuple += (_test_no,)
                            _temp_jobno_con_tuple += (_test_con,)
                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                            if _test_no != None:
                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                if temp_tuple4 != None:
                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                        tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                    else:
                                        tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                    # 20181226   刪除schedule_before資料
                                    cnxn9 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                    cursor9.execute(
                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                        tmp_mac3, tmp_mac4))
                                    cnxn9.commit()

                                    cnxn8 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                    cursor8.execute(
                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3], temp_tuple4[4],
                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                    cnxn8.commit()

                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                            print(u"工單號 %s 已排入第%s缸中10" % (_test_no, _processing_cylinder_list[i].get_cylinder_no()))
                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                            _dispatched_flag = ''
                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                            if len(_temp_jobno_con_list) >= 8:
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                            break
                        else:
                            print('list2>1規格不符')
                            if len(list3) == 1:
                                i = 0
                                print('15前缸號%s' % (list3[0][1]))
                                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                    if int(list3[0][1]) == int(_temp_cy_no1):
                                        _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                        _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                        queue_flag = False
                                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                            # 0115:這邊要去設定queue flag
                                            queue_size = 0
                                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                print(u'預排入缸容量已滿21')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                break
                                            else:
                                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                                if (_test_qty <= _temp_weight) and (
                                                        _test_yard <= _temp_yard_length):
                                                    print('太好了list3=1')
                                                    _processing_cylinder_list[i].queue.enq(
                                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                    # 0111:紀錄工單與濃度list中
                                                    _temp_jobno_con_tuple += (_test_no,)
                                                    _temp_jobno_con_tuple += (_test_con,)
                                                    _temp_jobno_con_list = _processing_cylinder_list[
                                                        i].get_cylinder_con_list()
                                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                    _processing_cylinder_list[i].set_cylinder_con_list(
                                                        _temp_jobno_con_list)

                                                    if _test_no != None:
                                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                        if temp_tuple4 != None:
                                                            if len(str(
                                                                    _processing_cylinder_list[
                                                                        i].get_cylinder_no())) == 1:
                                                                tmp_mac3 = 'D0' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D20' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                            else:
                                                                tmp_mac3 = 'D' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())
                                                                tmp_mac4 = 'D2' + str(
                                                                    _processing_cylinder_list[i].get_cylinder_no())

                                                            # 20181226   刪除schedule_before資料
                                                            cnxn9 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                            cursor9.execute(
                                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                    tmp_mac3, tmp_mac4))
                                                            cnxn9.commit()

                                                            cnxn8 = pyodbc.connect(
                                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                                            cursor8.execute(
                                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                                temp_tuple4[3],
                                                                temp_tuple4[4], temp_tuple4[8], temp_tuple4[9],
                                                                temp_tuple4[10], tmp_mac3)
                                                            cnxn8.commit()

                                                    # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                                    print(u"工單號 %s 已排入第%s缸中11" % (
                                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                    if len(_temp_jobno_con_list) >= 8:
                                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    break
                                                else:
                                                    _dispatched_flag = 'F'
                                                    break
                                        else:
                                            print('預排入缸容量已滿22')
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                            _dispatched_flag = 'F'
                                            break
                                    else:
                                        continue


                            elif len(list3) > 1:
                                j = 0
                                k = 0
                                print('list3: %s' % (list3))
                                for j in range(len(list3)):
                                    i = 0
                                    print('16前缸號%s' % (list3[j][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(list3[j][1]) == int(_temp_cy_no1):
                                            queue_flag = False
                                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                                # 0115:這邊要去設定queue flag
                                                queue_size = 0
                                                queue_size = len(
                                                    _processing_cylinder_list[i].get_cylinder_con_list())
                                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                                    print(u'預排入缸容量已滿23')
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                    _dispatched_flag = 'F'
                                                    k = k + 1
                                                    break
                                                else:
                                                    list3_1_tuple = ()
                                                    list3_1_tuple += (list3[j][0],)
                                                    list3_1_tuple += (list3[j][1],)
                                                    list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                                    list3_1.append(list3_1_tuple)
                                                    print('list3_1:%s' % (list3_1))
                                                    break
                                            else:
                                                print('預排入缸容量已滿24')
                                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                                _dispatched_flag = 'F'
                                                k = k + 1
                                                break
                                        else:
                                            continue
                                # 20190109   依照list3_1長度，判斷是否比較最大濃度
                                if k != (j + 1):
                                    if len(list3_1) > 1:
                                        j = 0
                                        _diff_list = []
                                        for j in range(len(list3_1)):
                                            _temp_tuple = ()

                                            _diff_max = 0
                                            _each_max = list3_1[j][2]  # 取出最大濃度
                                            _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                            _temp_tuple += (_diff_max,)
                                            _temp_tuple += (list3_1[j][1],)
                                            _temp_tuple += (list3_1[j][0],)

                                            _diff_list.append(_temp_tuple)
                                            _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                                    else:
                                        _diff_list.append(list3_1_tuple)
                                    print(_diff_list)
                                    i = 0
                                    print('18前缸號%s' % (_diff_list[0][1]))
                                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                                        if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                            _temp_weight = _processing_cylinder_list[i].get_weight()
                                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                                print('太好了list3>1')
                                                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                                _processing_cylinder_list[i].queue.enq(
                                                    _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                                # 0111:紀錄工單與濃度list中
                                                _temp_jobno_con_tuple += (_test_no,)
                                                _temp_jobno_con_tuple += (_test_con,)
                                                _temp_jobno_con_list = _processing_cylinder_list[
                                                    i].get_cylinder_con_list()
                                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                                _processing_cylinder_list[i].set_cylinder_con_list(
                                                    _temp_jobno_con_list)

                                                if _test_no != None:
                                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                                    if temp_tuple4 != None:
                                                        if len(str(_processing_cylinder_list[
                                                                       i].get_cylinder_no())) == 1:
                                                            tmp_mac3 = 'D0' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D20' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                        else:
                                                            tmp_mac3 = 'D' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())
                                                            tmp_mac4 = 'D2' + str(
                                                                _processing_cylinder_list[i].get_cylinder_no())

                                                        # 20181226   刪除schedule_before資料
                                                        cnxn9 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                        cursor9.execute(
                                                            "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                                tmp_mac3, tmp_mac4))
                                                        cnxn9.commit()

                                                        cnxn8 = pyodbc.connect(
                                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                                        cursor8.execute(
                                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2],
                                                            temp_tuple4[3],
                                                            temp_tuple4[4],
                                                            temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                            tmp_mac3)
                                                        cnxn8.commit()

                                                print(u"工單號 %s 已排入第%s缸中12" % (
                                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                                # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                                _dispatched_flag = ''
                                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                                if len(_temp_jobno_con_list) >= 8:
                                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                                break
                                            else:
                                                _dispatched_flag = 'F'
                                                break
                                        else:
                                            continue
                            else:
                                _dispatched_flag = 'F'
                            break
                    else:
                        continue
            else:   #20190111   list1全滿，找尋list2，以此類推[必須思考長度=1及>1兩種情況]
                print('list2_1 null -> list3')
                if len(list3) == 1:
                    i = 0
                    print('15前缸號%s' % (list3[0][1]))
                    for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                        _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                        if int(list3[0][1]) == int(_temp_cy_no1):
                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                            queue_flag = False
                            queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                            if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                # 0115:這邊要去設定queue flag
                                queue_size = 0
                                queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                    print(u'預排入缸容量已滿21')
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                    _dispatched_flag = 'F'
                                    break
                                else:
                                    # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                    _temp_weight = _processing_cylinder_list[i].get_weight()
                                    _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                    if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                        print('太好了list3=1')
                                        _processing_cylinder_list[i].queue.enq(
                                            _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                        # 0111:紀錄工單與濃度list中
                                        _temp_jobno_con_tuple += (_test_no,)
                                        _temp_jobno_con_tuple += (_test_con,)
                                        _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                        _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                        if _test_no != None:
                                            temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                    _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                            if temp_tuple4 != None:
                                                if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                    tmp_mac3 = 'D0' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                    tmp_mac4 = 'D20' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())
                                                else:
                                                    tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                    tmp_mac4 = 'D2' + str(
                                                        _processing_cylinder_list[i].get_cylinder_no())

                                                # 20181226   刪除schedule_before資料
                                                cnxn9 = pyodbc.connect(
                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                                cursor9.execute(
                                                    "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                        tmp_mac3, tmp_mac4))
                                                cnxn9.commit()

                                                cnxn8 = pyodbc.connect(
                                                    'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                                cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                                # 20181226  排完缸後，將結果回寫到schedule_before
                                                cursor8.execute(
                                                    "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                    temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                    temp_tuple4[4], temp_tuple4[8], temp_tuple4[9], temp_tuple4[10],
                                                    tmp_mac3)
                                                cnxn8.commit()

                                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                        print(u"工單號 %s 已排入第%s缸中11" % (
                                        _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                        if len(_temp_jobno_con_list) >= 8:
                                            _processing_cylinder_list[i].set_queue_full_flag(True)
                                        break
                                    else:
                                        _dispatched_flag = 'F'
                                        break
                            else:
                                print('預排入缸容量已滿22')
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                _dispatched_flag = 'F'
                                break
                        else:
                            continue


                elif len(list3) > 1:
                    j = 0
                    k = 0
                    print('list3: %s' % (list3))
                    for j in range(len(list3)):
                        i = 0
                        print('16前缸號%s' % (list3[j][1]))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(list3[j][1]) == int(_temp_cy_no1):
                                queue_flag = False
                                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                                    # 0115:這邊要去設定queue flag
                                    queue_size = 0
                                    queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                                    if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                        print(u'預排入缸容量已滿23')
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                        _dispatched_flag = 'F'
                                        k = k + 1
                                        break
                                    else:
                                        list3_1_tuple = ()
                                        list3_1_tuple += (list3[j][0],)
                                        list3_1_tuple += (list3[j][1],)
                                        list3_1_tuple += (list3[j][5],)  # 20190108   取最大濃度
                                        list3_1.append(list3_1_tuple)
                                        print('list3_1:%s' % (list3_1))
                                        break
                                else:
                                    print('預排入缸容量已滿24')
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                    _dispatched_flag = 'F'
                                    k = k + 1
                                    break
                            else:
                                continue
                    # 20190109   依照list3_1長度，判斷是否比較最大濃度
                    if k != (j + 1):
                        if len(list3_1) > 1:
                            j = 0
                            _diff_list = []
                            for j in range(len(list3_1)):
                                _temp_tuple = ()

                                _diff_max = 0
                                _each_max = list3_1[j][2]  # 取出最大濃度
                                _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                                _temp_tuple += (_diff_max,)
                                _temp_tuple += (list3_1[j][1],)
                                _temp_tuple += (list3_1[j][0],)

                                _diff_list.append(_temp_tuple)
                                _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                                # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                        else:
                            _diff_list.append(list3_1_tuple)
                        print(_diff_list)
                        i = 0
                        print('18前缸號%s' % (_diff_list[0][1]))
                        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                            _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                            if int(_diff_list[0][1]) == int(_temp_cy_no1):
                                # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                                _temp_weight = _processing_cylinder_list[i].get_weight()
                                _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                                if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                    print('太好了list3>1')
                                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                                    _processing_cylinder_list[i].queue.enq(
                                        _test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                    # 0111:紀錄工單與濃度list中
                                    _temp_jobno_con_tuple += (_test_no,)
                                    _temp_jobno_con_tuple += (_test_con,)
                                    _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                    _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                    _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                    if _test_no != None:
                                        temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                                _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                        if temp_tuple4 != None:
                                            if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                                tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            else:
                                                tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                                tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                            # 20181226   刪除schedule_before資料
                                            cnxn9 = pyodbc.connect(
                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                            cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                            cursor9.execute(
                                                "delete from schedule_before where mach_id in ('%s','%s')" % (
                                                    tmp_mac3, tmp_mac4))
                                            cnxn9.commit()

                                            cnxn8 = pyodbc.connect(
                                                'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                            cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                            # 20181226  排完缸後，將結果回寫到schedule_before
                                            cursor8.execute(
                                                "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                                temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                                temp_tuple4[4],
                                                temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                            cnxn8.commit()

                                    print(u"工單號 %s 已排入第%s缸中12" % (
                                    _test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                    # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                                    _dispatched_flag = ''
                                    # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                    if len(_temp_jobno_con_list) >= 8:
                                        _processing_cylinder_list[i].set_queue_full_flag(True)
                                    break
                                else:
                                    _dispatched_flag = 'F'
                                    break
                            else:
                                continue
                else:
                    _dispatched_flag = 'F'


        elif len(list3) == 1:
            i = 0
            print('15前缸號%s' % (list3[0][1]))
            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                if int(list3[0][1]) == int(_temp_cy_no1):
                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                    queue_flag = False
                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                        # 0115:這邊要去設定queue flag
                        queue_size = 0
                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                        if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                            print(u'預排入缸容量已滿21')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            _dispatched_flag = 'F'
                            break
                        else:
                            # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                            _temp_weight = _processing_cylinder_list[i].get_weight()
                            _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                            if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                                print('太好了list3=1')
                                _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                                # 0111:紀錄工單與濃度list中
                                _temp_jobno_con_tuple += (_test_no,)
                                _temp_jobno_con_tuple += (_test_con,)
                                _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                                _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                                _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                                if _test_no != None:
                                    temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                            _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                    if temp_tuple4 != None:
                                        if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                            tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        else:
                                            tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                            tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                        # 20181226   刪除schedule_before資料
                                        cnxn9 = pyodbc.connect(
                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                        cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                        cursor9.execute("delete from schedule_before where mach_id in ('%s','%s')" % (
                                        tmp_mac3, tmp_mac4))
                                        cnxn9.commit()

                                        cnxn8 = pyodbc.connect(
                                            'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                        cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                        # 20181226  排完缸後，將結果回寫到schedule_before
                                        cursor8.execute(
                                            "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                            temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3],
                                            temp_tuple4[4], temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                        cnxn8.commit()

                                # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                                print(u"工單號 %s 已排入第%s缸中11" % (_test_no, _processing_cylinder_list[i].get_cylinder_no()))
                                # 20180621 大於等於8張工單，set_queue_full_flag(True)
                                if len(_temp_jobno_con_list) >= 8:
                                    _processing_cylinder_list[i].set_queue_full_flag(True)
                                break
                            else:
                                _dispatched_flag = 'F'
                                break
                    else:
                        print('預排入缸容量已滿22')
                        _processing_cylinder_list[i].set_queue_full_flag(True)
                        _dispatched_flag = 'F'
                        break
                else:
                    continue


        elif len(list3) > 1:
            j = 0
            k = 0
            print('list3: %s' % (list3))
            for j in range(len(list3)):
                i = 0
                print('16前缸號%s' % (list3[j][1]))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(list3[j][1]) == int(_temp_cy_no1):
                        queue_flag = False
                        queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                        if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                            # 0115:這邊要去設定queue flag
                            queue_size = 0
                            queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                            if queue_size >= 8:  # 20190104 全滿continue，未滿排入break
                                print(u'預排入缸容量已滿23')
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                                _dispatched_flag = 'F'
                                k = k + 1
                                break
                            else:
                                list3_1_tuple = ()
                                list3_1_tuple += (list3[j][0],)
                                list3_1_tuple += (list3[j][1],)
                                list3_1_tuple += (list3[j][5],) #20190108   取最大濃度
                                list3_1.append(list3_1_tuple)
                                print('list3_1:%s' % (list3_1))
                                break
                        else:
                            print('預排入缸容量已滿24')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            _dispatched_flag = 'F'
                            k = k + 1
                            break
                    else:
                        continue
            # 20190109   依照list3_1長度，判斷是否比較最大濃度
            if k != (j+1):
                if len(list3_1) > 1:
                    j = 0
                    _diff_list = []
                    for j in range(len(list3_1)):
                        _temp_tuple = ()

                        _diff_max = 0
                        _each_max = list3_1[j][2]  # 取出最大濃度
                        _diff_max = abs(_each_max - _temp_max_con)  # 計算每一個最大濃度差距

                        _temp_tuple += (_diff_max,)
                        _temp_tuple += (list3_1[j][1],)
                        _temp_tuple += (list3_1[j][0],)

                        _diff_list.append(_temp_tuple)
                        #20190116   itemgetter(1)->(0) 改依濃度差距排序
                        _diff_list = sorted(_diff_list, key=operator.itemgetter(0))
                        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。
                else:
                    _diff_list.append(list3_1_tuple)
                print(_diff_list)
                i = 0
                print('18前缸號%s' % (_diff_list[0][1]))
                for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                    _temp_cy_no1 = _processing_cylinder_list[i].get_cylinder_no()
                    if int(_diff_list[0][1]) == int(_temp_cy_no1):
                        # 20190113   排缸前須確認缸與工單規格相符，查詢各中X的工單及染缸規格(投胚量 碼長)
                        _temp_weight = _processing_cylinder_list[i].get_weight()
                        _temp_yard_length = _processing_cylinder_list[i].get_yard_length()
                        if (_test_qty <= _temp_weight) and (_test_yard <= _temp_yard_length):
                            print('太好了list3>1')
                            _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                            _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                            _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                            # 0111:紀錄工單與濃度list中
                            _temp_jobno_con_tuple += (_test_no,)
                            _temp_jobno_con_tuple += (_test_con,)
                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                            if _test_no != None:
                                temp_tuple4 = search_tuple_from_joblist(_test_no,
                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                if temp_tuple4 != None:
                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                        tmp_mac3 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac4 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                    else:
                                        tmp_mac3 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac4 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                    # 20181226   刪除schedule_before資料
                                    cnxn9 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor9 = cnxn9.cursor()  # server 位置: 172.16.41.23
                                    cursor9.execute(
                                        "delete from schedule_before where mach_id in ('%s','%s')" % (
                                        tmp_mac3, tmp_mac4))
                                    cnxn9.commit()

                                    cnxn8 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor8 = cnxn8.cursor()  # server 位置: 172.16.41.23
                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                    cursor8.execute(
                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                        temp_tuple4[0], temp_tuple4[1], temp_tuple4[2], temp_tuple4[3], temp_tuple4[4],
                                        temp_tuple4[8], temp_tuple4[9], temp_tuple4[10], tmp_mac3)
                                    cnxn8.commit()

                            print(u"工單號 %s 已排入第%s缸中12" % (_test_no, _processing_cylinder_list[i].get_cylinder_no()))
                            # 20190111   已排入缸， _dispatched_flag設成空值，避免進入隨機分配2
                            _dispatched_flag = ''
                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                            if len(_temp_jobno_con_list) >= 8:
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                            break
                        else:
                            _dispatched_flag = 'F'
                            break
                    else:
                        continue
#====================================================================================================
        else:
            print('進入隨機分配1')
            cy_category_list_size = len(cy_category_list)  # 20181220   cy_category_list_size染缸種類   7
            j = 0
            category_index = 0
            _diff_list = []
            for j in range(cy_category_list_size):
                _temp_tuple = ()

                _diff_yard = 0
                _diff_qty = 0
                _cate_cy_no = 0

                _each_cy_qty = cy_category_list[j][0]  # 取出qty投胚量
                _each_cy_yard = cy_category_list[j][1]  # 取出碼長

                _diff_qty = _each_cy_qty - _test_qty  # 計算每一個投胚量差距
                _diff_yard = _each_cy_yard - _test_yard  # 計算每一個碼長差距
                _cate_cy_no = category_index  # 分類編號

                _temp_tuple += (_diff_qty,)
                _temp_tuple += (_diff_yard,)
                _temp_tuple += (_cate_cy_no,)

                _diff_list.append(_temp_tuple)
                # _original_list.append(_temp_tuple)
                category_index += 1
            # 先過濾有負號(小於0)的元素[0]，再過濾有負號(小於0)的元素[1]
            _diff_list_minus_0_list = [i for i in _diff_list if i[0] >= 0]

            _diff_list_minus_1_list = [i for i in _diff_list_minus_0_list if i[1] >= 0]
            _diff_list_minus_1_list = sorted(_diff_list_minus_1_list, key=operator.itemgetter(1, 2))
            # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。

            _result_class = 0
            i = 0
            j = 0

            print(_diff_list_minus_1_list)  # 20181225   顯示符合規格的染缸類別
            # 20181225   取出預排入染缸類別_result_class
            for j in range(0, len(_diff_list_minus_1_list)):
                _testing_qty = _diff_list_minus_1_list[j][0]
                if _testing_qty >= 0:
                    if len(_diff_list_minus_1_list) == 1:
                        _result_class = _diff_list_minus_1_list[j][2]
                    elif j + 1 < len(_diff_list_minus_1_list):
                        if _testing_qty <= _diff_list_minus_1_list[j + 1][0]:
                            _result_class = _diff_list_minus_1_list[j][2]  # 1
                            break
                else:
                    continue
                    # =================================================

            # ==================2. 找出分類中的第幾號缸，排入缸中
            _dispatched_group = ()
            _dispatched_group = cy_group_list[_result_class]  # (14,32)
            _dispatched_ptr = cy_ptr_list[_result_class]  # 0

            # print(_dispatched_ptr)
            # print(len(_dispatched_group))

            # 20181225   避免_dispatched_ptr超過染缸群組大小出錯
            if _dispatched_ptr < len(_dispatched_group):
                _dispatched_cylinder = _dispatched_group[_dispatched_ptr]
            else:
                _dispatched_ptr = _dispatched_ptr % len(cy_group_list[_result_class])
                _dispatched_cylinder = _dispatched_group[_dispatched_ptr]

            print('選擇到的缸分類為第%s類第%s缸5' % (_result_class, _dispatched_cylinder))
            # 0112:這邊去更新ptr指標
            _dispatched_ptr += 1
            cy_ptr_list[_result_class] = _dispatched_ptr  # 寫回PTR目前缸指標記錄

            i = 0
            k = 0
            for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
                _temp_cy_no = _processing_cylinder_list[i].get_cylinder_no()
                if _dispatched_cylinder == _temp_cy_no:

                    _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                    _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                    queue_flag = False
                    queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                    if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                        # 0115:這邊要去設定queue flag
                        queue_size = 0
                        queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                        if queue_size >= 8:  # 20180621 如果大於8張工單，則進行過載平衡
                            print(u'預排入缸容量已滿7')
                            print('=========過載平衡啟動=====================')
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                            print('No. %s class %s work_id doing load balancing' % (_result_class, _test_no))
                            load_balance(_test_con, _dispatched_cylinder, _result_class, _test_no,
                                         _processing_cylinder_list, cy_group_list, cy_ptr_list)
                            print(u'=========過載平衡執行完畢==================')
                            break
                        else:  # 排入缸中的queue與list，通常list會放入tuple(工單號，濃度)，此樣想法為之後，移動工單或是排序工單可以使用，而非放入queue中(因queue中只會放入工單號，並不會放入濃度，因此為了後續的排缸與濃度排序使用，我新增了set_cylinder_con_list與get_cylinder_con_lis來放入tuple(工單號，濃度)，方便後續寫程式的快速性。而非用啥理論的queue，queue資料結構是好用，但是要搭配實際情況。
                            # 你也可以把工單整個物件放進來queue中，這樣方式也可以，但是我覺得光是要比較濃度後去移動物件，可能也要花不少時間，看你之後的需求為何
                            _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                            # 0111:紀錄工單與濃度list中
                            _temp_jobno_con_tuple += (_test_no,)
                            _temp_jobno_con_tuple += (_test_con,)
                            _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                            _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                            _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                            if _test_no != None:
                                temp_tuple5 = search_tuple_from_joblist(_test_no,
                                                                        _to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                                if temp_tuple5 != None:
                                    if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                        tmp_mac5 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac6 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                    else:
                                        tmp_mac5 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                        tmp_mac6 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                    # 20181226   刪除schedule_before資料
                                    cnxn11 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor11 = cnxn11.cursor()  # server 位置: 172.16.41.23
                                    cursor11.execute("delete from schedule_before where mach_id in ('%s','%s')" % (
                                    tmp_mac5, tmp_mac6))
                                    cnxn11.commit()

                                    cnxn12 = pyodbc.connect(
                                        'DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                    cursor12 = cnxn12.cursor()  # server 位置: 172.16.41.23
                                    # 20181226  排完缸後，將結果回寫到schedule_before
                                    cursor12.execute(
                                        "insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",
                                        temp_tuple5[0], temp_tuple5[1], temp_tuple5[2], temp_tuple5[3], temp_tuple5[4],
                                        temp_tuple5[8], temp_tuple5[9], temp_tuple5[10], tmp_mac5)
                                    cnxn12.commit()

                            # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                            print(u"工單號 %s 已排入第%s分類 第%s缸中4" % (
                            _test_no, _result_class, _processing_cylinder_list[i].get_cylinder_no()))
                            # 20180621 大於等於8張工單，set_queue_full_flag(True)
                            if len(_temp_jobno_con_list) >= 8:
                                _processing_cylinder_list[i].set_queue_full_flag(True)
                            break
                    else:  # 要排的缸已經滿了，則是啟動過載平衡機制，去找下一層缸排入
                        print('預排入缸容量已滿8')
                        print('==========過載平衡啟動==============')
                        _processing_cylinder_list[i].set_queue_full_flag(True)
                        print('第%s分類 %s 工單號 執行load負載平衡' % (_result_class, _test_no))
                        load_balance(_test_con, _dispatched_cylinder, _result_class, _test_no,
                                     _processing_cylinder_list, cy_group_list, cy_ptr_list)
                        print('==========過載平衡執行完畢===========')
                        break
                else:
                    continue
#==================================================================================================
    if _dispatched_flag == 'F':
        print('進入隨機分配2')
        cy_category_list_size = len(cy_category_list)  # 20181220   cy_category_list_size染缸種類   7
        j = 0
        category_index = 0
        _diff_list = []
        for j in range(cy_category_list_size):
            _temp_tuple = ()

            _diff_yard = 0
            _diff_qty = 0
            _cate_cy_no = 0

            _each_cy_qty = cy_category_list[j][0]  # 取出qty投胚量
            _each_cy_yard = cy_category_list[j][1]  # 取出碼長

            _diff_qty = _each_cy_qty - _test_qty  # 計算每一個投胚量差距
            _diff_yard = _each_cy_yard - _test_yard  # 計算每一個碼長差距
            _cate_cy_no = category_index  # 分類編號

            _temp_tuple += (_diff_qty,)
            _temp_tuple += (_diff_yard,)
            _temp_tuple += (_cate_cy_no,)

            _diff_list.append(_temp_tuple)
            category_index += 1
        # 先過濾有負號(小於0)的元素[0]，再過濾有負號(小於0)的元素[1]
        print(_diff_list)
        _diff_list_minus_0_list = [i for i in _diff_list if i[0] >= 0]

        _diff_list_minus_1_list = [i for i in _diff_list_minus_0_list if i[1] >= 0]
        _diff_list_minus_1_list = sorted(_diff_list_minus_1_list, key=operator.itemgetter(1, 2))
        # 0131: 經過上面的過濾，可過濾出最相近的缸號是哪一缸，便可依照此缸號排入缸號list中。

        _result_class = 0
        i = 0
        j = 0

        print(_diff_list_minus_1_list)  # 20181225   顯示符合規格的染缸類別
        # 20181225   取出預排入染缸類別_result_class
        for j in range(0, len(_diff_list_minus_1_list)):
            _testing_qty = _diff_list_minus_1_list[j][0]
            if _testing_qty >= 0:
                if len(_diff_list_minus_1_list) == 1:
                    _result_class = _diff_list_minus_1_list[j][2]
                elif j + 1 < len(_diff_list_minus_1_list):
                    if _testing_qty <= _diff_list_minus_1_list[j + 1][0]:
                        _result_class = _diff_list_minus_1_list[j][2]  # 1
                        break
            else:
                continue
                # =================================================

        # ==================2. 找出分類中的第幾號缸，排入缸中
        _dispatched_group = ()
        _dispatched_group = cy_group_list[_result_class]  # (14,32)
        _dispatched_ptr = cy_ptr_list[_result_class]  # 0

        # 20181225   避免_dispatched_ptr超過染缸群組大小出錯
        if _dispatched_ptr < len(_dispatched_group):
            _dispatched_cylinder = _dispatched_group[_dispatched_ptr]
        else:
            _dispatched_ptr = _dispatched_ptr % len(cy_group_list[_result_class])
            _dispatched_cylinder = _dispatched_group[_dispatched_ptr]

        print('選擇到的缸分類為第%s類第%s缸6' % (_result_class, _dispatched_cylinder))
        # 0112:這邊去更新ptr指標
        _dispatched_ptr += 1
        cy_ptr_list[_result_class] = _dispatched_ptr  # 寫回PTR目前缸指標記錄

        i = 0
        k = 0
        for i in range(0, len(_processing_cylinder_list)):  # 20181226   從缸號1~100，共27個
            _temp_cy_no = _processing_cylinder_list[i].get_cylinder_no()
            if _dispatched_cylinder == _temp_cy_no:

                _temp_jobno_con_tuple = ()  # 0111:新增工單與濃度tuple，無法修改
                _temp_jobno_con_list = []  # 0111:新增工單與濃度tuple_list，可修改

                queue_flag = False
                queue_flag = _processing_cylinder_list[i].get_queue_full_flag()

                if not queue_flag:  # 0115:如果queue不滿(小於8張工單)
                    # 0115:這邊要去設定queue flag
                    queue_size = 0
                    queue_size = len(_processing_cylinder_list[i].get_cylinder_con_list())
                    if queue_size >= 8:  # 20180621 如果大於8張工單，則進行過載平衡
                        print(u'預排入缸容量已滿9')
                        print('=========過載平衡啟動=====================')
                        _processing_cylinder_list[i].set_queue_full_flag(True)
                        print('No. %s class %s work_id doing load balancing' % (_result_class, _test_no))
                        load_balance(_test_con, _dispatched_cylinder, _result_class, _test_no,_processing_cylinder_list, cy_group_list, cy_ptr_list)
                        print(u'=========過載平衡執行完畢==================')
                        break
                    else:  # 排入缸中的queue與list，通常list會放入tuple(工單號，濃度)，此樣想法為之後，移動工單或是排序工單可以使用，而非放入queue中(因queue中只會放入工單號，並不會放入濃度，因此為了後續的排缸與濃度排序使用，我新增了set_cylinder_con_list與get_cylinder_con_lis來放入tuple(工單號，濃度)，方便後續寫程式的快速性。而非用啥理論的queue，queue資料結構是好用，但是要搭配實際情況。
                        # 你也可以把工單整個物件放進來queue中，這樣方式也可以，但是我覺得光是要比較濃度後去移動物件，可能也要花不少時間，看你之後的需求為何
                        _processing_cylinder_list[i].queue.enq(_test_no)  # 20181225   insert(0,item)在第一格插入工單號
                        # 0111:紀錄工單與濃度list中
                        _temp_jobno_con_tuple += (_test_no,)
                        _temp_jobno_con_tuple += (_test_con,)
                        _temp_jobno_con_list = _processing_cylinder_list[i].get_cylinder_con_list()
                        _temp_jobno_con_list.append(_temp_jobno_con_tuple)
                        _processing_cylinder_list[i].set_cylinder_con_list(_temp_jobno_con_list)

                        if _test_no != None:
                            temp_tuple5 = search_tuple_from_joblist(_test_no,_to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                            if temp_tuple5 != None:
                                if len(str(_processing_cylinder_list[i].get_cylinder_no())) == 1:
                                    tmp_mac5 = 'D0' + str(_processing_cylinder_list[i].get_cylinder_no())
                                    tmp_mac6 = 'D20' + str(_processing_cylinder_list[i].get_cylinder_no())
                                else:
                                    tmp_mac5 = 'D' + str(_processing_cylinder_list[i].get_cylinder_no())
                                    tmp_mac6 = 'D2' + str(_processing_cylinder_list[i].get_cylinder_no())

                                # 20181226   刪除schedule_before資料
                                cnxn11 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                cursor11 = cnxn11.cursor()  # server 位置: 172.16.41.23
                                cursor11.execute("delete from schedule_before where mach_id in ('%s','%s')" % (tmp_mac5, tmp_mac6))
                                cnxn11.commit()

                                cnxn12 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                                cursor12 = cnxn12.cursor()  # server 位置: 172.16.41.23
                                # 20181226  排完缸後，將結果回寫到schedule_before
                                cursor12.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",temp_tuple5[0], temp_tuple5[1], temp_tuple5[2], temp_tuple5[3], temp_tuple5[4],temp_tuple5[8], temp_tuple5[9], temp_tuple5[10], tmp_mac5)
                                cnxn12.commit()

                        # 0116:設定到每缸的list中，方便後續濃度排序與調整使用
                        print(u"工單號 %s 已排入第%s分類 第%s缸中5" % (_test_no, _result_class, _processing_cylinder_list[i].get_cylinder_no()))
                        # 20180621 大於等於8張工單，set_queue_full_flag(True)
                        if len(_temp_jobno_con_list) >= 8:
                            _processing_cylinder_list[i].set_queue_full_flag(True)
                        break
                else:  # 要排的缸已經滿了，則是啟動過載平衡機制，去找下一層缸排入
                    print('預排入缸容量已滿10')
                    print('==========過載平衡啟動==============')
                    _processing_cylinder_list[i].set_queue_full_flag(True)
                    print('第%s分類 %s 工單號 執行load負載平衡' % (_result_class, _test_no))
                    load_balance(_test_con, _dispatched_cylinder, _result_class, _test_no,_processing_cylinder_list, cy_group_list, cy_ptr_list)
                    print('==========過載平衡執行完畢===========')
                    break
            else:
                continue
            #os.system("pause")
        #return 'XXX'
    print('list1:%s' % (list1))
    print('list2:%s' % (list2))
    print('list3:%s' % (list3))
    print('list4:%s' % (list4))
    print('list5:%s' % (list5))
#====0115: 負載平衡相關的工單: 輸入(被找尋總濃度，欲排入缸號，欲排入缸類別，被找尋工單號, 處理總缸list，染缸分組表，各組染缸指標)，輸出(已經排入的缸號或是回收區)=======
def load_balance(_rec_test_con, _rec_target_cylinder,_rec_class, _rec_no, _rec_cy_list, _rec_group_list, _rec_ptr_list):
    #0115:去找出同類的class中的其他queue，看是否能排入不行的話，就直接往上一階去排
    same_group_len=0
    same_group_len=len(_rec_group_list[_rec_class])#計算出同一類的class中的數量
    global _target_cylinder_group
    _target_cylinder_group=()
    _target_cylinder_group=_rec_group_list[_rec_class]#取出同一類的tuple
    _target_cylinder_group_list=[]
    _target_cylinder_group_list=list(_target_cylinder_group)#換成list後，取出對應的tuple元素
    
    index=0
    global counter#紀錄每一次的分類找尋數目
    counter=0
    #20180425   新增put_flag1，排入同類其他缸號中就不再放入暫時區
    put_flag1=0
    for index in range(same_group_len):
        _temp_same_class_cy_no=''
        _temp_same_class_cy_no=_target_cylinder_group_list[index]
        if _temp_same_class_cy_no==_rec_target_cylinder:#同為一個，則是跳過
            counter+=1
            continue
        else:
            #不同的話，則是去看同類的缸是否queue已滿: (處理總缸list，排缸號)
            if check_queue_is_fulled_or_not(_rec_cy_list,_temp_same_class_cy_no):
                counter+=1
                if counter>=same_group_len:#全滿則是跳出，改找同類下一缸
                    break
            else:#沒有的話，則是塞入同類的缸中
                print('排入同類其他缸號中........')
                #20181225   放入目標缸中，輸入(被找尋工單號，被找尋總濃度，迴圈選到缸號，處理總缸list)
                if put_the_target_class_cylinder(_rec_no, _rec_test_con, _temp_same_class_cy_no, _rec_cy_list):
                    print('已排入同類缸 %s中' %_temp_same_class_cy_no)
                    # 20180425   新增put_flag1，排入同類其他缸號中就不再放入暫時區
                    put_flag1 = 1
                    break
    #========================================================
    #回傳同類缸也是滿的，則是往下跳到cy_group_list，去找出下一層的缸，去進行排缸
    global up_level_class_ptr,up_level_class_list,_target_ptr
    up_level_class_ptr=_rec_class
    if up_level_class_ptr<=5:
        up_level_class_ptr=_rec_class+1#往下一層
    print('同類缸已滿，往下一層找尋......')
    
    #找出目前下一層的ptr出來
    up_level_group_size=len(_rec_group_list[up_level_class_ptr])    #20181225   up_level_group_size下一層染缸大小
    _target_ptr=_rec_ptr_list[up_level_class_ptr]   #20181225   _target_ptr下一層指標
    print(up_level_group_size)
    print(_target_ptr)
    if _target_ptr>=up_level_group_size:    #20181225   避免下一層指標超過大小發生錯誤
        _target_ptr=_target_ptr % up_level_group_size
        _rec_ptr_list[up_level_class_ptr]=_target_ptr

    #20181225   修正為小於
    #if up_level_class_ptr <= len(_rec_group_list):
    if up_level_class_ptr<len(_rec_group_list):
        #去挑出一個cylinder出來
        for i in range(up_level_class_ptr, 7, 1):
            up_level_group=()
            up_level_group=_rec_group_list[up_level_class_ptr]
            up_level_class_size=0
            up_level_class_size=len(up_level_group)#算出裡面的個數
            up_level_class_list=list(up_level_group)#換成List比較好操作
       
            _target_cylinder_no=''
            #print(_target_ptr)
            _target_ptr = _rec_ptr_list[up_level_class_ptr] #20181225   _target_ptr下一層指標
            #20180702   對_target_ptr取餘數，避免+1後超過範圍錯誤，確實達到Load Balance
            if _target_ptr >= up_level_class_size:
                _target_ptr = _target_ptr % up_level_class_size
            _target_cylinder_no=up_level_class_list[_target_ptr]#找出下一層缸號碼
            put_flag = 0
            #print(up_level_class_ptr)
            #print(_target_cylinder_no)
            #print(up_level_class_size)
            for i in range(_target_ptr, up_level_class_size, 1):
                if not check_queue_is_fulled_or_not(_rec_cy_list,_target_cylinder_no):#檢查是否此下一層缸號已滿，(處理總缸list，排缸號)
                    print('%s 工單塞入下一層, 第%s層第%s缸' %(_rec_no,up_level_class_ptr,_target_cylinder_no))
                    # 20181225   放入目標缸中，輸入(被找尋工單號，被找尋總濃度，迴圈選到缸號，處理總缸list)
                    put_the_target_class_cylinder(_rec_no,_rec_test_con,_target_cylinder_no, _rec_cy_list)#放入相對應的缸中
                    #0115: 更新PTR，且放回PTR list中，給下一次排缸使用
                    _target_ptr+=1
                    _target_ptr=_target_ptr % len(up_level_class_list)
                    _rec_ptr_list[up_level_class_ptr]=_target_ptr
                    #20180312 工單塞入，put_flag = 1，來離開迴圈
                    put_flag = 1
                    break
                else:
                    _target_ptr += 1
                    _target_ptr = _target_ptr % len(up_level_class_list)
                    _target_cylinder_no = up_level_class_list[_target_ptr]
            # 20180312 工單塞入，put_flag = 1，來離開迴圈
            if put_flag == 1:
                break
            else:
                up_level_class_ptr += 1
    else:#都沒有，則是放入到暫時區(要依靠手工去排缸決定)(工單號，總濃度)
        _tuple=()
        _tuple+=(_rec_no,)
        _tuple+=(_rec_test_con,)
        recyce_list.append(_tuple)
    if put_flag == 0:
        # 20180425   新增put_flag1，排入同類其他缸號中就不再放入暫時區(工單號，總濃度)
        if put_flag1 == 0:
            _tuple = ()
            _tuple += (_rec_no,)
            _tuple += (_rec_test_con,)
            recyce_list.append(_tuple)
#============0115:排入同類缸中: 輸入(被找尋工單號，被找尋總濃度，迴圈選到缸號，處理總缸list)，輸出(排入為True，沒有排入為False)
def put_the_target_class_cylinder(_no, _con, _cy_no, _pro_list):
    result=False
    cysize=0
    cysize=len(_pro_list)
    index=0
    for index in range(cysize): #20181225   27
        _temp_no=''
        _temp_no=_pro_list[index].get_cylinder_no()
        if _temp_no==_cy_no:
            _temp_tuple=()
            _temp_tuple+=(_no,)
            _temp_tuple+=(_con,)
            _temp_jobnocon_list=_pro_list[index].get_cylinder_con_list()
            # 20180314 改成用長度判斷，大於等於48則set_queue_full_flag(True)
            # 20180621 改成用長度判斷，大於等於8則set_queue_full_flag(True)
            #if len(_temp_jobnocon_list)>=48:
            if len(_temp_jobnocon_list)>=8:
                _pro_list[index].set_queue_full_flag(True)
                continue
            else:
                _temp_jobnocon_list.append(_temp_tuple)
                _pro_list[index].set_cylinder_con_list(_temp_jobnocon_list)

                if _no != None:
                    temp_tuple3 = search_tuple_from_joblist(_no,_to_jobtask_list)  # 20181226 從工單號去找出相對應工單資訊tuple(工單號，待排工單list)
                    if temp_tuple3 != None:
                        if len(str(_cy_no)) == 1:
                            tmp_mach1 = 'D0' + str(_cy_no)
                            tmp_mach2 = 'D20' + str(_cy_no)
                        else:
                            tmp_mach1 = 'D' + str(_cy_no)
                            tmp_mach2 = 'D2' + str(_cy_no)

                        # 20181226   刪除schedule_before資料
                        cnxn10 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                        cursor10 = cnxn10.cursor()  # server 位置: 172.16.41.23
                        cursor10.execute("delete from schedule_before where mach_id in ('%s','%s')" % (tmp_mach1,tmp_mach2))
                        cnxn10.commit()

                        cnxn1 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
                        cursor1 = cnxn1.cursor()  # server 位置: 172.16.41.23
                        # 20181226  排完缸後，將結果回寫到schedule_before
                        cursor1.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",temp_tuple3[0], temp_tuple3[1], temp_tuple3[2], temp_tuple3[3], temp_tuple3[4],temp_tuple3[8], temp_tuple3[9], temp_tuple3[10], tmp_mach1)
                        cnxn1.commit()

                result = True
                break
        else:
            continue
    return result
#============檢查是否同類的缸號也是被排滿: 輸入(處理總缸List，排缸號)，輸出(是否有排入queue中，有為True，沒有為False)
def check_queue_is_fulled_or_not(_cy_list, _rec_cy_no):    
    check_result=False
    list_size=0
    list_size=len(_cy_list) #27(1~100)
    index=0
    for index in range(list_size):
        _temp_cy_no=''
        _temp_cy_no=_cy_list[index].get_cylinder_no()
        if _temp_cy_no==_rec_cy_no:
            _temp_jobnocon_list1=_cy_list[index].get_cylinder_con_list()
            # 20180314 改成用長度判斷，大於等於48則set_queue_full_flag(True)
            # 20180621 改成用長度判斷，大於等於8則set_queue_full_flag(True)
            #if len(_temp_jobnocon_list1)>=48:
            if len(_temp_jobnocon_list1)>=8:
                check_result=True
                _cy_list[index].set_queue_full_flag(True)
                break
        else:
            continue
    return check_result
#==================0131: 按鈕動作: 出對應的類別List中，所有工單資料排序濃度後，依照淡  中  濃去 進行分類與分缸，如果缸號數量不夠分三缸，則是把淡  跟  中 混合成一缸，輸入(缸list，缸指標List，缸分類list)，輸出(已經排好的第二次 淡 中  深缸號)
def groupList_to_clear_cylinder_jobtask(_pro_job_list, _cylinder_ptr_list, _cy_gp_list):
    index=0
    global _rec_gp_list#分類cy_group_list集合
    _rec_gp_list=[]
    _rec_gp_list=_cy_gp_list
    
    group_list_size=0
    group_list_size=len(_rec_gp_list)

    index=0
    for index in range(len(_pro_job_list)):
        _pro_job_list[index].set_queue_full_flag(False)
        
    for index in range(group_list_size):
        start_to_schedule_clear_cylinder_jobtask(_pro_job_list, _cylinder_ptr_list,_rec_gp_list[index])
#=========0131: 啟動第二次排序，進行最小清缸合併動作: 輸入(缸list，缸指標List，缸分類list)，輸出(已經排好的第二次 淡 中  深缸號)    
def start_to_schedule_clear_cylinder_jobtask(_pro_joblist,_cy_ptr_list, _cy_group_list):
    print('最小清缸排序動作啟動......................')
    global _cy_group_index_size
    global _total_jobtasks_list
    _total_jobtasks_list=[]
    _cy_group_index_size=0
    _cy_group_index_size=len(_cy_group_list)#去找出分類中的長度有多少: ex[(14,32)] 長度為2

    index,j,k=0,0,0
    
    for index in range(_cy_group_index_size):
        _temp_list_no=''
        _temp_list_no=_cy_group_list[index]
        #0212:測試code
        #_temp_list_no=_cy_group_list[4][index]
        
        for j in range(len(_pro_joblist)):
            #找到相關缸號
            if _temp_list_no==_pro_joblist[j].get_cylinder_no():
               _temp_list=[]
               #取得已經排入的list_job工單   
               _temp_list=_pro_joblist[j].get_cylinder_con_list()        
               for k in range(len(_temp_list)):
                   _temp_tuple=()
                   _temp_tuple=_temp_list[k]
                   _total_jobtasks_list.append(_temp_tuple)
            else:
                continue
    #=================進行濃度: 淺 中 深 排序=====
    global sorted_scheduled_list
    sorted_scheduled_list=[]
    sorted_scheduled_list=sorted(_total_jobtasks_list, key=operator.itemgetter(1))
    #=================排序完 依照濃度0~0.5, 0.5~1.0, 1.1~up
    #=================取出相關濃度值，填入對應List中
    index,j,k=0,0,0
    for index in range(_cy_group_index_size):
        _temp_list_no=''
        _temp_list_no=_cy_group_list[index]
        #0212:測試code
        #_temp_list_no=_cy_group_list[4][index]
    
        for j in range(len(_pro_joblist)):
            if _temp_list_no==_pro_joblist[j].get_cylinder_no():#找到相關缸號
               _temp_list=[]
               if _cy_group_index_size<3:#小於淺中深色三種，則是把淺跟中排一起，深色獨立一缸
                  if _cy_group_index_size==2:#剛好兩缸，則是分為淺中唯一缸，深色一缸
                  
                    print('目前個數為....%s個' %str(_cy_group_index_size))
                    if index==0:#淺與中色為一缸
                        _tmp_list=[]
                        _tmp_list=[i for  i in sorted_scheduled_list if i[1]<1.1]#把淺與中色抓出來為同一List
                        _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                        if len(_pro_joblist[j].get_cylinder_con_list())==8:
                            _pro_joblist[j].set_queue_full_flag(True)
                    else:#排入深色一缸
                        _tmp_list=[]
                        _tmp_list=[i for  i in sorted_scheduled_list if i[1]>1.1]#把深色抓出來為同一List
                        _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                        if len(_pro_joblist[j].get_cylinder_con_list())==8:
                            _pro_joblist[j].set_queue_full_flag(True)
                  else:#只有一缸 則是全部塞入
                        print('目前個數為....%s個' %str(_cy_group_index_size))
                        _tmp_list=[]
                        _tmp_list=[i for  i in sorted_scheduled_list]
                        _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                        if len(_pro_joblist[j].get_cylinder_con_list())==8:
                            _pro_joblist[j].set_queue_full_flag(True)
    
               elif _cy_group_index_size>3: #大於三缸#0125: thinking..............
                    #pass
                    #目前想法，各自去算出濃度的資料筆數，選擇相關缸數去填入。
                    #0129:如果大於三缸(如4, 5, ....以上)，則是依照濃度比數，去計算所需要的缸數，算出後
                    #填入相關缸中，如果滿缸，則是設定相關旗標，如果全滿，則是填入recylist中。
                    print('目前個數為....%s個' %str(_cy_group_index_size))
                    global _light_color_list, _mid_color_list, _deep_color_list
                    global _light_len,_mid_len, _deep_len
                    _light_color_list, _mid_color_list, _deep_color_list=[],[],[]
                    _light_len,_mid_len, _deep_len=0,0,0
                    
                    _light_color_list=[i for  i in sorted_scheduled_list if  i[1]<0.5]
                    _mid_color_list=[i for  i in sorted_scheduled_list if 1.0>i[1]>=0.5]
                    _deep_color_list=[i for  i in sorted_scheduled_list if i[1]>1.1]
                    
                    _light_len=len(_light_color_list)
                    _mid_len=len(_mid_color_list)
                    _deep_len=len(_deep_color_list)
                    
                    global _light_mod, _mid_mod, _deep_mod
                    _light_mod, _mid_mod, _deep_mod=0,0,0
                    _l_index, _m_index, _d_index=0,0,0
                    
                    
                    global _l_quot, _m_quot, _d_quot,_l_remin, _m_remin, _d_remin
                    _l_quot, _m_quot, _d_quot, _l_remin, _m_remin, _d_remin=0,0,0,0,0,0
                   
                    
                    _l_remin=_light_len % 8  
                    _m_remin=_mid_len % 8
                    _d_remin=_deep_len % 8
                    
                    _l_quot=_light_len/8
                    _m_quot=_mid_len/8
                    _d_quot=_deep_len/8
                    
                    
                    
                    
                    if _l_remin>0:
                        _light_mod=int(_l_quot)+1
                    else:
                        _light_mod=int(_l_quot)
                        
                    if _m_remin>0:
                        _mid_mod=int(_m_quot)+1
                    else:
                        _mid_mod=int(_m_quot)
                        
                    if _d_remin>0:
                        _deep_mod=int(_d_quot)+1
                    else:
                        _deep_mod=int(_d_quot)    
                            
                    
                    if index<_light_mod:
                        
                        if _pro_joblist[j].get_queue_full_flag()!=True:#淺色缸範圍
                            _tmp_list=[]
                            _tmp_list=[h for  h in sorted_scheduled_list[(index)*8:(index+1)*8]]
                            #去抓出[0:8],[8:16] 等相關的元素至list中
                            if len(_tmp_list)==8:
                                    _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                                    _pro_joblist[j].set_queue_full_flag(True)
                            else:
                                    _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                    elif index>=_light_mod and index<(_light_mod+_deep_mod-1):#中色缸範圍
                         
                        if _pro_joblist[j].get_queue_full_flag()!=True:
                            _tmp_list=[]
                            _tmp_list=[q for  q in sorted_scheduled_list[(index)*8:(index+1)*8]]
                            #去抓出[0:8],[8:16]，相關的元素至list中
                            if len(_tmp_list)==8:
                                    _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                                    _pro_joblist[j].set_queue_full_flag(True)
                            else:
                                    _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                    else:
                             
                        if _pro_joblist[j].get_queue_full_flag()!=True:
                            _tmp_list=[]
                            _tmp_list=[p for  p in sorted_scheduled_list[(index)*8:(index+1)*8]]
                            #去抓出[0:8],[8:16]，相關的元素至list中
                            if len(_tmp_list)==8:
                                    _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                                    _pro_joblist[j].set_queue_full_flag(True)
                            else:
                                    _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                    
               else: #剛好三缸，利用不同index值，去抓去各三缸所需要的工單號與濃度，填入List中 
                    #pass
                    if index==0:#淺色為一缸
                        _tmp_list=[]
                        _tmp_list=[i for  i in sorted_scheduled_list if i[1]<0.5]#把色抓出來為同一List
                        _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                        if len(_pro_joblist[j].get_cylinder_con_list())==8:
                            _pro_joblist[j].set_queue_full_flag(True)
                    elif index==1:#排入中色一缸
                        _tmp_list=[]
                        _tmp_list=[i for  i in sorted_scheduled_list if 1.0>i[1]>=0.5]#把中色抓出來為同一List
                        _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                        if len(_pro_joblist[j].get_cylinder_con_list())==8:
                            _pro_joblist[j].set_queue_full_flag(True)
                    else:
                        _tmp_list=[]
                        _tmp_list=[i for  i in sorted_scheduled_list if i[1]>1.1]#把深色抓出來為同一List
                        _pro_joblist[j].set_cylinder_con_list(_tmp_list)
                        if len(_pro_joblist[j].get_cylinder_con_list())==8:
                            _pro_joblist[j].set_queue_full_flag(True)

            else:
                continue
    #=======================
    #0124: 這邊再重新顯視一次     
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[0].get_cylinder_con_list(),cy1_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[1].get_cylinder_con_list(),cy2_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[2].get_cylinder_con_list(),cy3_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[3].get_cylinder_con_list(),cy5_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[4].get_cylinder_con_list(),cy6_schedule)
   
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[5].get_cylinder_con_list(),cy7_schedule)
   
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[6].get_cylinder_con_list(),cy8_schedule)
  
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[7].get_cylinder_con_list(),cy9_schedule)

    print_scheduled_jobno_for_each_cylinder(_pro_joblist[8].get_cylinder_con_list(),cy10_schedule)

    print_scheduled_jobno_for_each_cylinder(_pro_joblist[9].get_cylinder_con_list(),cy11_schedule)

    print_scheduled_jobno_for_each_cylinder(_pro_joblist[10].get_cylinder_con_list(),cy12_schedule)

    print_scheduled_jobno_for_each_cylinder(_pro_joblist[11].get_cylinder_con_list(),cy13_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[12].get_cylinder_con_list(),cy14_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[13].get_cylinder_con_list(),cy15_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[14].get_cylinder_con_list(),cy16_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[15].get_cylinder_con_list(),cy17_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[16].get_cylinder_con_list(),cy18_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[17].get_cylinder_con_list(),cy19_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[18].get_cylinder_con_list(),cy20_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[19].get_cylinder_con_list(),cy21_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[20].get_cylinder_con_list(),cy22_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[21].get_cylinder_con_list(),cy23_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[22].get_cylinder_con_list(),cy24_schedule)
   
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[23].get_cylinder_con_list(),cy25_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[24].get_cylinder_con_list(),cy26_schedule)
    
    print_scheduled_jobno_for_each_cylinder(_pro_joblist[25].get_cylinder_con_list(),cy32_schedule)           
    print('最小清缸排序動作已完成......................')
#================0131:去queue中，找尋相同工單，找到相同工單後回傳true，否則回傳False，目前已經停用此函式
def find_the_same_jobno_from_queue(_rec_queue, _rec_no):
    _result=FALSE
    size_queue=0
    size_queue=_rec_queue.size()
    index=0
    for index in range(0, size_queue):
        _desired_no=''
        _desired_no=_rec_queue.deq()
        if _rec_no==_desired_no:
            _result=True
            break
        else:
            _rec_queue.enq(_desired_no)
            continue
    return _result
#===============0131:去list中，找尋相同工單，找到相同工單後回傳true，否則回傳False: 輸入(工單List，工單號)，輸出(找到為True，找不到為False)
def find_the_same_jobno_in_queue(_recycle_list, _rec_job_no):
     global found
     found=False
     size=0
     size=len(_recycle_list)
     index=0
     for index in range(size):
         temp_no=""
         temp_no=_recycle_list[index]
         if _rec_job_no==temp_no:
             found=True
             break
         else:
             continue
     return found
#=========0131:檢查目前未排入缸號的工單號碼 並顯示於listbox_temp區域中: 輸入(工單List，顯示區域)，輸出(已經顯示的文字)
def show_no_schedule_jobno(_r_list, listbox):
    clear_listbox_content(listbox)
    size=len(_r_list)
    index=0
    i=0
    if size==0:
        listbox.insert(i,"")
    else:
        for i in range(0,size):
                temp_no_str=""
                temp_no_str=_r_list[i]
                listbox.insert(i,temp_no_str)
'''
#============檢查缸中同一天內工單數目L :輸入(工單list，缸中queue，工單號)，輸出(輸出數字為找到同一天的工單數目)
def check_eachday_jobtask_num(_r_list, _r_cylist_queue,_tmp_no):
   global tmp_list
   #queue物件取出轉成list去進行運算
   tmp_list=[]
   i=0
   for i in range(_r_cylist_queue.size()):
       _tmp_object=""
       _tmp_object=_r_cylist_queue.deq()
       tmp_list.append(_tmp_object)
       _r_cylist_queue.enq(_tmp_object)
   _tmp_date=""
   _tmp_date=search_opendate_from_jobist(_r_list,_tmp_no)
   _tmp_cmp_date=""
   j=0
   _tmp_cmp_result=0
   _tmp_cmp_counter=0
   for j in range(len(tmp_list)):
        _tmp_cmp_no=""
        _tmp_cmp_no=tmp_list[j]
        _tmp_cmp_date=search_opendate_from_jobist(_r_list,_tmp_cmp_no)
        _tmp_cmp_result=compute_day_diff(_tmp_date,_tmp_cmp_date)
        if _tmp_cmp_result<=1:
            _tmp_cmp_counter+=1
        else:
            continue
   return _tmp_cmp_counter
#=============比對時間差距 回傳幾天: 輸入(比較天1，比較天2)，輸出(差距天數)============
def compute_day_diff(_rec_date1,_rec_date2):
    #TIMEFORMAT="%Y-%m-%d %H:%M:%S:%f"
    TIMEFORMAT_WITHOUT_MS="%Y-%m-%d %H:%M:%S"#0105 mark: 因為有的資料庫欄位沒有milisecon
    time1=datetime.strptime(_rec_date1, TIMEFORMAT_WITHOUT_MS)
    time2=datetime.strptime(_rec_date2, TIMEFORMAT_WITHOUT_MS)
    diff_time=time1-time2
    _diff_days=int(diff_time.total_seconds()/86400)#相差幾天(目前是一天內)
    return _diff_days
'''
#=============從list中找出對應工單號碼的開卡日期: 輸入(工單List，工單號碼)，輸出(開卡日)============
def search_opendate_from_jobist(_target_list, _target_jobno):
    global _rec_date
    _rec_date=""
    list_size=0
    list_size=len(_target_list)
    index=0
    for index in range(list_size):
        _find_no=""
        _find_no=_target_list[index][0]
        if _find_no==_target_jobno:
            _rec_date=_target_list[index][1]
            break
    return _rec_date
#=============#0111:根據濃度值來進行排序，依序由淡--->濃列印出來相關工單號: 輸入(工單List，顯示區域)，輸出(顯示文字或是結果)
def print_scheduled_jobno_for_each_cylinder(_rec_list, listbox):
    clear_listbox_content(listbox)
    #20180608 清除之前排缸名單，添加排缸後名單
    processing_cylinder_list1[pcl].clear_cylinder_con_list()
    if len(_rec_list)>0:
        size=len(_rec_list)
        i=0
        j=0
        k=0
        m=0
        g=0
        listbox_list=[]
        if size==0:
            listbox.insert(i,"目前無暫時代排工單")
        else:
            #20180606 取消全濃度排序(小->大)，每4筆排序並寫入
            #_rec_list.sort(key=lambda tup: tup[1])
            for i in range(0,size):
                temp_no_str=""
                temp_no_str=_rec_list[i]
                listbox_list.append(temp_no_str)
                listbox_list.sort(key=lambda tup: tup[1])
                if (i+1)%4==0:
                    j = 0
                    for j in range(0, 4):
                        #f = strftime('%Y-%m-%d')  # 取得目前時間，只有年月日
                        f = (datetime.now() + timedelta(days=g)).strftime("%Y-%m-%d") # 取得目前時間，只有年月日，每次加一天
                        temp_no_str1 = ""
                        temp_no_str1 = listbox_list[j]
                        #processing_cylinder_list1[pcl].queue.enq(temp_no_str1[0])
                        #20180607 新增排缸日期及班次
                        temp_no_str1 = temp_no_str1 + (f,) + (j+1,)
                        # 20180608 清除之前排缸名單，添加排缸後名單
                        _temp_jobno_con_list1=processing_cylinder_list1[pcl].get_cylinder_con_list()
                        _temp_jobno_con_list1.append(temp_no_str1)
                        processing_cylinder_list1[pcl].set_cylinder_con_list(_temp_jobno_con_list1)
                        listbox.insert(i,temp_no_str1)
                        # 20180607 新增匯出CSV所需資料[排缸時間 班別]
                        _to_jobtasked_list.append(temp_no_str1)
                    listbox_list = []
                    g=g+1
            size1 = len(listbox_list)
            m=size-size1
            if size1>0:
                for k in range(0, size1):
                    f = (datetime.now() + timedelta(days=g)).strftime("%Y-%m-%d")  # 取得目前時間，只有年月日，每次加一天
                    temp_no_str2 = ""
                    temp_no_str2 = listbox_list[k]
                    temp_no_str2 = temp_no_str2 + (f,) + (k+1,)
                    # 20180608 清除之前排缸名單，添加排缸後名單
                    _temp_jobno_con_list2 = processing_cylinder_list1[pcl].get_cylinder_con_list()
                    _temp_jobno_con_list2.append(temp_no_str2)
                    processing_cylinder_list1[pcl].set_cylinder_con_list(_temp_jobno_con_list2)
                    listbox.insert(m, temp_no_str2)
                    _to_jobtasked_list.append(temp_no_str2)
                    m=m+1
                    if m==size:
                        break
#20180625   用於一般手動排單
def print_scheduled_jobno_for_each_cylinder1(_rec_list, listbox):
    clear_listbox_content(listbox)
    if len(_rec_list)>0:
        size=len(_rec_list)
        i=0
        j=0
        listbox_list=[]
        if size==0:
            listbox.insert(i,"目前無暫時代排工單")
        else:
            #_rec_list.sort(key=lambda tup: tup[1])
            for i in range(0,size):
                temp_no_str=""
                temp_no_str=_rec_list[i]
                listbox.insert(i,temp_no_str)
#20180703   用於排序手動排單，並新增cy_index來因應左右兩邊ListBox
def print_scheduled_jobno_for_each_cylinder2(_rec_list, listbox, cy_index):
    clear_listbox_content(listbox)
    #20180703   清除排序後的各缸工單及所有工單
    processing_cylinder_list1[cy_index].clear_cylinder_con_list()
    if len(_rec_list)>0:
        size=len(_rec_list)
        i=0
        j=0
        k=0
        m=0
        g=0
        listbox_list=[]
        if size==0:
            listbox.insert(i,"目前無暫時代排工單")
        else:
            #_rec_list.sort(key=lambda tup: tup[1])
            for i in range(0,size):
                temp_no_str=""
                temp_no_str=_rec_list[i][0:2]
                listbox_list.append(temp_no_str)
                listbox_list.sort(key=lambda tup: tup[1])
                if (i+1)%4==0:
                    j = 0
                    for j in range(0, 4):
                        #f = strftime('%Y-%m-%d')  # 取得目前時間，只有年月日
                        f = (datetime.now() + timedelta(days=g)).strftime("%Y-%m-%d") # 取得目前時間，只有年月日，每次加一天
                        temp_no_str1 = ""
                        temp_no_str1 = listbox_list[j]
                        #20180607 新增排缸日期及班次
                        temp_no_str1 = temp_no_str1 + (f,) + (j+1,)
                        _temp_jobno_con_list1 = processing_cylinder_list1[cy_index].get_cylinder_con_list()
                        _temp_jobno_con_list1.append(temp_no_str1)
                        processing_cylinder_list1[cy_index].set_cylinder_con_list(_temp_jobno_con_list1)
                        listbox.insert(i,temp_no_str1)
                        #20180703  搜尋刪除舊工單，並新增匯出CSV所需資料[排缸時間 班別]
                        OutputList = list(filter(lambda x: x[0].startswith(temp_no_str1[0]), _to_jobtasked_list))
                        _to_jobtasked_list.remove(OutputList[0])
                        _to_jobtasked_list.append(temp_no_str1)
                    listbox_list = []
                    g=g+1
            size1 = len(listbox_list)
            m=size-size1
            if size1>0:
                for k in range(0, size1):
                    f = (datetime.now() + timedelta(days=g)).strftime("%Y-%m-%d")  # 取得目前時間，只有年月日，每次加一天
                    temp_no_str2 = ""
                    temp_no_str2 = listbox_list[k]
                    temp_no_str2 = temp_no_str2 + (f,) + (k+1,)
                    _temp_jobno_con_list2 = processing_cylinder_list1[cy_index].get_cylinder_con_list()
                    _temp_jobno_con_list2.append(temp_no_str2)
                    processing_cylinder_list1[cy_index].set_cylinder_con_list(_temp_jobno_con_list2)
                    listbox.insert(m, temp_no_str2)
                    # 20180703  搜尋刪除舊工單，並新增匯出CSV所需資料[排缸時間 班別]
                    OutputList = list(filter(lambda x: x[0].startswith(temp_no_str2[0]), _to_jobtasked_list))
                    _to_jobtasked_list.remove(OutputList[0])
                    _to_jobtasked_list.append(temp_no_str2)
                    m=m+1
                    if m==size:
                        break
#===========列印出來每個缸裡面的queue所有工單號碼: 輸入(要顯示的queue，顯示區域)，輸出(顯示文字或是結果)
def print_each_cylinder_queue(_rec_queue, listbox):
    clear_listbox_content(listbox)
    temp_queue=queue()
    temp_queue=_rec_queue
    size=temp_queue.size()
    i=0
    j=0
    listbox_list=[]
    if size==0:
        listbox.insert(i,"")
    else:
        for i in range(0,size):
            temp_no_str=""
            temp_no_str=temp_queue.deq()#先從queue取出
            listbox.insert(i,temp_no_str)
            #listbox.itemconfig(i, bg='green', fg='white')#字體可變換顏色
            i+=1
            temp_queue.enq(temp_no_str)#填回原本queue中
#===========cy1選擇到的event函式: 輸入(輸入的事件)，輸出(所點選的物件為何(工單號))
def cy1_select_trigger(evt):
    try:
        w = evt.widget
        if w.curselection():
            index = int(w.curselection()[0])
            value = w.get(index)
            print('You selected item %d: "%s"' % (index, value))
    except IndexError:
        print("IndexError")
#========listbox_temp暫存區去點選: 輸入(輸入的事件)，輸出(所點選的物件為何(工單號))
def listbox_temp_select(evt):
    try:
        temp_work = evt.widget
        if temp_work.curselection():
            index = int(temp_work.curselection()[0])
            value = temp_work.get(index)
            print("You selected item %d: %s" % (index, value))
    except IndexError:
        print("選擇"%value+"時的Index錯誤")
#========這邊為相關缸號來進行手動刪除排程工單: 輸入(被刪除物件的顯示區域，被新增物件的顯示區域，缸號碼)，輸出(重新顯示被刪除物件的QUEUE內容)
def cy_btn_delete(listbox,_rec_listbox,_rec_cy_name):
    global temp_list
    temp_list=[]
    global tuple
    tuple=()
    _found_cy_index=0
    _rec_cy_number=int(_rec_cy_name[-1:])#取得目前每缸編號
    #帶入編號，找出對應index number:提供後續queue
    _found_cy_index=find_cylinder_index_from_cyno(_rec_cy_number,processing_cylinder_list)
    try:
        if listbox.curselection():
            index=int(listbox.curselection()[0])
            value=listbox.get(index)
            print("%s 已經被刪除" % value)
    except IndexError:
            print("刪除" % value+"時的Index錯誤")
    #------------刪除後跑至顯示於listbox_temp視窗中------
    tuple+=(value,)
    temp_list.append(tuple)
    i=0
    for i in range(len(temp_list)):
        _rec_listbox.insert(i,temp_list[i][0])
    j=0
    #-------------從queue中移除-------------------------
    size=0
    size=processing_cylinder_list[_found_cy_index].queue.size()
    
    for j in range(0,size):
            temp_cmp_str=""
            temp_cmp_str=processing_cylinder_list[_found_cy_index].queue.deq()
            if value==temp_cmp_str:
                break
            else:
                processing_cylinder_list[_found_cy_index].queue.enq(temp_cmp_str)
            j+=1
    #-----重新顯示queue內容---------------
    print_each_cylinder_queue(processing_cylinder_list[_found_cy_index].queue,listbox)
#======================輸入相關缸號碼號，去找出對應的index為何: 輸入(找尋的缸號碼，缸list)，輸出(缸索引編號)
def find_cylinder_index_from_cyno(_rec_number, _rec_cylinder_list):
    found_number=0
    size=0
    size=len(_rec_cylinder_list)
    i=0
    for i in range(size):
        temp_index=0
        temp_index=int(_rec_cylinder_list[i].get_cylinder_no())
        if _rec_number==temp_index:
            found_number=i
        else:
            continue
    return found_number
#===========================按鈕動作: 這邊去手動新增排程工單: 輸入(被刪除物件的顯示區域，被新增物件的顯示區域，缸號碼)，輸出(重新顯示被新增物件的QUEUE內容)
def cy_btn_add(listbox,_rec_listbox,_rec_cy_name):
    global temp_add_list
    temp_add_list=[]
    global tuple
    tuple=()
    _rec_cy_number=int(_rec_cy_name[-1:])#取得目前每缸編號
    _found_cy_index=0
    #帶入編號，找出對應index number
    _found_cy_index=find_cylinder_index_from_cyno(_rec_cy_number,processing_cylinder_list)
    index=int(_rec_listbox.curselection()[0])
    value=_rec_listbox.get(index)
    _rec_listbox.delete(index)
    print("%s 已經被新增" % value)
    #----------------新增回原來的queue---------
    processing_cylinder_list[_found_cy_index].queue.enq(value)
    #寫回目前對應的cylinder中的queue內
    print_each_cylinder_queue(processing_cylinder_list[_found_cy_index].queue,listbox)
#==========================更新treeview的內容: 輸入(tree顯示區域)，輸出(顯示文字)
def clear_tree_content(tree):
    x =tree.get_children() 
    for item in x: 
        tree.delete(item)
#========================啟動button功能: 輸入(按鈕名稱)，輸出(啟用該按鈕功能)
def enable_button(button):
    button.config(state=tkinter.NORMAL)
#========================關閉button功能: 輸入(按鈕名稱)，輸出(關閉該按鈕功能)
def disable_button(button):
    button.config(state=tkinter.DISABLED)
#========================程式離開: 輸入(tkinter父物件)，輸出(關閉視窗或是母程式)
def exit(tk):
    tk.destroy()
#========================清除text內顯示內容: 輸入(顯示區域)，輸出(清除顯示區域內文字)
def clear_text_content(text):
    text.delete(1.0, tkinter.END)
#========================清除listbox內容: 輸入(顯示區域)，輸出(清除顯示區域內文字)
def clear_listbox_content(listbox):
    listbox.delete(0, tkinter.END)
#===============================
#點選optionMenu後，可以選擇相關缸號，去載入相關排程工單資訊進入
#且去判斷目前的缸號狀態，建議可以排入其他缸號
#===============缸號選擇menu變動時，載入相關缸號內部的內容: 輸入(點選項目，工單List，顯示區域，pop視窗區域)，輸出(顯示目前pop視窗內的清單內容)
def cy_selection_changed(_rec_select,_rec_tmp_list,_show_listbox, _pop_rec_info_listbox):
    global rw
    global ry
    clear_listbox_content(_show_listbox)
    clear_listbox_content(_pop_rec_info_listbox)
    print("第"+_rec_select.get()+"缸已點選")
    
    size=0
    size=len(_rec_tmp_list)
    global _rec_number
    _rec_number=str(_rec_select.get())

    #0207:修正手排點選載入錯誤資料
    global _tmp_list
    _tmp_list=[]

    i=0
    for i in range(size):
        temp_index=0
        temp_index=str(_rec_tmp_list[i].get_cylinder_no())
        if _rec_number==temp_index:
            _tmp_list=_rec_tmp_list[i].get_cylinder_con_list()#取得list資料
            rw = _rec_tmp_list[i].get_weight()
            ry = _rec_tmp_list[i].get_yard_length()
            break

    # 20180704   顯示右缸規格[缸容 碼長]
    pop_label_rspec = ttk.Label(pop_tk, text="缸容:" + str(rw) + ", 碼長:" + str(ry))
    pop_label_rspec.place(x=550, y=40, width=200, height=30)

    #20180704   顯示右缸工單筆數
    pop_label_rsum = ttk.Label(pop_tk, text="共" + str(len(_tmp_list)) + "筆")
    pop_label_rsum.place(x=550, y=290, width=200, height=30)

    print_scheduled_jobno_for_each_cylinder1(_tmp_list,_show_listbox)
    #======================================
    #_pop_rec_info_listbox.insert(1,)#清除文字
    pop_rec_info_list=[]
    pop_index=0
    for pop_index, listbox_entry in enumerate(_show_listbox.get(0, END)):
        pop_rec_info_list.append(_show_listbox.get(pop_index))
    size=len(pop_rec_info_list)
    if size>7:
        _pop_rec_info_listbox.insert(1,"此缸排入太多工單，請用手動排缸調整工單，謝謝")
        #global blink_id
        # blink_id=blink(_pop_rec_info_listbox, "green", "red")
        
    else:
        #blink(_pop_rec_info_listbox, "white", "white",False)
        #blink(_pop_rec_info_listbox, "green", "red")
        #cancel_blink()
       # cancel_blink(blink_id)
       # cancel_blink(_pop_rec_info_listbox,blink_id)
        _pop_rec_info_listbox.insert(1,"目前此缸狀態正常。")  
        
       # blink(_pop_rec_info_listbox, "white", "white")
#==============================原本想做閃動提示:可看你時間去研究開發
 # def flash(self,count):
 #        bg = self.cget('background')
 #        fg = self.cget('foreground')
 #        self.configure(background=fg,foreground=bg)
 #        count +=1
 #        if (count < 31):
 #             self.after(1000,self.flash, count) 
#=============文字閃動效果==========原本想做閃動提示:可看你時間去研究開發
def blink(l,f1, f2):
    #if _rec_bool:
    _rec_blink_id=''
    
    if l["bg"] == f1:
        l["bg"] = f2
    else:
        l["bg"] = f1
        
    _rec_blink_id=l.after(1000, blink, l, f1, f2)
    #_rec_blink_id=_rec_blink_id[-2:]
    print('blink id  %s' %_rec_blink_id) 
    #else:
    #l.after_cancel(blink_id)
    return _rec_blink_id
def cancel_blink(l,_rec_id):
   l.after_cancel(_rec_id)
#======popup跳出視窗顯示相關區域, 輸入(_cur_cy_listbox:排程區域，_rec_cyno: 排程缸號，_rec_pro_list:排程cylinder list，_set_cy_list:該染缸規格)，輸出(顯示出POP目前的缸號內容與工單、濃度值排序結果)
def Popup(_cur_cy_listbox,_rec_cyno,_rec_pro_list,_set_cy_list):

    global pop_tk
    global lw
    global ly
    pop_tk = tkinter.Tk()
    pop_tk.title('工作排程')

    label1=ttk.Label(pop_tk, text="工單顯示區",font="24")
    label1.pack()

    frame1 = tkinter.Frame(pop_tk, width=950, height=400)
    frame1.pack()
    
    pop_label= ttk.Label(pop_tk, text="排程工單區域(第"+str(_rec_cyno)+"缸)")
    pop_label.place(x=25, y=20,width=200, height=30)

    #20180704   顯示左缸規格[缸容 碼長]
    size = 0
    size = len(_rec_pro_list)
    k = 0
    for k in range(size):
        temp_index = 0
        temp_index = str(_rec_pro_list[k].get_cylinder_no())
        if str(_rec_cyno) == temp_index:
            lw = _rec_pro_list[k].get_weight()
            ly = _rec_pro_list[k].get_yard_length()
            break

    pop_label_lspec = ttk.Label(pop_tk, text="缸容:" + str(lw) + ", 碼長:" + str(ly))
    pop_label_lspec.place(x=25, y=40, width=200, height=30)
    
    pop_left_status=Listbox(pop_tk)
    pop_left_status.place(x=20, y=65, width=200,height=240)
    
    
    pop_label2= ttk.Label(pop_tk, text="欲轉換的缸號(來源缸號)")
    pop_label2.place(x=550, y=20,width=200, height=30)
    
    pop_right_status=Listbox(pop_tk)
    pop_right_status.place(x=550, y=70, width=200,height=220)
    
    #===================================
    global pop_recommdation_info
    pop_recommdation_info=Listbox(pop_tk)
    pop_recommdation_info.place(x=500, y=320, width=420,height=60)
    pop_recommdation_info.insert(1,"尚未有相關此缸號狀態")
    #==================================放在POP-uP訊息槽下面，用來推薦相關目前缸狀態
    global move_to_right_select
    move_to_right_select=""
    
    #這邊要去抓list_temp暫存區這邊未排入的資料
    cylinder_options = ["1","2","3","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","32","100"]
    variable = StringVar(pop_tk)
    variable.set(cylinder_options[0]) # default value
    #1117:這邊必須要把自己當成參數傳過去(variable)，才能觸發cy_selection_changed 去抓目前所點選的選項
    variable.trace("w", lambda *args: cy_selection_changed(variable,_rec_pro_list,pop_right_status, pop_recommdation_info))
    #cy_selection_changed("1",processing_cylinder_list,pop_right_status)

    w = OptionMenu(pop_tk, variable, *cylinder_options)
    w.place(x=450, y=50, width=100,height=40)
    
    #搬移到右邊: 可看你開發時間去COPY此方式開發
    #move_to_right_queue
    #move_to_right_queue= ttk.Button(pop_tk, text=">>",command = lambda *args:  move_to_left(variable,_cur_cy_listbox, pop_left_status,pop_right_status,_rec_cyno,_rec_pro_list))
    #move_to_right_queue.place(x=280, y=90, width=150,height=40)
    #搬移到左邊
    #Move_to_left_queue
    move_to_left_queue= ttk.Button(pop_tk, text="<<搬移至左邊缸號",command =lambda *args:  move_to_left(variable,_cur_cy_listbox, pop_left_status,pop_right_status,_rec_cyno,_rec_pro_list))
    move_to_left_queue.place(x=280, y=150, width=180,height=40)
    
    #---------左手邊內容區: 主要用來顯示相關排程相關資料 方便手動調整
    global _listbox_list
    _listbox_list=[]
    j=0
    #去抓右手邊區域cyX-schedule裏面的顯示資料
    for j, listbox_entry in enumerate(_cur_cy_listbox.get(0, END)):
        _listbox_list.append(_cur_cy_listbox.get(j))
    #----------------------------------------------------
    #顯示出來在左邊pop_left_status中
    i=0
    for i in range(len(_listbox_list)):
        pop_left_status.insert(i, _listbox_list[i])
    #----------------------------------------------------

    #20180314 新增左缸工單筆數
    global pop_label_sum
    pop_label_sum = ttk.Label(pop_tk, text="共"+str(len(_listbox_list))+"筆")
    pop_label_sum.place(x=25, y=300, width=200, height=30)

    #button9 = ttk.Button(pop_tk, text="離開",command=pop_tk.destroy)
    button9 = ttk.Button(pop_tk, text="離開", command=lambda: [refresh_mainpage()])
    button9.place(x=300, y=350, width=150,height=40)
    
    pop_tk.mainloop()
#=====================去從接收到的cyno缸號，去找出相關內部的queue出來: 輸入(缸號碼，缸list)，輸出(找到對應缸號碼的QUEUE內容)
def findqueue_by_cylinderno(_rec_cyno, _tar_list):
    found_queue=None
    found_queue=queue()
    tmep_no=0
    index=0
    size=len(_tar_list)
    for index in range(0, size):
        tmep_no=_tar_list[index].get_cylinder_no()
        if tmep_no==_rec_cyno:
            found_queue=_tar_list[index].get_dying_queue()
            break
        else:
            continue
    
    return found_queue
#==============從jobno工單號去找尋目前排入的缸號名稱: 輸入(工單號)，輸出(顯示區域中的缸號碼)
def search_cylinder_name_from_jobno(_target_jobno):
    cy_name=None
    global cyname_list
    if _target_jobno=="1":
        cy_name=cy1_schedule
    elif _target_jobno=="2":
        cy_name=cy2_schedule
    elif _target_jobno=="3":
        cy_name=cy3_schedule
    elif _target_jobno=="5":
        cy_name=cy5_schedule
    elif _target_jobno=="6":
        cy_name=cy6_schedule
    elif _target_jobno=="7":
        cy_name=cy7_schedule 
    elif _target_jobno=="8":
        cy_name=cy8_schedule 
    elif _target_jobno=="9":
        cy_name=cy9_schedule 
    elif _target_jobno=="10":
        cy_name=cy10_schedule
    elif _target_jobno=="11":
        cy_name=cy11_schedule
    elif _target_jobno=="12":
        cy_name=cy12_schedule
    elif _target_jobno=="13":
        cy_name=cy13_schedule
    elif _target_jobno=="14":
        cy_name=cy14_schedule
    elif _target_jobno=="15":
        cy_name=cy15_schedule
    elif _target_jobno=="16":
        cy_name=cy16_schedule
    elif _target_jobno=="17":
        cy_name=cy17_schedule
    elif _target_jobno=="18":
        cy_name=cy18_schedule
    elif _target_jobno=="19":
        cy_name=cy19_schedule
    elif _target_jobno=="20":
        cy_name=cy20_schedule
    elif _target_jobno=="21":
        cy_name=cy21_schedule
    elif _target_jobno=="22":
        cy_name=cy22_schedule
    elif _target_jobno=="23":
        cy_name=cy23_schedule
    elif _target_jobno=="24":
        cy_name=cy24_schedule
    elif _target_jobno=="25":
        cy_name=cy25_schedule
    elif _target_jobno=="26":
        cy_name=cy26_schedule
    elif _target_jobno=="32":
        cy_name=cy32_schedule
    elif _target_jobno=="100":#設定為暫時缸
        cy_name=listbox_temp
    else:
        cy_name=None
    return cy_name
#============從右邊已排缸號內容，把工單號碼搬移到左邊: 輸入(選擇到的工單項目，新缸號顯示區域位置，pop視窗左手邊顯示listbox，pop視窗右手邊顯示listbox，目前缸號號碼，全部缸list)，輸出(移動到新缸後的結果)
def move_to_left(_rec_cy_select,_cy_schedule_listbox, _left_listbox, _right_listbox,_rec_cyno,_rec_list):

    global _get_right_select
    _get_right_select=_rec_cy_select.get()#0207: 取得POP視窗中，右手邊視窗(舊缸)所點選的缸號號碼
    #print(_get_right_select)
    
    if _get_right_select==str(_rec_cyno):#點選缸號與目前缸號比對
        showinfo("警告視窗","您已選擇到相同缸號，請重新選擇其他缸號，以利進行手動排程，感謝您!!")
        log.warn("選擇到相同缸號進行手動排缸")
    else:
        size = 0
        size = len(_rec_list)

        # 20180629   取得左右染缸規格
        i = 0
        for i in range(size):
            temp_index = 0
            temp_index = str(_rec_list[i].get_cylinder_no())
            if str(_rec_cyno) == temp_index:
                _tmp_number = len(_rec_list[i].get_cylinder_con_list())  # 取得list資料
                #lw = _rec_list[i].get_weight()
                #ly = _rec_list[i].get_yard_length()
                break
        #j = 0
        #for j in range(size):
        #    temp_index1 = 0
        #    temp_index1 = str(_rec_list[j].get_cylinder_no())
        #    if _get_right_select == temp_index1:
                #rw = _rec_list[j].get_weight()
                #ry = _rec_list[j].get_yard_length()
        #        break

        #20180627   滿缸時，手動排缸無法排入
        if _tmp_number == 8:
            clear_listbox_content(pop_recommdation_info)
            pop_recommdation_info.insert(1, "滿缸無法排入")
        # 20180629   右缸缸容碼長大於左缸時，無法排入
        elif ((lw - rw) or (ly - ry)) < 0:
            clear_listbox_content(pop_recommdation_info)
            pop_recommdation_info.insert(1, "規格不符無法排入")
        else:
            # 20180629   抓取暫時缸工單規格與左缸比對，太大時無法排入
            global _swap_list
            global _added_cy_index
            if _get_right_select == '100':
                size1 = len(return_list)
                k = 0
                if _right_listbox.curselection():
                    index1 = int(_right_listbox.curselection()[0])
                    value1 = _right_listbox.get(index1)  # 20180629: 取得缸號內所點選的資料值(工單號，濃度，排缸日期，班別)
                    for k in range(size1):
                        temp_index2 = 0
                        temp_index2 = str(return_list[k][0])
                        if value1[0] == temp_index2:
                            rw1 = return_list[k][2]
                            ry1 = return_list[k][5]
                            break
                    if ((lw - rw1) or (ly - ry1)) < 0:
                        clear_listbox_content(pop_recommdation_info)
                        pop_recommdation_info.insert(1, "暫時缸規格不符，無法排入")
                    else:
                        try:
                            if  _right_listbox.curselection():
                                index=int(_right_listbox.curselection()[0])
                                value=_right_listbox.get(index)#20180629: 取得缸號內所點選的資料值(工單號，濃度，排缸日期，班別)
                                _right_listbox.delete(index)
                                print(value[0]+" 號工單 \n")
                                #0207:原為value
                                print("%s 已經被搬移至第 %s 缸\n" % (value[0], str(_rec_cyno)))
                        except IndexError:
                            print("IndexError 選擇")
                            log.warn("IndexError: index 選擇錯誤")
        
                        #------0207: 點選後跑至顯示於左邊_left_listbox視窗中------
                        #------新增點選工單至到後來的缸list中: ex: 9缸List中-----------
                        _rec_cy_number=int(_rec_cyno)
                        _added_cy_index=0
                        _added_cy_index=find_cylinder_index_from_cyno(_rec_cy_number,_rec_list) #2,所有缸
                        #print(_added_cy_index)
                        #0207: 新增工單號與濃度至點選缸號list中
                        _moved_list=[]
                        _moved_list=_rec_list[_added_cy_index].get_cylinder_con_list()
                        #print(_moved_list)
                        _moved_list.append(value)
                        _rec_list[_added_cy_index].set_cylinder_con_list(_moved_list)
                        print("%s 已經被新增至第 %s 缸\n " % (value[0],str(_rec_cyno)))
                        #==================================以上是點選入新缸List中
                        print_scheduled_jobno_for_each_cylinder2(_rec_list[_added_cy_index].get_cylinder_con_list(),_left_listbox,_added_cy_index)#0207:POP視窗左手邊區塊顯示移動後的工單資料與濃度
                        print_scheduled_jobno_for_each_cylinder2(_rec_list[_added_cy_index].get_cylinder_con_list(),_cy_schedule_listbox,_added_cy_index)#0207:顯示移動工單後新缸的Listbox值:如9缸--->13缸，這裡為13缸的listbox

                        #20180626   新增手動排單筆數即時更新
                        pop_label_sum = ttk.Label(pop_tk,text="共" + str(len(_rec_list[_added_cy_index].get_cylinder_con_list())) + "筆")
                        pop_label_sum.place(x=25, y=300, width=200, height=30)

                        #-------------0207: 從原本的缸號中移除點選的工單號與濃度資料-------------------------
                        _remove_cy_index=0
                        _rec_cy_number=int(_get_right_select)#取得右手邊缸號
                        _remove_cy_index=find_cylinder_index_from_cyno(_rec_cy_number,_rec_list)
                        #移除點選工單後的剩下排缸工單List集合與濃度放入_swap_list中
                        _swap_list=[]
                        _swap_list=_rec_list[_remove_cy_index].get_cylinder_con_list()
                        _swap_list=[i for i in _swap_list if i[0] !=value[0]]
    
                        #0207:設定回原來的右手邊缸list中。
                        _rec_list[_remove_cy_index].set_cylinder_con_list(_swap_list)
                        #0207:列印原來移動的缸listbox顯示區域
                        print_scheduled_jobno_for_each_cylinder2(_rec_list[_remove_cy_index].get_cylinder_con_list(),_right_listbox,_remove_cy_index)
                        # 20180704   顯示右缸工單筆數
                        pop_label_rsum = ttk.Label(pop_tk, text="共" + str(len(_rec_list[_remove_cy_index].get_cylinder_con_list())) + "筆")
                        pop_label_rsum.place(x=550, y=290, width=200, height=30)
        
                        #0207:取得最後移動缸號listbox名稱(也就是新缸的Listbox顯示區域)
                        return_cy_name=""
                        return_cy_name=search_cylinder_name_from_jobno(_get_right_select)
                        if return_cy_name==None:
                            print("無法取得原點選移除缸號")
                            log.warn("無法取得原點選移除缸號")
                        else:
                            #0207:顯示相關移動後的缸號
                            print_scheduled_jobno_for_each_cylinder1(_rec_list[_remove_cy_index].get_cylinder_con_list(),return_cy_name)
            else:
                try:
                    if _right_listbox.curselection():
                        index = int(_right_listbox.curselection()[0])
                        value = _right_listbox.get(index)  # 20180629: 取得缸號內所點選的資料值(工單號，濃度，排缸日期，班別)
                        _right_listbox.delete(index)
                        print(value[0] + " 號工單 \n")
                        # 0207:原為value
                        print("%s 已經被搬移至第 %s 缸\n" % (value[0], str(_rec_cyno)))
                except IndexError:
                    print("IndexError 選擇")
                    log.warn("IndexError: index 選擇錯誤")

                # ------0207: 點選後跑至顯示於左邊_left_listbox視窗中------
                # ------新增點選工單至到後來的缸list中: ex: 9缸List中-----------
                _rec_cy_number = int(_rec_cyno)
                _added_cy_index = 0
                _added_cy_index = find_cylinder_index_from_cyno(_rec_cy_number, _rec_list)  # 2,所有缸
                print(_added_cy_index)
                # 0207: 新增工單號與濃度至點選缸號list中
                _moved_list = []
                _moved_list = _rec_list[_added_cy_index].get_cylinder_con_list()
                # print(_moved_list)
                _moved_list.append(value)
                _rec_list[_added_cy_index].set_cylinder_con_list(_moved_list)
                print("%s 已經被新增至第 %s 缸\n " % (value[0], str(_rec_cyno)))
                # ==================================以上是點選入新缸List中
                print_scheduled_jobno_for_each_cylinder2(_rec_list[_added_cy_index].get_cylinder_con_list(),
                                                         _left_listbox,_added_cy_index)  # 0207:POP視窗左手邊區塊顯示移動後的工單資料與濃度
                print_scheduled_jobno_for_each_cylinder2(_rec_list[_added_cy_index].get_cylinder_con_list(),
                                                         _cy_schedule_listbox,_added_cy_index)  # 0207:顯示移動工單後新缸的Listbox值:如9缸--->13缸，這裡為13缸的listbox

                # 20180626   新增手動排單筆數即時更新
                pop_label_sum = ttk.Label(pop_tk, text="共" + str(len(_rec_list[_added_cy_index].get_cylinder_con_list())) + "筆")
                pop_label_sum.place(x=25, y=300, width=200, height=30)

                # -------------0207: 從原本的缸號中移除點選的工單號與濃度資料-------------------------
                _remove_cy_index = 0
                _rec_cy_number = int(_get_right_select)  # 取得右手邊缸號
                _remove_cy_index = find_cylinder_index_from_cyno(_rec_cy_number, _rec_list)
                # 移除點選工單後的剩下排缸工單List集合與濃度放入_swap_list中
                _swap_list = []
                _swap_list = _rec_list[_remove_cy_index].get_cylinder_con_list()
                _swap_list = [i for i in _swap_list if i[0] != value[0]]

                # 0207:設定回原來的右手邊缸list中。
                _rec_list[_remove_cy_index].set_cylinder_con_list(_swap_list)
                # 0207:列印原來移動的缸listbox顯示區域
                print_scheduled_jobno_for_each_cylinder2(_rec_list[_remove_cy_index].get_cylinder_con_list(),_right_listbox,_remove_cy_index)
                # 20180704   顯示右缸工單筆數
                pop_label_rsum = ttk.Label(pop_tk, text="共" + str(len(_rec_list[_remove_cy_index].get_cylinder_con_list())) + "筆")
                pop_label_rsum.place(x=550, y=290, width=200, height=30)

                # 0207:取得最後移動缸號listbox名稱(也就是新缸的Listbox顯示區域)
                return_cy_name = ""
                return_cy_name = search_cylinder_name_from_jobno(_get_right_select)
                if return_cy_name == None:
                    print("無法取得原點選移除缸號")
                    log.warn("無法取得原點選移除缸號")
                else:
                    # 0207:顯示相關移動後的缸號
                    print_scheduled_jobno_for_each_cylinder1(_rec_list[_remove_cy_index].get_cylinder_con_list(),
                                                             return_cy_name)
#===========0111:根據工單號去找出對應的總濃度值: 輸入(工單號，工單list)，輸出(濃度值)
def find_the_con_from_jobtask(_rec_jobno,_jobtask_list):
    global _found_con
    _found_con=0.0
    index=0
    listsize=0
    listsize=len(_jobtask_list)
    for index in range(listsize):
        _temp_jobno=''
        _temp_con=0.0
        _temp_jobno=_jobtask_list[index][0]
        if _rec_jobno==_temp_jobno:
            _temp_con=_jobtask_list[index][11]
            _found_con=_temp_con
            break
        else:
            continue
            
    return _found_con
#===============#載入excel檔案(目前只有單一檔案): 輸入(點選的EXCEL檔案)，輸出(計算後的濃度值)，目前暫時先停用[尚未和貝斯特討論]
def open_excel_file():
    global excel_dist
    excel_dist=[]
    data_list=[]  
    filename = filedialog.askopenfilename()
    print("檔案名稱為 "+filename)
    
    global split_filename
    split_filename=""
    #===================
    xl = pd.ExcelFile(filename)
    print(xl.sheet_names)
    
    split_filename=xl.sheet_names
    global df1
    df1 = xl.parse(split_filename[0])
    #print(df1)
    excel_dist=[tuple(x) for x in df1.values]#轉換資料為tuple形態
    
    #1212去抓出濃度的部分變成tuple(工號，濃度)
    global con_list
    con_list=[]
    
    size=len(excel_dist)
    i=0
    for i in range(size):
         if excel_dist[i][5]=="染料":
             con_list.append(excel_dist[i])
    #=========================上述過濾濃度的tuple    
    global total_list
    total_list=[]
    sum_tuple=()
    temp_con=0.0
    j=0
    for j in range(0,len(con_list)):
            temp_no=""
            temp_no=con_list[j][0]
            temp_con+=con_list[j][7]
            
            if j+1<=len(con_list)-1:
                if temp_no!=con_list[j+1][0]:
                    sum_tuple+=(temp_no,)
                    sum_tuple+=(temp_con,)
                    total_list.append(sum_tuple)
                    sum_tuple=()
                    temp_con=0.0
                else:
                    continue
            else:#去算最後一個tuple(因j+1會>len(con_list)長度
                    sum_tuple+=(temp_no,)
                    sum_tuple+=(temp_con,)
                    total_list.append(sum_tuple)
                    sum_tuple=()
                    temp_con=0.0
        
#==============算出濃度總合且組成為(工單號，濃度) tuple
#====去合併從資料庫讀出來的染色工單值與總濃度工單值: 輸入(從DB中撈出的資料list，檔案List)，輸出(合併過後總濃度List)
def merge_db_and_conf_file(_rec_db_file_list, _rec_con_list_file):
    global total_con_list
    total_con_list=[]
    size_db_list=0
    size_con_list=0
    size_db_list=len(_rec_db_file_list)
    size_con_list=len(_rec_con_list_file)
    index_db=0
    index_con=0
    temp_tuple=()
    
    for index_db in range(0, size_db_list):
        temp_db_no=""
        temp_db_no=_rec_db_file_list[index_db][0]
        temp_con=0.0
        temp_tuple+=(_rec_db_file_list[index_db][0],)
        temp_tuple+=(_rec_db_file_list[index_db][1],)
        temp_tuple+=(_rec_db_file_list[index_db][2],)
        temp_tuple+=(_rec_db_file_list[index_db][3],)
        temp_tuple+=(_rec_db_file_list[index_db][4],)
        temp_tuple+=(_rec_db_file_list[index_db][5],)
        temp_tuple+=(_rec_db_file_list[index_db][6],)
        temp_tuple+=(_rec_db_file_list[index_db][7],)
        temp_tuple+=(_rec_db_file_list[index_db][8],)
        temp_tuple+=(_rec_db_file_list[index_db][9],)
        temp_tuple+=(_rec_db_file_list[index_db][10],)
      
        for index_con in range(0, size_con_list):
            temp_con_no=""
            temp_con_no=_rec_con_list_file[index_con][0]
            if temp_db_no==temp_con_no:
                temp_con=_rec_con_list_file[index_con][1]
                break
            else:
                continue
        temp_tuple+=(temp_con,)
        total_con_list.append(temp_tuple)
        temp_tuple=()
    
    showinfo("濃度檔案合併狀態","目前已合併成功")
#=====================查詢且目前儲存資料庫參數狀態與連線測試功能: 輸入(DB資料庫參數設定)，輸出(顯示目前資料庫狀態，可依照上崙資料庫IP位置去修改，此修改後的值，會存入到DB.config檔案中)
def setup_db_params_and_testing():
    global db_object
    db_object=None
    db_object=config()#建立DB物件，取得目前DB_config.ini目前檔案值
    global pop_db_tk
    pop_db_tk = tkinter.Tk()
    pop_db_tk.title('資料庫參數')

    label_db=ttk.Label(pop_db_tk, text="資料庫參數顯示區",font="24")
    label_db.pack()

    frame1 = tkinter.Frame(pop_db_tk, width=900, height=300)
    frame1.pack()
    
    pop_server_label= ttk.Label(pop_db_tk, text="server IP")
    pop_server_label.place(x=25, y=30,width=200, height=30)
    server_input = Entry(pop_db_tk)
    server_input.place(x=175, y=30,width=200, height=30)
    
    server_input.delete(0, END)
    server_input.insert(0, db_object.get_server())#載入目前最新serveIP位置
    
    pop_dbname_label= ttk.Label(pop_db_tk, text="DB名稱")
    pop_dbname_label.place(x=25, y=70,width=200, height=30)
    dbname_input = Entry(pop_db_tk)
    dbname_input.place(x=175, y=70,width=200, height=30)
    
    dbname_input.delete(0, END)
    dbname_input.insert(0, db_object.get_dbname())#載入目前最新dbname
    
    pop_user_label= ttk.Label(pop_db_tk, text="User名稱")
    pop_user_label.place(x=25, y=110,width=200, height=30)
    user_input = Entry(pop_db_tk)
    user_input.place(x=175, y=110,width=200, height=30)
    
    user_input.delete(0, END)
    user_input.insert(0, db_object.get_user())#載入目前最新user
    
    pop_pass_label= ttk.Label(pop_db_tk, text="Password名稱")
    pop_pass_label.place(x=25, y=150,width=200, height=30)
    pass_input = Entry(pop_db_tk)
    pass_input.place(x=175, y=150,width=200, height=30)
    
    pass_input.delete(0, END)
    pass_input.insert(0, db_object.get_password())#載入目前最新password
    
    
    pop_index_label= ttk.Label(pop_db_tk, text="資料庫Index序號")
    pop_index_label.place(x=25, y=190,width=200, height=30)
    index_input = Entry(pop_db_tk)#關閉編輯功能,state='disabled'
    #index_input.config(state='disabled')
    index_input.place(x=175, y=220,width=200, height=30)
    
    index_input.delete(0, END)
    index_input.insert(0, db_object.get_dbrecordindex())#1212載入目前最新資料庫筆數index
    index_input.config(state='disabled')
    #=================按鈕區===============================
    test_btn = ttk.Button(pop_db_tk, text="測試連線",command=lambda: test_db_connection(server_input.get(),dbname_input.get(),user_input.get(),pass_input.get(),test_db_output))
    #抓取到更新值後，直接呼叫物件的modify更新程式，來進行參數更新，方便去進行資料庫帳密修改作業
    test_btn.place(x=400, y=25, width=100,height=40)
    
    test_db_output = Entry(pop_db_tk)
    test_db_output.place(x=510, y=25,width=200, height=30)
    #執行第一次
    #test_db_connection(server_input.get(),dbname_input.get(),user_input.get(),pass_input.get(),test_db_output)
    
 #抓取到更新值後，直接呼叫物件的modify更新程式，來進行參數更新，方便去進行資料庫帳密修改作業    
    save_btn = ttk.Button(pop_db_tk, text="存檔",command=lambda: db_object.modify( server_input.get(),dbname_input.get(),user_input.get(),pass_input.get()))
    save_btn.place(x=250, y=280, width=150,height=40)
    
    
    exit_btn = ttk.Button(pop_db_tk, text="離開",command=pop_db_tk.destroy)
    exit_btn.place(x=450, y=280, width=150,height=40)
    
    pop_db_tk.mainloop()
#=======================#目前用來測試資料庫連線狀態使用: 輸入(伺服器名稱IP，資料庫名稱，使用者帳號，使用者密碼，顯示位置)，輸出(資料庫是否已經連線狀態)
def test_db_connection(_rec_server, _rec_dbname, _rec_user, _rec_pass,_rec_output):
     global _db_list
     global _conn_or_not
     _db_list=[]
     
     _rec_output.delete(0, END)#清除連線顯示entry
     
     showinfo("測試DB連線中","請稍候，資料庫連線測試中....")
     #_db_list=FetchDataFromSqlDB(_rec_server, _rec_dbname, _rec_user, _rec_pass)
     _conn_or_not=TestDBconnection(_rec_server, _rec_dbname, _rec_user, _rec_pass)
    # time.sleep(10)#暫停10秒
    #len(_db_list)!=0
     if _conn_or_not==True:
         _rec_output.insert(0, "目前已連線上")
         log.info("資料庫已連線")
     else:
         _rec_output.insert(0, "未連線")
         log.info("資料庫未連線")
#---------------------------------------------------------
def shutdown_manual_schedule_btns():#關閉手動排程按鈕: 輸入()，輸出(關閉各按鈕功能)
    disable_button(cy1_sta_mod_btn)
    disable_button(cy2_sta_mod_btn)
    disable_button(cy3_sta_mod_btn)
    disable_button(cy5_sta_mod_btn)
    disable_button(cy6_sta_mod_btn)
    disable_button(cy7_sta_mod_btn)
    disable_button(cy8_sta_mod_btn)
    disable_button(cy9_sta_mod_btn)
    disable_button(cy10_sta_mod_btn)
    disable_button(cy11_sta_mod_btn)
    
    disable_button(cy12_sta_mod_btn)
    disable_button(cy13_sta_mod_btn)
    disable_button(cy14_sta_mod_btn)
    disable_button(cy15_sta_mod_btn)
    disable_button(cy16_sta_mod_btn)
    disable_button(cy17_sta_mod_btn)
    disable_button(cy18_sta_mod_btn)
    disable_button(cy19_sta_mod_btn)
    disable_button(cy20_sta_mod_btn)
    disable_button(cy21_sta_mod_btn)
    
    disable_button(cy22_sta_mod_btn)
    disable_button(cy23_sta_mod_btn)
    disable_button(cy24_sta_mod_btn)
    disable_button(cy25_sta_mod_btn)
    disable_button(cy26_sta_mod_btn)
    disable_button(cy32_sta_mod_btn)
    disable_button(cy100_sta_mod_btn)
    
    
    #0118:先關手動排缸與輸出CSV按鈕
    #0305:關閉最小清缸按鈕
    disable_button(btn4_1_auto_schedule)
    disable_button(btn4_2_hand_schedule)
    disable_button(btn4_3_bad_schedule)
    disable_button(btn5_output_csv)
#========================================
def up_manual_schedule_btns():#開啟手動排程按鈕: 輸入()，輸出(開啟各按鈕功能)
    enable_button(cy1_sta_mod_btn)
    enable_button(cy2_sta_mod_btn)
    enable_button(cy3_sta_mod_btn)
    enable_button(cy5_sta_mod_btn)
    enable_button(cy6_sta_mod_btn)
    enable_button(cy7_sta_mod_btn)
    enable_button(cy8_sta_mod_btn)
    enable_button(cy9_sta_mod_btn)
    enable_button(cy10_sta_mod_btn)
    enable_button(cy11_sta_mod_btn)
    
    enable_button(cy12_sta_mod_btn)
    enable_button(cy13_sta_mod_btn)
    enable_button(cy14_sta_mod_btn)
    enable_button(cy15_sta_mod_btn)
    enable_button(cy16_sta_mod_btn)
    enable_button(cy17_sta_mod_btn)
    enable_button(cy18_sta_mod_btn)
    enable_button(cy19_sta_mod_btn)
    enable_button(cy20_sta_mod_btn)
    enable_button(cy21_sta_mod_btn)
    
    enable_button(cy22_sta_mod_btn)
    enable_button(cy23_sta_mod_btn)
    enable_button(cy24_sta_mod_btn)
    enable_button(cy25_sta_mod_btn)
    enable_button(cy26_sta_mod_btn)
    enable_button(cy32_sta_mod_btn)
    enable_button(cy100_sta_mod_btn)
#=======================================
def exeute_manual_schedule_task():#點選手動排程: 輸入()，輸出(關閉各按鈕功能與開啟手動排程)
   disable_button(btn1_read_file)#關閉相關載入與自動排程按鈕
   #disable_button(btn2_choose_file)#關閉相關載入與自動排程按鈕
   #disable_button(btn3_load_param)#關閉相關載入與自動排程按鈕
   disable_button(btn4_1_auto_schedule)#關閉相關載入與自動排程按鈕
   disable_button(btn_db_connection)#關閉相關載入與自動排程按鈕
   up_manual_schedule_btns()#開啟相關手動排程按鈕
#==========去切換各個按鈕(依序去執行相關程式流程)
def Switch_buttons(_from_btn, _to_btn):#: 輸入(來源按鈕，目的按鈕)，輸出(切換按鈕功能)
    disable_button(_from_btn)
    enable_button(_to_btn)
#1222:重新載入排程程式
def restart_scheduler():#: 輸入()，輸出(重新啟動程式)
    tk.destroy()
    scheduler_to_dyeing()
def logginf_restart(_log):#: 輸入(_log物件)，輸出(紀錄排程程式log)
    _log.info("排程程式重新啟動")

#20180626   更新主頁面各缸工單數量
def refresh_mainpage():
    pop_tk.destroy()

    cy1_lb1 = ttk.Label(frame, text='1號缸' + '             共' + str(len(processing_cylinder_list[0].get_cylinder_con_list())) + '筆', background='yellow')
    cy1_lb1.place(x=5, y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy2_lb1 = ttk.Label(frame, text='2號缸' + '             共' + str(len(processing_cylinder_list[1].get_cylinder_con_list())) + '筆', background='yellow')
    cy2_lb1.place(x=int(325 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy3_lb1 = ttk.Label(frame, text='3號缸' + '             共' + str(len(processing_cylinder_list[2].get_cylinder_con_list())) + '筆', background='yellow')
    cy3_lb1.place(x=int(645 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy5_lb1 = ttk.Label(frame, text='5號缸' + '             共' + str(len(processing_cylinder_list[3].get_cylinder_con_list())) + '筆', background='yellow')
    cy5_lb1.place(x=int(965 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy6_lb1 = ttk.Label(frame, text='6號缸' + '             共' + str(len(processing_cylinder_list[4].get_cylinder_con_list())) + '筆', background='yellow')
    cy6_lb1.place(x=int(1285 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy7_lb1 = ttk.Label(frame, text='7號缸(黑)' + '      共' + str(len(processing_cylinder_list[5].get_cylinder_con_list())) + '筆', background='yellow')
    cy7_lb1.place(x=int(1605 * w1), y=int(290 * h1), width=int(150 * w1), height=int(40 * h1))

    cy8_lb1 = ttk.Label(frame, text='8號缸' + '             共' + str(len(processing_cylinder_list[6].get_cylinder_con_list())) + '筆', background='yellow')
    cy8_lb1.place(x=5, y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy9_lb1 = ttk.Label(frame, text='9號缸(白)' + '      共' + str(len(processing_cylinder_list[7].get_cylinder_con_list())) + '筆', background='yellow')
    cy9_lb1.place(x=int(325 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy10_lb1 = ttk.Label(frame, text='10號缸(黑)' + '    共' + str(len(processing_cylinder_list[8].get_cylinder_con_list())) + '筆', background='yellow')
    cy10_lb1.place(x=int(645 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy11_lb1 = ttk.Label(frame, text='11號缸' + '           共' + str(len(processing_cylinder_list[9].get_cylinder_con_list())) + '筆', background='yellow')
    cy11_lb1.place(x=int(965 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy12_lb1 = ttk.Label(frame, text='12號缸' + '           共' + str(len(processing_cylinder_list[10].get_cylinder_con_list())) + '筆', background='yellow')
    cy12_lb1.place(x=int(1285 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy13_lb1 = ttk.Label(frame, text='13號缸(白)' + '    共' + str(len(processing_cylinder_list[11].get_cylinder_con_list())) + '筆', background='yellow')
    cy13_lb1.place(x=int(1605 * w1), y=int(455 * h1), width=int(150 * w1), height=int(40 * h1))

    cy14_lb1 = ttk.Label(frame, text='14號缸' + '           共' + str(len(processing_cylinder_list[12].get_cylinder_con_list())) + '筆', background='yellow')
    cy14_lb1.place(x=5, y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy15_lb1 = ttk.Label(frame, text='15號缸' + '           共' + str(len(processing_cylinder_list[13].get_cylinder_con_list())) + '筆', background='yellow')
    cy15_lb1.place(x=int(325 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy16_lb1 = ttk.Label(frame, text='16號缸' + '           共' + str(len(processing_cylinder_list[14].get_cylinder_con_list())) + '筆', background='yellow')
    cy16_lb1.place(x=int(645 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy17_lb1 = ttk.Label(frame, text='17號缸' + '           共' + str(len(processing_cylinder_list[15].get_cylinder_con_list())) + '筆', background='yellow')
    cy17_lb1.place(x=int(965 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy18_lb1 = ttk.Label(frame, text='18號缸' + '           共' + str(len(processing_cylinder_list[16].get_cylinder_con_list())) + '筆', background='yellow')
    cy18_lb1.place(x=int(1285 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy19_lb1 = ttk.Label(frame, text='19號缸(黑)' + '    共' + str(len(processing_cylinder_list[17].get_cylinder_con_list())) + '筆', background='yellow')
    cy19_lb1.place(x=int(1605 * w1), y=int(620 * h1), width=int(150 * w1), height=int(40 * h1))

    cy20_lb1 = ttk.Label(frame, text='20號缸' + '           共' + str(len(processing_cylinder_list[18].get_cylinder_con_list())) + '筆', background='yellow')
    cy20_lb1.place(x=5, y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy21_lb1 = ttk.Label(frame, text='21號缸' + '           共' + str(len(processing_cylinder_list[19].get_cylinder_con_list())) + '筆', background='yellow')
    cy21_lb1.place(x=int(325 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy22_lb1 = ttk.Label(frame, text='22號缸' + '           共' + str(len(processing_cylinder_list[20].get_cylinder_con_list())) + '筆', background='yellow')
    cy22_lb1.place(x=int(645 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy23_lb1 = ttk.Label(frame, text='23號缸' + '           共' + str(len(processing_cylinder_list[21].get_cylinder_con_list())) + '筆', background='yellow')
    cy23_lb1.place(x=int(965 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy24_lb1 = ttk.Label(frame, text='24號缸' + '           共' + str(len(processing_cylinder_list[22].get_cylinder_con_list())) + '筆', background='yellow')
    cy24_lb1.place(x=int(1285 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy25_lb1 = ttk.Label(frame, text='25號缸' + '           共' + str(len(processing_cylinder_list[23].get_cylinder_con_list())) + '筆', background='yellow')
    cy25_lb1.place(x=int(1605 * w1), y=int(790 * h1), width=int(150 * w1), height=int(40 * h1))

    cy26_lb1 = ttk.Label(frame, text='26號缸' + '           共' + str(len(processing_cylinder_list[24].get_cylinder_con_list())) + '筆', background='yellow')
    cy26_lb1.place(x=int(1605 * w1), y=0, width=int(150 * w1), height=int(40 * h1))

    cy32_lb1 = ttk.Label(frame, text='32號缸' + '           共' + str(len(processing_cylinder_list[25].get_cylinder_con_list())) + '筆', background='yellow')
    cy32_lb1.place(x=int(1605 * w1), y=int(130 * h1), width=int(150 * w1), height=int(40 * h1))

    #cy100_lb1 = ttk.Label(frame, text='暫時區(100)' + '       共' + str(len(recyce_list)) + '筆', background='yellow')
    #20180717   暫時區背景修改成紅色
    cy100_lb1 = ttk.Label(frame, text='暫時區(100)' + '       共' + str(len(processing_cylinder_list[26].get_cylinder_con_list())) + '筆', background='red')
    cy100_lb1.place(x=int(1415 * w1), y=int(115 * h1), width=int(180 * w1), height=int(40 * h1))

#=========================以下為主程式與介面設定==========
#-=========================frame設定區域=================
#=====0118:主程式區域，目前寫成副函式，以後可以變成副含式呼叫此主函式
def scheduler_to_dyeing():##: 輸入()，輸出(啟動主程式，目前包成副函式，以後可在其他物件中，呼叫此副函式，減少物件的浪費)
    global cy_category_list#0115:去根據缸容與碼長分類
    cy_category_list=[(20,80),(100,500),(150,500),(200,500),(300,1600),(500,3200),(1000,6400)]

    global cy_group_list#0115:目前相同碼長與缸容的分類
    cy_group_list=[(2,16,17,18),(14,32),(3,8,25),(24,),(20,21,22,23),(5,6,11,12,15,26,13,1,19,10),(9,7)]
    
    global cy_ptr_list#0115:去記錄相關目前排到缸的ptr(紀錄目前排到的cy_group_list中的index為何)
    cy_ptr_list=[0,0,0,0,0,0,0]
    
    global recyce_list#0118:為回收工單list，回收沒有排入的工單號碼與濃度值
    recyce_list=[]

    global tk
    tk = tkinter.Tk()
    '''
    tk.title('染色排缸')
    label=ttk.Label(tk, text="工單顯示區",font="20")
    label.pack()
    
    print("目前解析度為: "+str(tk.winfo_screenwidth()),str(tk.winfo_screenheight()))
    '''
    global frame
    frame = tkinter.Frame(tk, width=tk.winfo_screenwidth(), height=tk.winfo_screenheight())
    #frame.pack()

    #-[工單號,訂單號,投胚量,碼重, 色號,碼長(投胚量/碼重),領料量,濃度(領料量/投胚量*100%), 投胚日, 總濃度]-
    #1214 新增配方表總濃度欄位
    global db_file_object
    global server_name
    global db_name
    global user
    global password
    db_file_object=None
    db_file_object=config()#建立DB物件，取得目前DB_config.ini目前檔案值
    server_name=""
    db_name=""
    user=""
    password=""
    dbindex=""
    server_name=db_file_object.get_server()
    db_name=db_file_object.get_dbname()
    user=db_file_object.get_user()
    password=db_file_object.get_password()
    #1221:新增dbindex，紀錄目前讀到第幾筆資料
    dbindex=db_file_object.get_dbrecordindex()
    global dist#資料撈取集合
    global dist1  #20181206 前一缸資料撈取集合
    dist=[]
    dist1 = []
    #0105: 重新抓取DB資料庫值
    #這邊會去更新目前的dbindex為何，每次都會讀取30筆資料去進行排缸，避免排缸過程delay。
    dist=fetch_dyeing_data_with_Totolcon(server_name,db_name,user, password,dbindex,db_file_object)
    dist1=fetch_dyeing_data_with_Totalcon_BF3D(server_name, db_name, user, password, dbindex, db_file_object)
    print('待排缸資料共抓入%s筆' %str(len(dist)) )
    # 20181226   刪除schedule_before資料
    cnxn5 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
    cursor5 = cnxn5.cursor()  # server 位置: 172.16.41.23
    cursor5.execute("delete from schedule_before")
    cnxn5.commit()

    # 20181224   判斷是否有前缸資料
    if dist1 is None:
        print('沒有歷史前缸資料')
    else:
        print('歷史前缸資料共抓入%s筆' % str(len(dist1)))
        # 20181226   新增schedule_before資料
        dist1_size = len(dist1)
        j = 0
        for j in range(dist1_size):
            cnxn6 = pyodbc.connect('DRIVER={SQL Server};SERVER=' + server_name + ';DATABASE=' + db_name + ';UID=' + user + ';PWD=' + password)
            cursor6 = cnxn6.cursor()  # server 位置: 172.16.41.23
            #20181226   改insert 9個欄位
            cursor6.execute("insert into schedule_before(cist_no,od_no,clr_id,emb_qty,yard,total_con,max_con,dypd_id,mach_id) values (?,?,?,?,?,?,?,?,?)",dist1[j][0], dist1[j][1], dist1[j][2], dist1[j][3], dist1[j][4],dist1[j][8],dist1[j][9], dist1[j][10], dist1[j][11])
            cnxn6.commit()

    #=====================原始資料區域(未排序)
    global tree1
    tree1 = ttk.Treeview(tk)
    #tree1['show'] = 'headings'#去除第一行空白
    # 20180314   依比例縮放[1920*1080]
    # 20180417 調整工單顯示欄位及大小
    global w1
    global h1
    w1 = 0
    h1 = 0
    w1 = tk.winfo_screenwidth() / 1920
    h1 = tk.winfo_screenheight() / 1080
    tree1.column("#0", width=int(40 * w1))
    #20181206   新增max_con, dypd_id
    tree1["columns"] = ("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11")
    tree1.column("1", width=int(105 * w1), anchor='w')
    tree1.column("2", width=int(115 * w1))
    tree1.column("3", width=int(105 * w1))
    tree1.column("4", width=int(60 * w1))
    tree1.column("5", width=int(70 * w1))
    tree1.column("6", width=int(145 * w1), anchor='w')
    tree1.column("7", width=int(145 * w1), anchor='w')
    tree1.column("8", width=int(145 * w1), anchor='w')
    tree1.column("9", width=int(60 * w1))
    tree1.column("10", width=int(60 * w1))
    tree1.column("11", width=int(60 * w1))
    # ==================================
    tree1.heading("1", text="工單號")
    tree1.heading("2", text="訂單號碼")
    tree1.heading("3", text="色號")
    tree1.heading("4", text="投胚量")
    tree1.heading("5", text="碼長")
    tree1.heading("6", text="開卡時間")
    tree1.heading("7", text="分派時間")
    tree1.heading("8", text="交期")
    tree1.heading("9", text="總濃度")
    tree1.heading("10", text="最大濃度")
    tree1.heading("11", text="配方號")
    tree1.place(x=int(180*w1), y=int(30*h1),width=int(1230*w1), height=int(140*h1))
    #=======================排序完後顯示區
    global tree2
    tree2 = ttk.Treeview(tk)
    # tree2['show'] = 'headings'#去除第一行空白
    # 20180314   依比例縮放[1920*1080]
    # 20180417 調整工單顯示欄位及大小
    tree2.column("#0", width=int(40 * w1))
    vsb = ttk.Scrollbar(orient="vertical", command=tree2.yview)
    tree2.configure(yscrollcommand=vsb.set)
    # 20181206   新增max_con, dypd_id
    tree2["columns"] = ("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11")
    tree2.column("1", width=int(105 * w1), anchor='w')
    tree2.column("2", width=int(115 * w1))
    tree2.column("3", width=int(105 * w1))
    tree2.column("4", width=int(60 * w1))
    tree2.column("5", width=int(70 * w1))
    tree2.column("6", width=int(145 * w1), anchor='w')
    tree2.column("7", width=int(145 * w1), anchor='w')
    tree2.column("8", width=int(145 * w1), anchor='w')
    tree2.column("9", width=int(60 * w1))
    tree2.column("10", width=int(60 * w1))
    tree2.column("11", width=int(60 * w1))
    # ==================================
    tree2.heading("1", text="工單號")
    tree2.heading("2", text="訂單號碼")
    tree2.heading("3", text="色號")
    tree2.heading("4", text="投胚量")
    tree2.heading("5", text="碼長")
    tree2.heading("6", text="開卡時間")
    tree2.heading("7", text="分派時間")
    tree2.heading("8", text="交期")
    tree2.heading("9", text="總濃度")
    tree2.heading("10", text="最大濃度")
    tree2.heading("11", text="配方號")
    tree2.place(x=int(180*w1), y=int(175*h1),width=int(1230*w1), height=int(140*h1))
    #==================================================
    '''
    global btn1_read_file
    global btn2_choose_file
    global btn2_merge_file
    global btn3_load_param
    
    
    global btn4_1_auto_schedule
    global btn4_2_hand_schedule
    global btn4_3_bad_schedule
    '''
    global btn_db_connection
    #global btn_clean
    global btn5_output_csv
    
    #20180717   改自動執行讀入測試檔案
    '''
    btn1_read_file = ttk.Button(frame, text="#讀入測試檔案", command=lambda : [readfile_to_tree(dist,tree1),Switch_buttons(btn1_read_file, btn4_1_auto_schedule)])
    btn1_read_file.place(x=5, y=0, width=int(170*w1), height=int(40*h1))

    
    #btn2_choose_file = ttk.Button(frame, text="2.選檔",command=lambda :open_excel_file())
    #btn2_choose_file.place(x=5, y=45, width=75,height=40)
    
    #btn2_merge_file = ttk.Button(frame, text="2.合併", command=lambda :merge_db_and_conf_file(_to_jobtask_list, total_list))
    # btn2_merge_file.place(x=80, y=45, width=75,height=40)
    #disable_button(btn2_choose_file)#1204暫時關閉選擇檔案功能(目前測試OK)
    
    #btn3_load_param = ttk.Button(frame, text="3. 載入參數",command=lambda: setup_cylinder_params(text4))
    #btn3_load_param.place(x=5, y=90, width=150,height=40)
    
    
    #1110 此部分已經改為利用button4點一下執行排序跟排缸動作

    btn4_1_auto_schedule = ttk.Button(frame, text="#自動排缸", command=lambda: [compare(jobtask_list, tree2), ProcessSchedulingOnCylinders(cylinder_list, jobtask_list1),Switch_buttons(btn4_1_auto_schedule,btn4_2_hand_schedule)])
    btn4_1_auto_schedule.place(x=5, y=int(50*h1), width=int(170*w1),height=int(40*h1))

    #1214原為jobtask_list, 後改total_con_list
    #0105改為jobtask_list
    
    
    
    #1110 此部分已經改為利用button4點一下執行排序跟排缸動作
    # btn4_1_1_loadbalance_schedule = ttk.Button(frame, text="排缸平衡", command=lambda: load_schedule_balance(cy_ptr_list, cylinder_list,jobtask_list))
    # btn4_1_1_loadbalance_schedule.place(x=95, y=135, width=75,height=40)
    #1214原為_to_jobtask_list,後來為total_con_list
    #0105 改為 _to_jobtask_list

    btn4_2_hand_schedule = ttk.Button(frame, text="開啟手排",command=lambda:  [exeute_manual_schedule_task(),Switch_buttons(btn4_2_hand_schedule,btn5_output_csv)])
    btn4_2_hand_schedule .place(x=int(95*w1), y=int(90*h1), width=int(85*w1),height=int(40*h1))

   
   #start_to_schedule_clear_cylinder_jobtask(_pro_joblist,_cy_ptr_list, _cy_group_list)
 
    btn4_3_bad_schedule = ttk.Button(frame, text="最小清缸",command=lambda:  [groupList_to_clear_cylinder_jobtask(processing_cylinder_list,cy_ptr_list, cy_group_list),Switch_buttons(btn4_3_bad_schedule,btn4_2_hand_schedule)])
    btn4_3_bad_schedule .place(x=5, y=int(90*h1), width=int(85*w1),height=int(40*h1))
    '''
   
   
   
    btn5_output_csv = ttk.Button(frame, text="#輸出排程CSV",command=lambda: [outputCsv(processing_cylinder_list, btn5_output_csv, _to_jobtask_list)])
    '''
   # btn5_output_csv.place(x=1410, y=0, width=150,height=40)
   #0118:原來為右手邊位置，後來至換至左手邊
    btn5_output_csv.place(x=5, y=int(140*h1), width=int(170*w1),height=int(40*h1))
    
    '''
    btn_db_connection = ttk.Button(frame,  text="@設定DB", command=lambda: setup_db_params_and_testing())
    '''
    btn_db_connection.place(x=5, y=int(190*h1), width=int(170*w1),height=int(40*h1))
    #button7.configure(bg = "red")
    
    #1222:新增重新啟動按鈕
    btn_clean = ttk.Button(frame,  text="重啟!!", command=lambda: [logginf_restart(log), restart_scheduler()])
    btn_clean.place(x=5, y=int(240*h1), width=int(170*w1),height=int(40*h1))
    #button7.configure(bg = "red")
    '''
    
    
    #------------------工單變數宣告區---------------
    global cy1_status
    global cy2_status
    global cy3_status
    global cy5_status
    global cy6_status
    global cy7_status
    global cy8_status
    global cy9_status
    global cy10_status
    global cy11_status
    
    global cy12_status
    global cy13_status
    global cy14_status
    global cy15_status
    global cy16_status
    global cy17_status
    global cy18_status
    global cy19_status
    global cy20_status
    global cy21_status
    
    global cy22_status
    global cy23_status
    global cy24_status
    global cy25_status
    global cy26_status
    global cy32_status
    
    global listbox_temp
    global text4
    

    global cy1_schedule
    global cy2_schedule
    global cy3_schedule
    global cy5_schedule
    global cy6_schedule
    global cy7_schedule
    global cy8_schedule
    global cy9_schedule
    global cy10_schedule
    global cy11_schedule
    global cy12_schedule
    global cy13_schedule
    
    global cy14_schedule
    global cy15_schedule
    global cy16_schedule
    global cy17_schedule
    global cy18_schedule
    global cy19_schedule
    global cy20_schedule
    global cy21_schedule
    global cy22_schedule
    global cy23_schedule
    global cy24_schedule
    global cy25_schedule
    global cy26_schedule
    global cy32_schedule

    global cy1_lb1
    global cy2_lb1
    global cy3_lb1
    global cy5_lb1
    global cy6_lb1
    global cy7_lb1
    global cy8_lb1
    global cy9_lb1
    global cy10_lb1
    global cy11_lb1
    global cy12_lb1
    global cy13_lb1
    global cy14_lb1
    global cy15_lb1
    global cy16_lb1
    global cy17_lb1
    global cy18_lb1
    global cy19_lb1
    global cy20_lb1
    global cy21_lb1
    global cy22_lb1
    global cy23_lb1
    global cy24_lb1
    global cy25_lb1
    global cy26_lb1
    global cy32_lb1
    global cy100_lb1
    
    #-----------------------染缸UI區-1號缸---------------
    cy1_lb1=ttk.Label(frame,text='1號缸', background='yellow')
    #cy1_lb1.place(x=5, y=int(290*h1), width=int(150*w1),height=int(40*h1))

    cy1_status=Listbox(tk)
    '''
    cy1_status.place(x=5, y=int(350*h1), width=int(150*w1),height=int(100*h1))

    cy1_lb2=ttk.Label(frame,text='1號缸排程區', background='orange')
    cy1_lb2.place(x=int(160*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy1_schedule=Listbox(tk)
    '''
    cy1_schedule.place(x=int(160*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))

    #1215 added
    
    global cy1_sta_mod_btn

    #20180625   更改Popup[手動排單]內的資料為processing_cylinder_list1
    cy1_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy1_schedule, "1",processing_cylinder_list1,temp_cylinder1))
    cy1_sta_mod_btn.place(x=int(190*w1), y=int(420*h1), width=int(100*w1),height=int(30*h1))
    '''
    #--------------------------2號缸------------------------------
    cy2_lb1=ttk.Label(frame,text='2號缸', background='yellow')
    #cy2_lb1.place(x=int(325*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))

    cy2_status=Listbox(tk)
    '''
    cy2_status.place(x=int(325*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    cy2_lb2=ttk.Label(frame,text='2號缸排程區', background='orange')
    cy2_lb2.place(x=int(480*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy2_schedule=Listbox(tk)
    '''
    cy2_schedule.place(x=int(480*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    #1215 added 
    global cy2_sta_mod_btn
    
    
    cy2_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy2_schedule, "2",processing_cylinder_list1,temp_cylinder2))
    cy2_sta_mod_btn.place(x=int(510*w1), y=int(420*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------3號缸----------------------
    cy3_lb1=ttk.Label(frame,text='3號缸', background='yellow')
    #cy3_lb1.place(x=int(645*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    
    cy3_status=Listbox(tk)
    '''
    cy3_status.place(x=int(645*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    cy3_lb2=ttk.Label(frame,text='3號缸排程區', background='orange')
    cy3_lb2.place(x=int(800*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy3_schedule=Listbox(tk)
    '''
    cy3_schedule.place(x=int(800*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    #1215 added 
    global cy3_sta_mod_btn
    
    
    cy3_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy3_schedule, "3",processing_cylinder_list1,temp_cylinder3))
    cy3_sta_mod_btn.place(x=int(830*w1), y=int(420*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------5號缸-------------------------
    cy5_lb1=ttk.Label(frame,text='5號缸', background='yellow')
    #cy5_lb1.place(x=int(965*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    
    cy5_status=Listbox(tk)
    '''
    cy5_status.place(x=int(965*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    cy5_lb2=ttk.Label(frame,text='5號缸排程區', background='orange')
    cy5_lb2.place(x=int(1120*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy5_schedule=Listbox(tk)
    '''
    cy5_schedule.place(x=int(1120*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy5_sta_mod_btn
    
    cy5_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy5_schedule, "5",processing_cylinder_list1,temp_cylinder5))
    cy5_sta_mod_btn.place(x=int(1150*w1), y=int(420*h1), width=int(100*w1),height=int(30*h1))
    '''
    #------------------------7號缸-----------------------------------
    cy6_lb1=ttk.Label(frame,text='6號缸', background='yellow')
    #cy6_lb1.place(x=int(1285*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    
    cy6_status=Listbox(tk)
    '''
    cy6_status.place(x=int(1285*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    cy6_lb2=ttk.Label(frame,text='6號缸排程區', background='orange')
    cy6_lb2.place(x=int(1440*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy6_schedule=Listbox(tk)
    '''
    cy6_schedule.place(x=int(1440*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy6_sta_mod_btn
    
    cy6_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy6_schedule, "6",processing_cylinder_list1,temp_cylinder6))
    cy6_sta_mod_btn.place(x=int(1470*w1), y=int(420*h1), width=int(100*w1),height=int(30*h1))
    '''
    #-------------------7號缸-----------------------------------
    cy7_lb1=ttk.Label(frame,text='7號缸(黑)', background='yellow')
    #cy7_lb1.place(x=int(1605*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    
    cy7_status=Listbox(tk)
    '''
    cy7_status.place(x=int(1605*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
    cy7_lb2=ttk.Label(frame,text='7號缸排程區', background='orange')
    cy7_lb2.place(x=int(1760*w1), y=int(290*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy7_schedule=Listbox(tk)
    '''
    cy7_schedule.place(x=int(1760*w1), y=int(350*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy7_sta_mod_btn
    
    cy7_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy7_schedule, "7",processing_cylinder_list1,temp_cylinder7))
    cy7_sta_mod_btn.place(x=int(1790*w1), y=int(420*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------8號缸--第二列-----------------------
    cy8_lb1=ttk.Label(frame,text='8號缸', background='yellow')
    #cy8_lb1.place(x=5, y=int(455*h1), width=int(150*w1),height=int(40*h1))
    
    cy8_status=Listbox(tk)
    '''
    cy8_status.place(x=5, y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    cy8_lb2=ttk.Label(frame,text='8號缸排程區', background='orange')
    cy8_lb2.place(x=int(160*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy8_schedule=Listbox(tk)
    '''
    cy8_schedule.place(x=int(160*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy8_sta_mod_btn
    
    cy8_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy8_schedule, "8",processing_cylinder_list1,temp_cylinder8))
    cy8_sta_mod_btn.place(x=int(190*w1), y=int(585*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------9號缸-------------------------
    cy9_lb1=ttk.Label(frame,text='9號缸(白)', background='yellow')
    #cy9_lb1.place(x=int(325*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    
    cy9_status=Listbox(tk)
    '''
    cy9_status.place(x=int(325*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    cy9_lb2=ttk.Label(frame,text='9號缸排程區', background='orange')
    cy9_lb2.place(x=int(480*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy9_schedule=Listbox(tk)
    '''
    cy9_schedule.place(x=int(480*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy9_sta_mod_btn
    
    cy9_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy9_schedule, "9",processing_cylinder_list1,temp_cylinder9))
    cy9_sta_mod_btn.place(x=int(510*w1), y=int(585*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------10號缸-------------------------
    cy10_lb1=ttk.Label(frame,text='10號缸(黑)', background='yellow')
    #cy10_lb1.place(x=int(645*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    
    cy10_status=Listbox(tk)
    '''
    cy10_status.place(x=int(645*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    cy10_lb2=ttk.Label(frame,text='10號缸排程區', background='orange')
    cy10_lb2.place(x=int(800*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy10_schedule=Listbox(tk)
    '''
    cy10_schedule.place(x=int(800*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy10_sta_mod_btn
    
    cy10_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy10_schedule, "10",processing_cylinder_list1,temp_cylinder10))
    cy10_sta_mod_btn.place(x=int(830*w1), y=int(585*h1), width=int(100*w1),height=int(30*h1))
    '''
    #----------------------------11號缸---------------------
    cy11_lb1=ttk.Label(frame,text='11號缸', background='yellow')
    #cy11_lb1.place(x=int(965*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    
    cy11_status=Listbox(tk)
    '''
    cy11_status.place(x=int(965*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    cy11_lb2=ttk.Label(frame,text='11號缸排程區', background='orange')
    cy11_lb2.place(x=int(1120*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy11_schedule=Listbox(tk)
    '''
    cy11_schedule.place(x=int(1120*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy11_sta_mod_btn
    
    cy11_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy11_schedule, "11",processing_cylinder_list1,temp_cylinder11))
    cy11_sta_mod_btn.place(x=int(1150*w1), y=int(585*h1), width=int(100*w1),height=int(30*h1))
    '''
    #----------------------------12號缸---------------------
    cy12_lb1=ttk.Label(frame,text='12號缸', background='yellow')
    #cy12_lb1.place(x=int(1285*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    
    cy12_status=Listbox(tk)
    '''
    cy12_status.place(x=int(1285*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    cy12_lb2=ttk.Label(frame,text='12號缸排程區', background='orange')
    cy12_lb2.place(x=int(1440*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy12_schedule=Listbox(tk)
    '''
    cy12_schedule.place(x=int(1440*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
     
    global cy12_sta_mod_btn
    
    cy12_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy12_schedule, "12",processing_cylinder_list1,temp_cylinder12))
    cy12_sta_mod_btn.place(x=int(1470*w1), y=int(585*h1), width=int(100*w1),height=int(30*h1))
    '''
    #----------------------------13號缸---------------------
    cy13_lb1=ttk.Label(frame,text='13號缸(白)', background='yellow')
    #cy13_lb1.place(x=int(1605*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    
    cy13_status=Listbox(tk)
    '''
    cy13_status.place(x=int(1605*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
    cy13_lb2=ttk.Label(frame,text='13號缸排程區', background='orange')
    cy13_lb2.place(x=int(1760*w1), y=int(455*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy13_schedule=Listbox(tk)
    '''
    cy13_schedule.place(x=int(1760*w1), y=int(515*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy13_sta_mod_btn
    
    cy13_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy13_schedule, "13",processing_cylinder_list1,temp_cylinder13))
    cy13_sta_mod_btn.place(x=int(1790*w1), y=int(585*h1), width=int(100*w1),height=int(30*h1))
    '''
    #-------------------14號缸--第三列-----------------------
    cy14_lb1=ttk.Label(frame,text='14號缸', background='yellow')
    #cy14_lb1.place(x=5, y=int(620*h1), width=int(150*w1),height=int(40*h1))
    
    cy14_status=Listbox(tk)
    '''
    cy14_status.place(x=5, y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    cy14_lb2=ttk.Label(frame,text='14號缸排程區', background='orange')
    cy14_lb2.place(x=int(160*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy14_schedule=Listbox(tk)
    '''
    cy14_schedule.place(x=int(160*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy14_sta_mod_btn
    
    cy14_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy14_schedule, "14",processing_cylinder_list1,temp_cylinder14))
    cy14_sta_mod_btn.place(x=int(190*w1), y=int(755*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------15號缸-------------------------
    cy15_lb1=ttk.Label(frame,text='15號缸', background='yellow')
    #cy15_lb1.place(x=int(325*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    
    cy15_status=Listbox(tk)
    '''
    cy15_status.place(x=int(325*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    cy15_lb2=ttk.Label(frame,text='15號缸排程區', background='orange')
    cy15_lb2.place(x=int(480*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy15_schedule=Listbox(tk)
    '''
    cy15_schedule.place(x=int(480*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    
    global cy15_sta_mod_btn
    
    cy15_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy15_schedule, "15",processing_cylinder_list1,temp_cylinder15))
    cy15_sta_mod_btn.place(x=int(510*w1), y=int(755*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------16號缸-------------------------
    cy16_lb1=ttk.Label(frame,text='16號缸', background='yellow')
    #cy16_lb1.place(x=int(645*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    
    cy16_status=Listbox(tk)
    '''
    cy16_status.place(x=int(645*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    cy16_lb2=ttk.Label(frame,text='16號缸排程區', background='orange')
    cy16_lb2.place(x=int(800*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy16_schedule=Listbox(tk)
    '''
    cy16_schedule.place(x=int(800*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    
   
    global cy16_sta_mod_btn
    cy16_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy16_schedule, "16",processing_cylinder_list1,temp_cylinder16))
    cy16_sta_mod_btn.place(x=int(830*w1), y=int(755*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------17號缸-------------------------
    cy17_lb1=ttk.Label(frame,text='17號缸', background='yellow')
    #cy17_lb1.place(x=int(965*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    
    cy17_status=Listbox(tk)
    '''
    cy17_status.place(x=int(965*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    cy17_lb2=ttk.Label(frame,text='17號缸排程區', background='orange')
    cy17_lb2.place(x=int(1120*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy17_schedule=Listbox(tk)
    '''
    cy17_schedule.place(x=int(1120*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy17_sta_mod_btn
    
    cy17_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy17_schedule, "17",processing_cylinder_list1,temp_cylinder17))
    cy17_sta_mod_btn.place(x=int(1150*w1), y=int(755*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------18號缸-------------------------
    cy18_lb1=ttk.Label(frame,text='18號缸', background='yellow')
    #cy18_lb1.place(x=int(1285*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    
    cy18_status=Listbox(tk)
    '''
    cy18_status.place(x=int(1285*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    cy18_lb2=ttk.Label(frame,text='18號缸排程區', background='orange')
    cy18_lb2.place(x=int(1440*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy18_schedule=Listbox(tk)
    '''
    cy18_schedule.place(x=int(1440*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy18_sta_mod_btn
    
    cy18_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy18_schedule, "18",processing_cylinder_list1,temp_cylinder18))
    cy18_sta_mod_btn.place(x=int(1470*w1), y=int(755*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------19號缸-------------------------
    cy19_lb1=ttk.Label(frame,text='19號缸(黑)', background='yellow')
    #cy19_lb1.place(x=int(1605*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    
    cy19_status=Listbox(tk)
    '''
    cy19_status.place(x=int(1605*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
    cy19_lb2=ttk.Label(frame,text='19號缸排程區', background='orange')
    cy19_lb2.place(x=int(1760*w1), y=int(620*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy19_schedule=Listbox(tk)
    '''
    cy19_schedule.place(x=int(1760*w1), y=int(680*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy19_sta_mod_btn
    
    cy19_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy19_schedule, "19",processing_cylinder_list1,temp_cylinder19))
    cy19_sta_mod_btn.place(x=int(1790*w1), y=int(755*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------20號缸--第4列-----------------------
    cy20_lb1=ttk.Label(frame,text='20號缸', background='yellow')
    #cy20_lb1.place(x=5, y=int(790*h1), width=int(150*w1),height=int(40*h1))
    
    cy20_status=Listbox(tk)
    '''
    cy20_status.place(x=5, y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
    cy20_lb2=ttk.Label(frame,text='20號缸排程區', background='orange')
    cy20_lb2.place(x=int(160*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy20_schedule=Listbox(tk)
    '''
    cy20_schedule.place(x=int(160*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
  
    global cy20_sta_mod_btn
    
    cy20_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy20_schedule, "20",processing_cylinder_list1,temp_cylinder20))
    cy20_sta_mod_btn.place(x=int(190*w1), y=int(925*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------21號缸------------------------
    cy21_lb1=ttk.Label(frame,text='21號缸', background='yellow')
    #cy21_lb1.place(x=int(325*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    
    cy21_status=Listbox(tk)
    '''
    cy21_status.place(x=int(325*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
    cy21_lb2=ttk.Label(frame,text='21號缸排程區', background='orange')
    cy21_lb2.place(x=int(480*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy21_schedule=Listbox(tk)
    '''
    cy21_schedule.place(x=int(480*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy21_sta_mod_btn
    
    cy21_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy21_schedule, "21",processing_cylinder_list1,temp_cylinder21))
    cy21_sta_mod_btn.place(x=int(510*w1), y=int(925*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------22號缸------------------------
    cy22_lb1=ttk.Label(frame,text='22號缸', background='yellow')
    #cy22_lb1.place(x=int(645*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    
    cy22_status=Listbox(tk)
    '''
    cy22_status.place(x=int(645*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
    cy22_lb2=ttk.Label(frame,text='22號缸排程區', background='orange')
    cy22_lb2.place(x=int(800*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy22_schedule=Listbox(tk)
    '''
    cy22_schedule.place(x=int(800*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
 
    global cy22_sta_mod_btn
    
    cy22_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy22_schedule, "22",processing_cylinder_list1,temp_cylinder22))
    cy22_sta_mod_btn.place(x=int(830*w1), y=int(925*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------23號缸------------------------
    cy23_lb1=ttk.Label(frame,text='23號缸', background='yellow')
    #cy23_lb1.place(x=int(965*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    
    cy23_status=Listbox(tk)
    '''
    cy23_status.place(x=int(965*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
    cy23_lb2=ttk.Label(frame,text='23號缸排程區', background='orange')
    cy23_lb2.place(x=int(1120*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy23_schedule=Listbox(tk)
    '''
    cy23_schedule.place(x=int(1120*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
  
    global cy23_sta_mod_btn
    
    cy23_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy23_schedule, "23",processing_cylinder_list1,temp_cylinder23))
    cy23_sta_mod_btn.place(x=int(1150*w1), y=int(925*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------24號缸------------------------
    cy24_lb1=ttk.Label(frame,text='24號缸', background='yellow')
    #cy24_lb1.place(x=int(1285*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    
    cy24_status=Listbox(tk)
    '''
    cy24_status.place(x=int(1285*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
    cy24_lb2=ttk.Label(frame,text='24號缸排程區', background='orange')
    cy24_lb2.place(x=int(1440*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy24_schedule=Listbox(tk)
    '''
    cy24_schedule.place(x=int(1440*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy24_sta_mod_btn
    
    cy24_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy24_schedule, "24",processing_cylinder_list1,temp_cylinder24))
    cy24_sta_mod_btn.place(x=int(1470*w1), y=int(925*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------------25號缸------------------------
    cy25_lb1=ttk.Label(frame,text='25號缸', background='yellow')
    #cy25_lb1.place(x=int(1605*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    
    cy25_status=Listbox(tk)
    '''
    cy25_status.place(x=int(1605*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
    cy25_lb2=ttk.Label(frame,text='25號缸排程區', background='orange')
    cy25_lb2.place(x=int(1760*w1), y=int(790*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy25_schedule=Listbox(tk)
    '''
    cy25_schedule.place(x=int(1760*w1), y=int(850*h1), width=int(150*w1),height=int(100*h1))
    
   
    global cy25_sta_mod_btn
    
    cy25_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy25_schedule, "25",processing_cylinder_list1,temp_cylinder25))
    cy25_sta_mod_btn.place(x=int(1790*w1), y=int(925*h1), width=int(100*w1),height=int(30*h1))
    '''
    #--------------------------26號缸-------------------------------
    cy26_lb1=ttk.Label(frame,text='26號缸', background='yellow')
    #cy26_lb1.place(x=int(1605*w1), y=0, width=int(150*w1),height=int(40*h1))
    
    cy26_status=Listbox(tk)
    '''
    cy26_status.place(x=int(1605*w1), y=int(60*h1), width=int(150*w1),height=int(100*h1))
    
    cy26_lb2=ttk.Label(frame,text='26號缸排程區', background='orange')
    cy26_lb2.place(x=int(1760*w1), y=0, width=int(150*w1),height=int(40*h1))
    '''
    cy26_schedule=Listbox(tk)
    '''
    cy26_schedule.place(x=int(1760*w1), y=int(60*h1), width=int(150*w1),height=int(70*h1))
    
   
    global cy26_sta_mod_btn
    cy26_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy26_schedule, "26",processing_cylinder_list1,temp_cylinder26))
    cy26_sta_mod_btn.place(x=int(1790*w1), y=int(100*h1), width=int(100*w1),height=int(30*h1))
    '''
    #---------------------32號缸---------------------------------
    cy32_lb1=ttk.Label(frame,text='32號缸', background='yellow')
    #cy32_lb1.place(x=int(1605*w1), y=int(130*h1), width=int(150*w1),height=int(40*h1))
    
    cy32_status=Listbox(tk)
    '''
    cy32_status.place(x=int(1605*w1), y=int(190*h1), width=int(150*w1),height=int(95*h1))
    
    cy32_lb2=ttk.Label(frame,text='32號缸排程區', background='orange')
    cy32_lb2.place(x=int(1760*w1), y=int(130*h1), width=int(150*w1),height=int(40*h1))
    '''
    cy32_schedule=Listbox(tk)
    '''
    cy32_schedule.place(x=int(1760*w1), y=int(190*h1), width=int(150*w1),height=int(95*h1))
    
    global cy32_sta_mod_btn
    cy32_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(cy32_schedule, "32",processing_cylinder_list1,temp_cylinder32))
    cy32_sta_mod_btn.place(x=int(1790*w1), y=int(260*h1), width=int(100*w1),height=int(30*h1))
    
    
    global cy100_sta_mod_btn
    cy100_sta_mod_btn = ttk.Button(frame, text="手排",command=lambda: Popup(listbox_temp, "100",processing_cylinder_list1,temp_cylinder100))
    cy100_sta_mod_btn.place(x=int(1440*w1), y=int(260*h1), width=int(100*w1),height=int(30*h1))
    '''
    #0118: 暫時區介面設定與控制區=============================
    #20180717   暫時區背景修改成紅色
    cy100_lb1=ttk.Label(frame,text='暫時區 100', background='red')
    #cy100_lb1.place(x=int(1415*w1), y=int(115*h1), width=int(150*w1),height=int(40*h1))
    listbox_temp=Listbox(tk)
    '''
    listbox_temp.place(x=int(1415*w1), y=int(175*h1), width=int(180*w1),height=int(110*h1))
    listboxt_select=listbox_temp.bind('<<ListboxSelect>>', listbox_temp_select)
    '''
    #------------------ CSV訊息區-----------------------
    text4=tkinter.Text(tk)
    text4.place(x=int(1415*w1), y=int(30*h1),width=int(180*w1), height=int(110*h1))
    #======================================================


    #=========================設定每缸參數區===================
    setup_cylinder_params(text4)#載入每缸參數值與相關碼重與 投胚量
    #shutdown_manual_schedule_btns()#關閉手動排程按鈕
    #==========================log紀錄器宣告與啟動===================
    global log
    #這邊要設定logbook物件的時間去抓取本電腦的時間local，否則會有少8小時現象產生
    logbook.set_datetime_format("local")
    StreamHandler(sys.stdout).push_application()
    log = Logger('Logbook')
    log_handler = FileHandler('schedule_dyeing.log')
    log_handler.push_application()
    log.info("排程程式啟動")
    #20180717   自動執行排缸後關閉程式
    readfile_to_tree(dist, tree1)
    compare(jobtask_list, tree2)
    ProcessSchedulingOnCylinders(cylinder_list, jobtask_list1)  #20181218   cylinder_list染缸規格資料(1~100)，jobtask_list1待排工單資料(有加索引 3XX筆)
    outputCsv(processing_cylinder_list, btn5_output_csv, _to_jobtask_list)
    tk.destroy()
    #tk.mainloop()
    
    
#呼叫主函式    
scheduler_to_dyeing()